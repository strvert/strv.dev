__NUXT_JSONP__("/blog", (function(a){return {data:[{pages:{value:[{slug:"lets-implement-a-single-mesh-renderer-3",description:"アイテムの描画とか、一つだけのメッシュをレンダリングするのに便利なツールを実装してみる記事のその２。独自のメッシュパスを実装して単一パスの軽量なレンダラを書く。",title:"単一Static Meshレンダラを独自メッシュパスで実装する",enforceCreatedAt:"2024\u002F04\u002F10",enforceUpdatedAt:"2024\u002F04\u002F10",tags:["Unreal Engine","Unreal C++","RHI","RDG","Advent Calendar"],assets:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3",toc:[{id:"簡単な使い方",depth:2,text:"簡単な使い方"},{id:"パフォーマンス",depth:2,text:"パフォーマンス"},{id:"このプラグインでできないこと",depth:2,text:"このプラグインでできないこと"},{id:"レンダラクラス-ftinyrenderer-の定義",depth:2,text:"レンダラクラス FTinyRenderer の定義"},{id:"レンダリング呼び出しの流れ",depth:2,text:"レンダリング呼び出しの流れ"},{id:"ftinyrenderersetupscenetextures",depth:3,text:"FTinyRenderer::SetupSceneTextures"},{id:"ftinyrendererrenderbasepass",depth:3,text:"FTinyRenderer::RenderBasePass"},{id:"staticmesh-から直接-meshbatch-を作成する",depth:2,text:"StaticMesh から直接 MeshBatch を作成する"},{id:"ftinyrenderercreatemeshbatch",depth:3,text:"FTinyRenderer::CreateMeshBatch"},{id:"gpuscene-のためのパラメータをセットアップする",depth:2,text:"GPUScene のためのパラメータをセットアップする"},{id:"ftinyrenderersetupgpusceneresourceparameters",depth:3,text:"FTinyRenderer::SetupGPUSceneResourceParameters"},{id:"ftinyrenderersetgpusceneresourceparameters",depth:3,text:"FTinyRenderer::SetGPUSceneResourceParameters"},{id:"マテリアルを利用した描画処理を行えるシェーダーの作成",depth:2,text:"マテリアルを利用した描画処理を行えるシェーダーの作成"},{id:"ftinyrenderershader-vsps-の-c-定義",depth:3,text:"FTinyRendererShader (VS\u002FPS) の C++ 定義"},{id:"独自メッシュ描画パス処理の頂点シェーダー実装",depth:3,text:"独自メッシュ描画パス処理の頂点シェーダー実装"},{id:"独自メッシュ描画パス処理のピクセルシェーダー実装",depth:3,text:"独自メッシュ描画パス処理のピクセルシェーダー実装"},{id:"シェーダーの登録と-rdg-によるパラメータ定義",depth:3,text:"シェーダーの登録と RDG によるパラメータ定義"},{id:"meshbatch-の描画命令を発行する-meshpassprocessor",depth:2,text:"MeshBatch の描画命令を発行する MeshPassProcessor"},{id:"ftinyrendererbasepassmeshprocessor",depth:3,text:"FTinyRendererBasePassMeshProcessor"},{id:"api-の定義",depth:2,text:"API の定義"},{id:"カメラ設定-fminimalviewinfo-から-viewfamily-の構築",depth:2,text:"カメラ設定 (FMinimalViewInfo) から ViewFamily の構築"},{id:"utinyrendererrenderer",depth:3,text:"UTinyRenderer::Renderer"},{id:"比較",depth:2,text:"比較"},{id:"nsight-graphics-の-scrubber-を眺める",depth:3,text:"Nsight Graphics の Scrubber を眺める"},{id:"フレーム内処理時間の比較",depth:3,text:"フレーム内処理時間の比較"},{id:"いっぱい描画したときの-fps-の比較",depth:3,text:"いっぱい描画したときの FPS の比較"},{id:"opaque-以外の-blendmode-の対応",depth:2,text:"Opaque 以外の BlendMode の対応"},{id:"ライティングの拡張",depth:2,text:"ライティングの拡張"},{id:"shader-permutaion-の最適化",depth:2,text:"Shader Permutaion の最適化"},{id:"パフォーマンスの改善",depth:2,text:"パフォーマンスの改善"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"introduction"},children:[{type:"element",tag:"a",props:{href:"#introduction",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Introduction"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事では、UE5 上でメインの World とは別の空間・ビューポートを対象とした軽量なレンダリング機能を実装してみるものです。\n想定用途は、アイテムのプレビュー表示など、高度なレンダリング機能を必要としないが、軽量に個別のメッシュを描画したい場合などです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事は、以下の記事の続編になります。"}]},{type:"text",value:"\n"},{type:"element",tag:"ol",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"単一 Static Mesh レンダラを FPreviewScene で実装する"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"単一 Static Mesh レンダラを独自メッシュパスで実装する...ための前提知識編"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"1 の記事では、FPreviewScene というユーティリティを使って、メインの World とは別の UWorld インスタンスを作成し、その内部のカメラにレンダリングさせることで、単一の Static Mesh を専用ビューポートに描画する方法を紹介しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、この方法には課題もありました。たとえば、"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"単一メッシュをレンダリングしたいだけなのに専用の UWorld インスタンスが必要"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"レンダリング機能についても多数のメッシュを描画する前提で設計されていたりするために、速度やメモリ資源の面で無駄が多い"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"などです。\n本記事では、 2 の記事で紹介した前提知識を元に、実際に単一メッシュを描画するためのレンダラを実装していきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"StaticMesh から出発して独自のメッシュ描画パスを実装してみることは、UE のレンダリング機能を知る入口としても適しています。"}]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"プラグインの公開"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%AE%E5%85%AC%E9%96%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"プラグインの公開"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事の執筆にあたっては、TinyRenderer というプラグインとして機能を実装しました。プラグインのソースコードは "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fgithub.com\u002Fstrvert\u002FTinyRenderer",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"GitHub"}]},{type:"text",value:" で公開しています。\nなお、実験的な実装であり、きちんとした検証は行っていないので、あくまでも手法の参考としてご利用ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"簡単な使い方"},children:[{type:"element",tag:"a",props:{href:"#%E7%B0%A1%E5%8D%98%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"簡単な使い方"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下のように、BP から簡単にメッシュを指定して RenderTarget に描画させることができます。\n"},{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002Fsample.png"},children:[]},{type:"text",value:"\nこれは UMG 上の Image Widget に配置した例です。\n"},{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002Flamp.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"背景色は RenderTarget の ClearColor で指定したものになるので、背景抜きのことを考えなくても透明に設定するだけではじめから背景無しで描画できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"パフォーマンス"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"パフォーマンス"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"詳しくは "},{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E6%A4%9C%E8%A8%BC"},children:[{type:"text",value:"パフォーマンスの検証"}]},{type:"text",value:" に記載していますが、単一メッシュの描画においては、 SceneCapture2D や FPreviewScene といった手段よりもかなり高速に動作します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"参考として、 同一フレームに 500x500 の RenderTarget に 19382 三角ポリゴンのメッシュを描画して計測すると、フレーム内に占める時間は以下のような結果になりました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002Fcompare.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SceneCapture2D: 4.12ms"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"FPreviewScene"}]},{type:"text",value:": 1.11ms"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"b",props:{},children:[{type:"text",value:"Tiny Renderer (本プラグイン): 0.02ms"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"はやい。いや、むしろ SceneCapture2D などが単純なメッシュ描画には不要な機能が多すぎるということかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"このプラグインでできないこと"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%93%E3%81%AE%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%81%A7%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%93%E3%81%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"このプラグインでできないこと"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このプラグインは、単一 StaticMesh を軽量に描画したいという目的に特化しています。そのため、以下のような機能は提供していません。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"多数のメッシュからなるシーンの描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"複雑な照明環境の描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"エフェクトやポストプロセスの適用"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、以下のような機能は技術的には(たぶん)可能ですが、実装には含まれていません。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"不透明 (Opaque) 以外のマテリアルの描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Nanite メッシュの描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"etc..."}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Nanite メッシュの描画については、Nanite を使った描画はできませんが、Fallback Mesh の LOD を指定して描画することは可能です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、以降はこのプラグインの実装と関連する UE のグラフィックス機能について解説していきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"目次"},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E6%AC%A1",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"目次"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%A8%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88"},children:[{type:"text",value:"おおまかな仕組みとコンセプト"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E8%BB%BD%E9%87%8F%E3%81%AA%E5%8D%98%E4%B8%80-staticmesh-%E3%83%AC%E3%83%B3%E3%83%80%E3%83%A9%E3%81%AE%E5%AE%9F%E8%A3%85"},children:[{type:"text",value:"軽量な単一 StaticMesh レンダラの実装"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%83%B3%E3%83%80%E3%83%A9%E3%82%AF%E3%83%A9%E3%82%B9-ftinyrenderer-%E3%81%AE%E5%AE%9A%E7%BE%A9"},children:[{type:"text",value:"レンダラクラス FTinyRenderer の定義"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%AE%E6%B5%81%E3%82%8C"},children:[{type:"text",value:"レンダリング呼び出しの流れ"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetupscenetextures"},children:[{type:"text",value:"FTinyRenderer::SetupSceneTextures"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrendererrenderbasepass"},children:[{type:"text",value:"FTinyRenderer::RenderBasePass"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#staticmesh-%E3%81%8B%E3%82%89%E7%9B%B4%E6%8E%A5-meshbatch-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"},children:[{type:"text",value:"StaticMesh から直接 MeshBatch を作成する"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderercreatemeshbatch"},children:[{type:"text",value:"FTinyRenderer::CreateMeshBatch"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#gpuscene-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B"},children:[{type:"text",value:"GPUScene のためのパラメータをセットアップする"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetupgpusceneresourceparameters"},children:[{type:"text",value:"FTinyRenderer::SetupGPUSceneResourceParameters"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetgpusceneresourceparameters"},children:[{type:"text",value:"FTinyRenderer::SetGPUSceneResourceParameters"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%8F%8F%E7%94%BB%E5%87%A6%E7%90%86%E3%82%92%E8%A1%8C%E3%81%88%E3%82%8B%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"},children:[{type:"text",value:"マテリアルを利用した描画処理を行えるシェーダーの作成"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderershader-vsps-%E3%81%AE-c-%E5%AE%9A%E7%BE%A9"},children:[{type:"text",value:"FTinyRendererShader (VS\u002FPS) の C++ 定義"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E6%8F%8F%E7%94%BB%E3%83%91%E3%82%B9%E5%87%A6%E7%90%86%E3%81%AE%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AE%9F%E8%A3%85"},children:[{type:"text",value:"独自メッシュ描画パス処理の頂点シェーダー実装"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E6%8F%8F%E7%94%BB%E3%83%91%E3%82%B9%E5%87%A6%E7%90%86%E3%81%AE%E3%83%94%E3%82%AF%E3%82%BB%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AE%9F%E8%A3%85"},children:[{type:"text",value:"独自メッシュ描画パス処理のピクセルシェーダー実装"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A8-rdg-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%AE%9A%E7%BE%A9"},children:[{type:"text",value:"シェーダーの登録と RDG によるパラメータ定義"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#meshbatch-%E3%81%AE%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B-meshpassprocessor"},children:[{type:"text",value:"MeshBatch の描画命令を発行する MeshPassProcessor"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ftinyrendererbasepassmeshprocessor"},children:[{type:"text",value:"FTinyRendererBasePassMeshProcessor"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#bp-%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90"},children:[{type:"text",value:"BP ラッパーの作成"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#api-%E3%81%AE%E5%AE%9A%E7%BE%A9"},children:[{type:"text",value:"API の定義"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%AB%E3%83%A1%E3%83%A9%E8%A8%AD%E5%AE%9A-fminimalviewinfo-%E3%81%8B%E3%82%89-viewfamily-%E3%81%AE%E6%A7%8B%E7%AF%89"},children:[{type:"text",value:"カメラ設定 (FMinimalViewInfo) から ViewFamily の構築"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#utinyrendererrenderer"},children:[{type:"text",value:"UTinyRenderer::Renderer"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E6%A4%9C%E8%A8%BC"},children:[{type:"text",value:"パフォーマンスの検証"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E6%AF%94%E8%BC%83"},children:[{type:"text",value:"比較"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#nsight-graphics-%E3%81%AE-scrubber-%E3%82%92%E7%9C%BA%E3%82%81%E3%82%8B"},children:[{type:"text",value:"Nsight Graphics の Scrubber を眺める"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E5%86%85%E5%87%A6%E7%90%86%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83"},children:[{type:"text",value:"フレーム内処理時間の比較"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%84%E3%81%A3%E3%81%B1%E3%81%84%E6%8F%8F%E7%94%BB%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE-fps-%E3%81%AE%E6%AF%94%E8%BC%83"},children:[{type:"text",value:"いっぱい描画したときの FPS の比較"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E6%94%B9%E5%96%84%E5%8F%AF%E8%83%BD%E6%80%A7"},children:[{type:"text",value:"さらなる改善可能性"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#opaque-%E4%BB%A5%E5%A4%96%E3%81%AE-blendmode-%E3%81%AE%E5%AF%BE%E5%BF%9C"},children:[{type:"text",value:"Opaque 以外の BlendMode の対応"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A9%E3%82%A4%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E6%8B%A1%E5%BC%B5"},children:[{type:"text",value:"ライティングの拡張"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#shader-permutaion-%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96"},children:[{type:"text",value:"Shader Permutaion の最適化"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E6%94%B9%E5%96%84"},children:[{type:"text",value:"パフォーマンスの改善"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81"},children:[{type:"text",value:"まとめ"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おおまかな仕組みとコンセプト"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%81%8A%E3%81%BE%E3%81%8B%E3%81%AA%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%A8%E3%82%B3%E3%83%B3%E3%82%BB%E3%83%97%E3%83%88",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おおまかな仕組みとコンセプト"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"長い記事になるので、まずはどんなコンセプトで実装されたものかをざっくりとまとめておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE の デスクトップやハイエンドコンソール向けのレンダリング機能は、Diferred Rendering による高度な機能を提供します。Deferred Rendering は多数のメッシュや光源を描画したり、高度なポストプロセスを適用したりするのには有益ですが、シンプルな単一メッシュの描画には不要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たとえば、ゲームのインベントリ画面にアイテムの 3D モデルをたくさん並べて表示したいとか、そんなときには高度な機能は不要で、小さな RenderTarget に単一のメッシュを高速に描画できることが重要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、UE のレンダリング機能には AO や GI などの高度な機能のためのパスが多数含まれており、これらのパスは特定の Viewport だけで ON \u002F OFF したりできない (CVars で一括管理されてしまう)ため、シンプルな Viewport 描画を行いにくいです。\n利用される Shader についても複雑な構造になっており、単一メッシュの描画にはオーバースペックです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"そこで、単一のパスでライティングまでを行う Forward Rendering によるレンダラを UE の RHI \u002F RDG を使って実装してみることにしました。また、 UWorld や FScene といったシーン表現や Actor, Component といったものも単一メッシュでは不要(ローカルのTransformしかない)なので利用せず、StaticMesh アセットを直接処理して描画することにします。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"独自のシェーダーで描画を行いますが、アセットの互換性のため、きちんとUEのマテリアルアセットを利用して描画を行えるようにもしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"TinyRenderer は軽量で高速ですが、すごいことをしているわけではありません。むしろ、単一メッシュを描画するにはいらないことをなにもしてないないだけです。"}]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"軽量な単一-staticmesh-レンダラの実装"},children:[{type:"element",tag:"a",props:{href:"#%E8%BB%BD%E9%87%8F%E3%81%AA%E5%8D%98%E4%B8%80-staticmesh-%E3%83%AC%E3%83%B3%E3%83%80%E3%83%A9%E3%81%AE%E5%AE%9F%E8%A3%85",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"軽量な単一 StaticMesh レンダラの実装"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すべてのコードを示すと長くなるため、面白い部分のみを抜粋して説明します。\n全体のコードは "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fgithub.com\u002Fstrvert\u002FTinyRenderer",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"GitHub"}]},{type:"text",value:" を参照してください。プラグインのソースを読みながら、その解説として記事を読むのが理解しやすいかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"レンダラクラス-ftinyrenderer-の定義"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%83%B3%E3%83%80%E3%83%A9%E3%82%AF%E3%83%A9%E3%82%B9-ftinyrenderer-%E3%81%AE%E5%AE%9A%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レンダラクラス FTinyRenderer の定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レンダラを表すクラスは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FTinyRenderer"}]},{type:"text",value:" であり、以下のように定義されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F コンストラクタ。FSceneViewFamilyを受け取る"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"explicit"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FSceneViewFamily"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F StaticMesh およびその変換行列を設定する"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetStaticMesh"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 InLODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMatrix"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InTransform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 描画命令を発行する"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"private"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"struct"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinySceneTextures"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tFRDGTextureRef SceneColorTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tFRDGTextureRef SceneDepthTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"struct"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshBatchesRequiredFeatures"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" bWorldPositionOffset "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\tFTinySceneTextures "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupSceneTextures"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RenderBasePass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTinySceneTextures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 InLODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     TArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InMeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     FMeshBatchesRequiredFeatures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\tFGPUSceneResourceParameters "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshBatchesRequiredFeatures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FGPUSceneResourceParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\tERHIFeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Type FeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FSceneViewFamily"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFSceneUniformBuffer SceneUniforms"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tTWeakObjectPtr"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" StaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFMatrix LocalToWorld"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tint32 LODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE の他の機能との相互利用性を考慮して、 コンストラクタでは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FSceneViewFamily"}]},{type:"text",value:" を受け取って利用します。また、描画するメッシュや変換行列は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SetStaticMesh"}]},{type:"text",value:" で設定し、描画の実行は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Render"}]},{type:"text",value:" で行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FSceneViewFamily"}]},{type:"text",value:" については"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer\u002F#ue-%E3%81%AE%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E7%99%BB%E5%A0%B4%E4%BA%BA%E7%89%A9%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"こちら"}]},{type:"text",value:"を参照してください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"レンダリング呼び出しの流れ"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%AE%E6%B5%81%E3%82%8C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レンダリング呼び出しの流れ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FTinyRenderer::Render"}]},{type:"text",value:" は、呼び出し元から RDGBuilder を受け取り、 RDG を使ってリソースやパスの登録を行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F レンダリング対象の SceneTextures を作成"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTinySceneTextures SceneTextures "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupSceneTextures"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F BasePass をレンダリング"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RenderBasePass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"流れとしては、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SetupSceneTextures"}]},{type:"text",value:" でレンダリングに利用するのテクスチャリソースを登録し、そこに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RenderBasePass"}]},{type:"text",value:" でパスの登録確保したリソースのパラメータのセットアップを実行するというものです。\nRDG についての詳細は "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2#rdg-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E7%99%BA%E8%A1%8C%E3%81%AE%E3%83%9C%E3%82%A4%E3%83%A9%E3%83%BC%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"前回の記事"}]},{type:"text",value:" を参照してください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"呼び出している関数の実装は次節以降で解説します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrenderersetupscenetextures"},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetupscenetextures",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRenderer::SetupSceneTextures"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まずは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SetupSceneTextures"}]},{type:"text",value:" の実装を見ていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"FTinyRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"FTinySceneTextures "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupSceneTextures"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 描画先の FRenderTarget を取得。これが SceneColor の出力先になる"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTarget "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RDG のリソース管理に外部の RenderTarget を登録し、RDG のテクスチャリソースを表す FRDGTextureRef を取得"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureRef TinyRendererOutputRef "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RegisterExternalTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateRenderTarget"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRenderTargetTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"TinyRendererOutput\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F SceneDepth 用のテクスチャを作成。今回は外部から参照しないので、ここで作成して利用する。"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureDesc Desc "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FRDGTextureDesc"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Create2D"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetSizeXY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PF_DepthStencil"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                       FClearValueBinding"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"DepthFar"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                       TexCreate_DepthStencilTargetable "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" TexCreate_ShaderResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureRef SceneDepth "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Desc"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"SceneDepthZ\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" FTinySceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneColorTexture "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" TinyRendererOutputRef"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneDepthTexture "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" SceneDepth\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、 RDG のリソース管理機能を利用して、レンダリングに利用するテクスチャリソースを定義しています。SceneColor には、外部の RenderTarget を利用し、SceneDepth は RDG のリソースとして作成しています。\nRDG を使った実装では、 RDG がリソースのライフタイムを管理するため、外部化のリソースを利用するには登録を行って RDG のリソースとして扱う必要があります。別の場所で作成した RenderTarget を渡したい場合や、フレームをまたいで利用したいリソースがある場合には、このような方法を使うことになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrendererrenderbasepass"},children:[{type:"element",tag:"a",props:{href:"#ftinyrendererrenderbasepass",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRenderer::RenderBasePass"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"次に、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RenderBasePass"}]},{type:"text",value:" の実装を見ていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RenderBasePass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTinySceneTextures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SCOPED_NAMED_EVENT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FTinyRenderer_RenderBasePass"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FColor"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Emerald"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F レンダリング対象の StaticMesh を取得"}]},{type:"text",value:"\n\tUStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" Mesh "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" StaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IsValid"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"?"}]},{type:"text",value:" StaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Get"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"Mesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UE_LOG"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LogTinyRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Warning"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"StaticMesh is not valid\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F StaticMesh から MeshBatch を作成"}]},{type:"text",value:"\n\tTArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" MeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFMeshBatchesRequiredFeatures RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Mesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" LODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UE_LOG"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LogTinyRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Warning"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Failed to create mesh batch\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F GPUScene のためのパラメータをセットアップ"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FGPUSceneResourceParameters GPUSceneResourceParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GPUSceneResourceParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F レンダリング対象の View を取得\t"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FViewInfo"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" View "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"static_cast"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FViewInfo"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Views"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F レンダリングに利用する Shader のパラメータを構築"}]},{type:"text",value:"\n\tFTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PassParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AllocParameters"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"View "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"ViewUniformBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"Scene "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" SceneUniforms"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F レンダリング結果の出力先を設定"}]},{type:"text",value:"\n\tPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderTargets"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FRenderTargetBinding"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneColorTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                        ERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"EClear"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F DepthStencil の設定"}]},{type:"text",value:"\n\tPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderTargets"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DepthStencil "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FDepthStencilBinding"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneDepthTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                                  ERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"EClear"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                                  ERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"ELoad"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                                  FExclusiveDepthStencil"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"DepthWrite_StencilWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F メッシュ描画用のパスを RDG に登録"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddSimpleMeshPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PassParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RDG_EVENT_NAME"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"TinyRendererBasePass\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"UnscaledViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ERDGPassFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Raster"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FDynamicPassMeshDrawListContext"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" DynamicMeshPassContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"for"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MeshBatch "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" MeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F マテリアルから ShaderBinding を取得するために、必要に応じて UniformExpression を更新"}]},{type:"text",value:"\n\t\t\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UpdateUniformExpressionCacheIfNeeded"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetFeatureLevel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F MeshBatch を TinyRenderer 用の BasePassMeshProcessor に追加"}]},{type:"text",value:"\n\t\t\t\tFTinyRendererBasePassMeshProcessor "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TinyRendererBasePassMeshProcessor"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" DynamicMeshPassContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t\tTinyRendererBasePassMeshProcessor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"~"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0ull"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、レンダリングに必要なパラメータのセットアップから描画パスの登録までを行っています。具体的には、以下のような処理に分けられます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"StaticMesh から MeshBatch を作成する。 MeshBatch はメッシュのレンダリングに必要な情報をまとめた構造体で、あらゆる描画可能なメッシュは MeshBatch に変換してから描画に使われる。\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#staticmesh-%E3%81%8B%E3%82%89%E7%9B%B4%E6%8E%A5-meshbatch-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"},children:[{type:"text",value:"CreateMeshBatch()"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"パスパラメータをセットアップする。ここでは描画先のテクスチャやビュー情報、シーン情報など基本的な要素のほか、 GPUScene に必要なパラメータもセットアップしている。\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#gpuscene-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B"},children:[{type:"text",value:"SetupGPUSceneResourceParameters() "}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"パスを RDG に登録する。 RDG には描画パスを登録するための関数が用意されており、ここでは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddSimpleMeshPass"}]},{type:"text",value:" を使って MeshBatch を RDG に登録している。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"パス内部では、MeshPassProcessor を使って MeshBatch の描画命令を登録する。\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#meshbatch-%E3%81%AE%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B-meshpassprocessor"},children:[{type:"text",value:"FTinyRendererBasePassMeshProcessor"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddSimpleMeshPass"}]},{type:"text",value:" は RDG 向けに提供されている便利な関数で、 MeshPassProcessor を使ったメッシュ描画パスに必要なコンテキストのセットアップを行ってくれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"staticmesh-から直接-meshbatch-を作成する"},children:[{type:"element",tag:"a",props:{href:"#staticmesh-%E3%81%8B%E3%82%89%E7%9B%B4%E6%8E%A5-meshbatch-%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"StaticMesh から直接 MeshBatch を作成する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"通常の UE のシーンでは、 StaticMesh などのアセットを直接シーンに配置されることはありません(できません)。シーンに存在するすべての可視存在は、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UStaticMeshComponent"}]},{type:"text",value:" など "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UPrimitiveComponent"}]},{type:"text",value:" を継承したコンポーネントとして配置されます。StaticMesh などのアセットは、コンポーネントに設定されることで間接的に利用されることになります。\nレンダリングプロセスとしても、ゲームスレッドの "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UPrimitiveComponent"}]},{type:"text",value:" の持つメソッドをもとに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FPrimitiveSceneProxy"}]},{type:"text",value:" が作成され、それをもとに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshBatch"}]},{type:"text",value:" が作成されるという流れになります。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshBatch"}]},{type:"text",value:" が作成できれば、あとは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MeshPassProcessor"}]},{type:"text",value:" を使って描画命令を登録するだけで描画が行えます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrenderercreatemeshbatch"},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderercreatemeshbatch",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRenderer::CreateMeshBatch"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、今回のような単一メッシュの描画には、コンポーネントはオーバースペックです。そこで、コンポーネントを介さずに StaticMesh から直接 MeshBatch を作成する方法を考えます。\nこれを実装したのが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateMeshBatch()"}]},{type:"text",value:" 関数です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F**"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param InStaticMesh MeshBatch を作成する StaticMesh"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param InLODIndex MeshBatch を作成する StaticMesh の LODIndex"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param InMeshBatches 作成した MeshBatch を格納する配列"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param RequiredFeatures MeshBatch が描画時に必要とする機能"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @return MeshBatch が作成できた場合は true、それ以外は false"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 InLODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                    TArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InMeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                    FMeshBatchesRequiredFeatures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SCOPED_NAMED_EVENT_F"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"FTinyRenderer::CreateMeshBatch - %s\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FColor"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Emerald"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"InStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetName"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F StaticMesh がコンパイル中の場合は MeshBatch を作成しない"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F Editor 用チェックであり、非 Editor ビルドでは定数化するので、最適化で消える"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IsCompiling"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F StaticMesh から RenderData を取得。ここに StaticMesh のメッシュデータが格納されている"}]},{type:"text",value:"\n\tFStaticMeshRenderData"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRenderData"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 LODResourceIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMath"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Min"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InLODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderData"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"LODResources"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Num"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LODResourceIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 以下、LODResources から指定の LODIndex のメッシュデータを読み出し、MeshBatch を作成する"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FStaticMeshSectionArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Sections "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" RenderData"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"LODResources"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"LODResourceIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Sections"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F セクションの数だけ MeshBatch を作成。一般的に、StaticMesh に割り当てられているマテリアルの数と対応している"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"for"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"int32 SectionIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" SectionIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:" Sections"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Num"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" SectionIndex"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"++"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FStaticMeshSection"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Section "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Sections"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"SectionIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumTriangles "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"=="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"continue"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FStaticMeshLODResources"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" LODResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" RenderData"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"LODResources"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"LODResourceIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F データを MeshBatch に格納していく"}]},{type:"text",value:"\n\t\tFMeshBatch MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactory "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"RenderData"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"LODVertexFactories"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"LODResourceIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactory"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Type "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" PT_TriangleList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F MeshBatch の Element に IndexBuffer などを格納。MeshBatch は複数の Element を持つことができるが、エンジンでも多くの場合は 1 つの Element しか使われていない"}]},{type:"text",value:"\n\t\tFMeshBatchElement"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" BatchElement "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Elements"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FLocalVertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" VertexFactory "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"static_cast"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FLocalVertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactory"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactoryUserData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" VertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetUniformBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IndexBuffer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"LODResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IndexBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FirstIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FirstIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumPrimitives "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumTriangles"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MinVertexIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MinVertexIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaxVertexIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaxVertexIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"PrimitiveIdMode "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" PrimID_DynamicPrimitiveShaderData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"LODIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" LODResourceIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SegmentIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" SectionIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"CastShadow "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F マテリアルを取得"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" UMaterialInterface"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" MaterialInterface "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterial"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Section"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\tBatchElement"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumPrimitives "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" MaterialInterface "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"auto"}]},{type:"text",value:" MaterialProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialInterface"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRenderProxy"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F マテリアルのレンダースレッド表現である MaterialRenderProxy を MeshBatch に MaterialRenderProxy を格納"}]},{type:"text",value:"\n\t\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialRenderProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\tInMeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Add"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialRelevance"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MaterialRelevance "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialInterface"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRelevance_Concurrent"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F マテリアルが利用を要求しているレンダリング機能を RequiredFeatures に格納"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialRelevance"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"bUsesWorldPositionOffset"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t\tRequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"bWorldPositionOffset "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InMeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IsEmpty"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"StaticMesh には LOD で分割されたメッシュデータが格納されており、更にその中に複数のセクションが存在します。セクションは、メッシュデータの一部を表すもので、一般的にはマテリアルごとに分割されています。\nMeshBatch 一つあたり１つのマテリアルが割り当てられるため、セクションごとに MeshBatch を作成しています。\nマテリアルのレンダースレッド表現については前回の "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2\u002F#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%A8%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E8%A1%A8%E7%8F%BE",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"マテリアルとシェーダーレンダースレッド表現"}]},{type:"text",value:" を参照してください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE のマテリアルはビジュアルシェーダー言語であるため、その設定によって要求されるレンダリング機能が変わります。ここでは例として、 MeshBatches の作成とともに、それらを描画するために WorldPositionOffset が必要かどうかを取得する処理を加えています。\n取得した情報は後のシェーダーパラメータ作成に利用されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、頂点ファクトリ(Vertex Factory)は独自パスを書くうえで非常に重要です。頂点ファクトリはメッシュの種別に紐づく形で様々な種類が存在しており、紐づくメッシュタイプの頂点データを処理して Vertex Shader に提供する役割を果たします。詳細は前回記事の "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2#%E9%A0%82%E7%82%B9%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"頂点データの受け渡し"}]},{type:"text",value:" を参照してください。\nここでは StaticMesh が利用する頂点ファクトリである "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FLocalVertexFactory"}]},{type:"text",value:" を前提として MeshBatch を作成しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"gpuscene-のためのパラメータをセットアップする"},children:[{type:"element",tag:"a",props:{href:"#gpuscene-%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"GPUScene のためのパラメータをセットアップする"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"GPUScene は、GPU 側にプリミティブやそのインスタンスの配置情報を表すバッファを持つことで、プリミティブの GPU への送信回数を最適化したり、一度のドローコールで複数のメッシュを描画したりできるようにする機能です。\nStaticMesh のキャッシングや、いわゆる GPU Instancing と呼ばれるものなどはこれによって実現されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回のレンダラはキャッシュ等を行わないし単一メッシュなのに、どうして GPUScene をセットアップするんだ？　という疑問はごもっともです。実際、機能としては必要ありません。ただ、UE の StaticMesh 描画実装をうまく流用して実装を行おうとすると GPUScene を利用しないほうが複雑になるため、 1 プリミティブ 1 インスタンスの GPUScene をセットアップすることにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、FLocalVertexFactory の派生ファクトリを作成し、Shader のコンパイルパラメータを変更してから利用させることで、 GPUScene を利用しないようにすることも可能ではあります。FLocalVertexFactory をそのまま利用する場合には、GPUScene の利用がプラットフォームと Feature Level で自動的に決定されてしまいます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrenderersetupgpusceneresourceparameters"},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetupgpusceneresourceparameters",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRenderer::SetupGPUSceneResourceParameters"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"GPUScene の基本的な仕組みは、Vertex Shader にわたす頂点情報に、プリミティブ ID などの情報を追加することで、GPU 側でプリミティブごとの情報を取得できるようにすることです。プリミティブごとの情報は別途バッファとして GPU に渡され、シェーダー側で利用されます。\nこの構築を行うのが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SetupGPUSceneResourceParameters"}]},{type:"text",value:" 関数です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F**"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param GraphBuilder RDGBuilder"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @param RequiredFeatures 対象の MeshBatch の描画時に必要とする機能"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" * @return GPUScene のためのパラメータ"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:" *\u002F"}]},{type:"text",value:"\nFGPUSceneResourceParameters "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetupGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                                                           "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshBatchesRequiredFeatures"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* PrimitiveData として使うパラメータを構築 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FPrimitiveUniformShaderParameters PrimitiveParams "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" FPrimitiveUniformShaderParametersBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Defaults"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"LocalToWorld"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LocalToWorld"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ActorWorldPosition"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LocalToWorld"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetOrigin"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"EvaluateWorldPositionOffset"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RequiredFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"bWorldPositionOffset"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Build"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FPrimitiveSceneShaderData "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"PrimitiveSceneData"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PrimitiveParams"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\tFGPUSceneResourceParameters GPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Primitive Data のバッファを作成 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGBufferRef RDGPrimitiveSceneDataBuffer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateStructuredBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"PrimitiveSceneDataBuffer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" TArray"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"PrimitiveSceneData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUScenePrimitiveSceneData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RDGPrimitiveSceneDataBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumScenePrimitives "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tFInstanceSceneShaderData InstanceSceneData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tInstanceSceneData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Build"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* PrimitiveId *\u002F"}]},{type:"text",value:"\n\t\t                        "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RelativeId *\u002F"}]},{type:"text",value:"\n\t\t                        "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* InstanceFlags *\u002F"}]},{type:"text",value:"\n\t\t                        INVALID_LAST_UPDATE_FRAME"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* LastUpdateFrame *\u002F"}]},{type:"text",value:"\n\t\t                        "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* CustomDataCount *\u002F"}]},{type:"text",value:"\n\t\t                        "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RandomID *\u002F"}]},{type:"text",value:"\n\t\t                        FRenderTransform"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Identity"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* LocalToPrimitive *\u002F"}]},{type:"text",value:"\n\t\t                        PrimitiveParams"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"LocalToRelativeWorld"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* PrimitiveToWorld *\u002F"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Instance Data のバッファを作成 *\u002F"}]},{type:"text",value:"\n\t\tTArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FVector4f"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" InstanceSceneDataSOA"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tInstanceSceneDataSOA"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddZeroed"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FInstanceSceneShaderData"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetDataStrideInFloat4s"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"for"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"uint32 ArrayIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" ArrayIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FInstanceSceneShaderData"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetDataStrideInFloat4s"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" ArrayIndex"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"++"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\tInstanceSceneDataSOA"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"ArrayIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" InstanceSceneData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Data"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"ArrayIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGBufferRef RDGInstanceSceneDataBuffer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateStructuredBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"InstanceSceneDataBuffer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InstanceSceneDataSOA"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUSceneInstanceSceneData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RDGInstanceSceneDataBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"InstanceDataSOAStride "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"NumInstances "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ダミーのバッファで不要なパラメータを埋める *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGBufferRef DummyBufferVec4 "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GSystemTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetDefaultStructuredBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"sizeof"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FVector4f"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGBufferRef DummyBufferLight "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GSystemTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetDefaultStructuredBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"sizeof"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FLightSceneData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUSceneInstancePayloadData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"DummyBufferVec4"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUSceneLightmapData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"DummyBufferVec4"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUSceneLightData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"DummyBufferLight"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* たぶん NRVO が効くのでそのまま返しちゃいましょう *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" GPUSceneParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FPrimitiveUniformShaderParametersBuilder"}]},{type:"text",value:" を通して作成している "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FPrimitiveSceneShaderData"}]},{type:"text",value:" は、プリミティブごとの情報を表す構造体です。一方 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FInstanceSceneShaderData"}]},{type:"text",value:" は、インスタンスごとの情報を表す構造体で、きちんと GPUScene を使うときには 1 つのプリミティブに対して複数のインスタンスが存在することを考慮して設計されています。\nここでは単一メッシュの描画を行うためどちらも１つで十分で、必要最低限の情報しか設定していません。高度な GPUScene の構築についてはエンジンの "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\\UE5\\Source\\Runtime\\Renderer\\Private\\GPUScene.cpp:FGPUScene::UploadGeneral()"}]},{type:"text",value:" が参考になります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrenderersetgpusceneresourceparameters"},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderersetgpusceneresourceparameters",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRenderer::SetGPUSceneResourceParameters"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これは単に、構築した GPUScene のパラメータを RDG のリソースとしてセットアップする関数です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetGPUSceneResourceParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FGPUSceneResourceParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tSceneUniforms"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Set"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SceneUB"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"GPUScene"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"マテリアルを利用した描画処理を行えるシェーダーの作成"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E6%8F%8F%E7%94%BB%E5%87%A6%E7%90%86%E3%82%92%E8%A1%8C%E3%81%88%E3%82%8B%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"マテリアルを利用した描画処理を行えるシェーダーの作成"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以上の内容で描画したいメッシュのセットアップは概ね完了しました。次に、描画処理を行うシェーダーを作成します。今回のシェーダーは以下のような要件を満たす必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"StaticMesh に割り当てられたマテリアルを使って描画することができる"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UE の標準レンダリング機能と近い見た目を提供する"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"軽量である"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"特に、マテリアルアセットと組み合わせて利用できるシェーダーの定義にはいくつか考慮すべきポイントがあるため、それについても解説します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrenderershader-vsps-の-c-定義"},children:[{type:"element",tag:"a",props:{href:"#ftinyrenderershader-vsps-%E3%81%AE-c-%E5%AE%9A%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRendererShader (VS\u002FPS) の C++ 定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まずは Shader の C++ 定義です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer の VS\u002FPS 共通で利用する機能を定義 *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"namespace"}]},{type:"text",value:" TinyRendererShader\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* シェーダーのコンパイル環境を変更 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                         FShaderCompilerEnvironment"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* GPUScene は利用するが、InstanceCulling は不要 *\u002F"}]},{type:"text",value:"\n\t\tOutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDefine"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"USE_INSTANCE_CULLING_DATA\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tOutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDefine"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"USE_INSTANCE_CULLING\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 任意の ShaderPermutation に対してコンパイルを行うかどうかを判定 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" FName "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"NAME_LocalVertexFactory"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"FLocalVertexFactory\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialDomain "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"=="}]},{type:"text",value:" MD_Surface"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:"\n\t\t\tParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactoryType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"=="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FindVertexFactoryType"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"NAME_LocalVertexFactory"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer の頂点シェーダー C++ 定義 *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRendererShaderVS"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","base-clause"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshMaterialShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"DECLARE_SHADER_TYPE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FTinyRendererShaderVS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshMaterial"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                         FShaderCompilerEnvironment"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 親の環境定義を引き継ぎつつ、TinyRenderer 用の環境定義を追加 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshMaterialShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TinyRendererShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TinyRendererShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer のピクセルシェーダー C++ 定義 *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRendererShaderPS"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","base-clause"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshMaterialShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"DECLARE_SHADER_TYPE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FTinyRendererShaderPS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshMaterial"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                         FShaderCompilerEnvironment"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 親の環境定義を引き継ぎつつ、TinyRenderer 用の環境定義を追加 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshMaterialShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TinyRendererShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* PixelShader 特有の環境定義を追加 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ライトベイクは行わないので、ライトマップ系機能は不要 *\u002F"}]},{type:"text",value:"\n\t\tOutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDefine"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"NEEDS_LIGHTMAP_COORDINATE\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 独自の出力を行うため、通常の SceneTexture は不要 *\u002F"}]},{type:"text",value:"\n\t\tOutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDefine"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"SCENE_TEXTURES_DISABLED\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TinyRendererShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2#shader-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E6%89%B1%E3%82%8F%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%8B",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"前回の記事"}]},{type:"text",value:" でも説明しましたが、UE のシェーダーは C++ 側の定義クラスと USF(HLSLもどき) 実装のペアで構成されます。\nC++定義クラスの派生元としては、よく "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FGlobalShader"}]},{type:"text",value:" が使われますが、これをマテリアルと組み合わせて利用するのは少し面倒です。\nマテリアルと組み合わせて利用する場合には "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMaterialShader"}]},{type:"text",value:" もしくは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshMaterialShader"}]},{type:"text",value:" の派生を定義することになり、特にメッシュ描画においては "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshMaterialShader"}]},{type:"text",value:" を使うと便利です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE のマテリアルアセットは、背後でシェーダーコードを生成します。しかし、このコードはそれ単体で動作するものではなく、別のテキストで実装されたシェーダーからコードの断片として利用されてはじめて機能します。\nつまり UE のマテリアルとは、テキストのシェーダーが公開したカスタマイゼーションポイントを埋めるコードを生成するためのツールなのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このため、マテリアルとそれを利用するシェーダーは、常に組み合わせて合わせてコンパイルされる必要があります。組み合わせは 1対1 ではなく多対多の関係になり、このあらゆる組み合わせのことを ShaderPermutation と呼びます。\nしかし、すべてのシェーダーとマテリアルに互換性があるわけではありません。たとえば、材質のマテリアルと組み合わせるシェーダーはポスプロのマテリアルとは互換性がありません。\nまた、互換性があっても、目的として利用しない組み合わせまでコンパイルしてしまうと、組み合わせ爆発によって長大なシェーダーコンパイルを引き起こす可能性があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"そこで上記のコードのように、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"text",value:" という関数を使ってシェーダーのコンパイル環境に対してフィルタリングを行います。今回のケースでは、 StaticMesh のレンダリングにさえ対応していればよいため、 組み合わせるマテリアルのドメインが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MD_Surface"}]},{type:"text",value:" であることと、適応するメッシュの頂点ファクトリが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FLocalVertexFactory"}]},{type:"text",value:" であることを条件としています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"より詳しくは "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2\u002F#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E8%A8%AD%E5%AE%9A",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"前回記事のシェーダーのコンパイル設定のセクション"}]},{type:"text",value:" を参照してください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"独自メッシュ描画パス処理の頂点シェーダー実装"},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E6%8F%8F%E7%94%BB%E3%83%91%E3%82%B9%E5%87%A6%E7%90%86%E3%81%AE%E9%A0%82%E7%82%B9%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AE%9F%E8%A3%85",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"独自メッシュ描画パス処理の頂点シェーダー実装"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE では、HLSL をベースにした USF というファイル形式でシェーダーコードを記述します。USF をもとに各プラットフォーム向けのシェーダーコードが生成され、コンパイルされるため、共通のコードでクロスプラットフォームのシェーダーを記述することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-hlsl"]},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FGenerated\u002FMaterial.ush\""}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FGenerated\u002FVertexFactory.ush\""}]}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Vertex Shader から Pixel Shader へ受け渡すデータ *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"struct"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRendererVSToPS"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" Position "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" SV_POSITION"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" PixelPosition "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" POSITION8"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFVertexFactoryInterpolantsVSToPS FactoryInterpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Vertex Shader *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MainVS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FVertexFactoryInput Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"out"}]},{type:"text",value:" FTinyRendererVSToPS Output"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tResolvedView "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ResolveView"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* GPUScene から現在の処理対象のインスタンスの情報を取得 *\u002F"}]},{type:"text",value:"\n\tFVertexFactoryIntermediates VFIntermediates "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetVertexFactoryIntermediates"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* InstanceCullingData を Off にしていると、以下のフラグが常に false になってしまい、マテリアルが要求しても WPO が評価されない *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* このフラグが true でも、マテリアルが要求していない場合は WPO は評価されないので負荷の心配は不要 *\u002F"}]},{type:"text",value:"\n\tVFIntermediates"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"bEvaluateWorldPositionOffset "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" WorldPositionExcludingWPO "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"VertexFactoryGetWorldPosition"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VFIntermediates"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" WorldPos "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" WorldPositionExcludingWPO"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float3x3"}]},{type:"text",value:" TangentToLocal "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"VertexFactoryGetTangentToLocal"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VFIntermediates"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* マテリアルが生成した VertexShader 用のコードを呼び出し、結果を取得 *\u002F"}]},{type:"text",value:"\n\tFMaterialVertexParameters VertexParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialVertexParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VFIntermediates"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" WorldPos"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"xyz"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" TangentToLocal"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* マテリアルが生成した WorldPositionOffset を適用 *\u002F"}]},{type:"text",value:"\n\tWorldPos"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"xyz "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"+="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialWorldPositionOffset"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"VertexParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* PixelShader に渡すデータを設定 *\u002F"}]},{type:"text",value:"\n\tOutput"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Position "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"INVARIANT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"mul"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"WorldPos"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ResolvedView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"TranslatedWorldToClip"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tOutput"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"PixelPosition "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" WorldPos"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tOutput"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FactoryInterpolants "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"VertexFactoryGetInterpolantsVSToPS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Input"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VFIntermediates"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VertexParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このシェーダーは、UE の標準頂点シェーダーを簡略化したような実装になっています。 重要なのは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GetMaterialVertexParameters"}]},{type:"text",value:" や "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GetMaterialWorldPositionOffset"}]},{type:"text",value:" などの関数呼び出しです。これらは、マテリアルが生成したシェーダーコードを呼び出し、その結果を取得するための関数です。\nどのマテリアルと組み合わせてコンパイルされるかの制御は C++ 側で行われるので、シェーダー側では "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"\u002FEngine\u002FGenerated\u002FMaterial.ush"}]},{type:"text",value:" などのヘッダーファイルをインクルードすることで、任意のマテリアルと組み合わせたときのシェーダーコードを取得することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"有り体に言えば、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GetMaterialWorldPositionOffset"}]},{type:"text",value:" の値はマテリアルグラフで "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"WorldPositionOffset"}]},{type:"text",value:" に繋いだワイヤーの値がそのまま出てくるということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、 GPUScene を有効にしているにもかかわらず InstanceCulling 機能を Off にしていると、 Primitive の InstanceCulling フラグが常に 0 になってしまい、マテリアルが要求しても WorldPositionOffset が評価されないという問題があります。\nこのため、シェーダー側で bEvaluateWorldPositionOffset を強制的に true にしています。ただし、マテリアルが要求していない場合は WPO は評価されないため、負荷の心配は不要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"独自メッシュ描画パス処理のピクセルシェーダー実装"},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E6%8F%8F%E7%94%BB%E3%83%91%E3%82%B9%E5%87%A6%E7%90%86%E3%81%AE%E3%83%94%E3%82%AF%E3%82%BB%E3%83%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AE%9F%E8%A3%85",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"独自メッシュ描画パス処理のピクセルシェーダー実装"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"続いて、ピクセルシェーダーの実装です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-hlsl"]},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"define"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","macro-name"]},children:[{type:"text",value:"SUPPORT_CONTACT_SHADOWS"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","expression"]},children:[{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]}]}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FPrivate\u002FBasePassCommon.ush\""}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FGenerated\u002FMaterial.ush\""}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FPrivate\u002FShadingModelsMaterial.ush\""}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FGenerated\u002FVertexFactory.ush\""}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","macro","property"]},children:[{type:"element",tag:"span",props:{className:["token","directive-hash"]},children:[{type:"text",value:"#"}]},{type:"element",tag:"span",props:{className:["token","keyword","directive"]},children:[{type:"text",value:"include"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FEngine\u002FPrivate\u002FDeferredLightingCommon.ush\""}]}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Pixel Shader *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MainPS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"in"}]},{type:"text",value:" FTinyRendererVSToPS Interpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"out"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" OutColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" SV_Target0\n\tOPTIONAL_IsFrontFace"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tResolvedView "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ResolveView"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float3"}]},{type:"text",value:" WorldPosition "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Interpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"PixelPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"xyz"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* マテリアルが生成した PixelShader 用のコードを呼び出し、結果を取得 *\u002F"}]},{type:"text",value:"\n\tFMaterialPixelParameters MaterialParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialPixelParameters"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tInterpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FactoryInterpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Interpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Position"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFPixelMaterialInputs PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* スクリーン座標系の位置を取得 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"text",value:" ScreenPosition "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SvPositionToResolvedScreenPosition"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Interpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Position"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* マテリアルから更に追加のパラメータを取得 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CalcMaterialParametersEx"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Interpolants"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Position"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ScreenPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" bIsFrontFace"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t                         WorldPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" WorldPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* マテリアルの各種出力を取得 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialCoverageAndClipping"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half"}]},{type:"text",value:" Opacity "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialOpacity"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half3"}]},{type:"text",value:" BaseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialBaseColor"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half"}]},{type:"text",value:" Metallic "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialMetallic"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half"}]},{type:"text",value:" Specular "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialSpecular"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half"}]},{type:"text",value:" Roughness "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"max"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.015625f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialRoughness"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float"}]},{type:"text",value:" Anisotropy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialAnisotropy"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"uint"}]},{type:"text",value:" ShadingModelID "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialShadingModel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* GBuffer (という名前の構造体) にマテリアルの各種出力を設定。テクスチャリソースとしての GBuffer はここでは使われていないので注意 *\u002F"}]},{type:"text",value:"\n\tFGBufferData GBuffer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FGBufferData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Depth "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ScreenPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"w"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetGBufferForShadingModel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tMaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tOpacity"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tBaseColor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tMetallic"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tSpecular"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tRoughness"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tAnisotropy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tShadingModelID"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* スペキュラカラーやディフューズカラーを計算 *\u002F"}]},{type:"text",value:"\n\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SpecularColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ComputeF0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Specular"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"BaseColor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Metallic"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DiffuseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"BaseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"BaseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Metallic"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DiffuseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DiffuseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" ResolvedView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DiffuseOverrideParameter"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"w "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"+"}]},{type:"text",value:" ResolvedView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"\n\t\t\tDiffuseOverrideParameter"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"xyz"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tGBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SpecularColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SpecularColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" ResolvedView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SpecularOverrideParameter"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"w "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"+"}]},{type:"text",value:" ResolvedView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"\n\t\t\tSpecularOverrideParameter"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"xyz"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half3"}]},{type:"text",value:" DiffuseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DiffuseColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.05f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half3"}]},{type:"text",value:" CameraVector "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"text",value:"MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"CameraVector"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float"}]},{type:"text",value:" DirectionalLightShadow "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* Directional Light の設定 *\u002F"}]},{type:"text",value:"\n\tFDeferredLightData LightData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FDeferredLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Color "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float3"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FalloffExponent "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Direction "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float3"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.5"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.5"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0.5"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"bRadialLight "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SpecularScale "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ShadowedBits "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tLightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"HairTransmittance "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"InitHairTransmittanceData"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half4"}]},{type:"text",value:" LightAttenuation "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ライティングを計算 *\u002F"}]},{type:"text",value:"\n\tFLightAccumulator DirectionalLighting "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AccumulateDynamicLighting"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"WorldPosition"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" CameraVector"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" GBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                          "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ShadingModelID"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" LightData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                          LightAttenuation"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"uint2"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                          DirectionalLightShadow"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half3"}]},{type:"text",value:" Color "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" DirectionalLighting"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"TotalLight"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 最後にエミッシブカラーを加算 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"half3"}]},{type:"text",value:" Emissive "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialEmissive"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelMaterialInputs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"+="}]},{type:"text",value:" Emissive"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 最終的な色を出力 *\u002F"}]},{type:"text",value:"\n\tOutColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float4"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Color"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"rgb"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このピクセルシェーダーは、UE のモバイル向け BasePass を参考に、固定された DirectionalLight による照明のみを行うようにしたシンプルなものです。単一メッシュであるため、反射や GI などの機能も無視することができます。\nエンジンのために便利なユーティリティが多数用意されているため、照明計算やマテリアルのパラメータ取得なども比較的簡単に行うことができます。シェーディングモデルなども流用可能です。また、そのようにすることで、UE の標準レンダリング機能と近い見た目を提供することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"GetMaterialPixelParameters"}]},{type:"text",value:" は、頂点シェーダーで取得した情報をもとに、マテリアルが生成したピクセルシェーダー用のコードを呼び出し、その結果を取得するための関数です。これにより、マテリアルのピクセルシェーダー向け出力を取得することができます。\nほかにもいくつかマテリアルからの出力を取得して利用しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"シェーダーの登録と-rdg-によるパラメータ定義"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E7%99%BB%E9%8C%B2%E3%81%A8-rdg-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%AE%9A%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"シェーダーの登録と RDG によるパラメータ定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"作成したシェーダーの C++ 定義と USF 実装を関連付けて登録します。また、シェーダーが利用するパラメータ構造体を RDG が提供するマクロを使って定義します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer の頂点シェーダーとピクセルシェーダーの実装 (.usf ファイル) と C++ 定義を関連付けて登録 *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_MATERIAL_SHADER_TYPE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FTinyRendererShaderVS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                 "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FStaticMeshRenderer\u002FPrivate\u002FTinyRendererShader.usf\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                 "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"MainVS\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SF_Vertex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_MATERIAL_SHADER_TYPE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FTinyRendererShaderPS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                 "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FStaticMeshRenderer\u002FPrivate\u002FTinyRendererShader.usf\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                 "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"MainPS\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SF_Pixel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer のシェーダーが利用するパラメータ構造体を定義 *\u002F"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BEGIN_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_REF"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FViewUniformShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_RDG_UNIFORM_BUFFER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FSceneUniformParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Scene"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_INCLUDE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FInstanceCullingDrawParams"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InstanceCullingDrawParams"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RENDER_TARGET_BINDING_SLOTS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"END_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これにより、C++ の定義クラスと USF の実装が関連付けられるため、 C++ 定義クラスを使ってシェーダーを指定したり、 RDG のパラメータ構造体を使ってシェーダーにパラメータを渡すことができるようになります。\n特に RDG のマクロによるパラメータ定義は便利です。主機能としては C++ 構造体を定義するマクロなのですが、同時にパラメータの名前やシェーダー側での参照名などのメタデータを定義してくれます。\n手動でシェーダーへのパラメータのバインディングを書かなくても、RDG パスへパラメータ構造体として渡すだけで、名前や型をもとにバインディングやライフタイム管理を行ってくれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"上で一度みたコードですが、パラメータ構造体を RDG のパスにわたしている部分のコードを再度見てみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F パラメータ構造体の確保を行う"}]},{type:"text",value:"\nFTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PassParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AllocParameters"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F パラメータ構造体にパラメータをセット"}]},{type:"text",value:"\nPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"View "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"ViewUniformBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"Scene "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" SceneUniforms"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RenderTargets は RENDER_TARGET_BINDING_SLOTS マクロで定義されたスロットを指している。"}]},{type:"text",value:"\nPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderTargets"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FRenderTargetBinding"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneColorTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"EClear"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nPassParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderTargets"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DepthStencil "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FDepthStencilBinding"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SceneDepthTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"EClear"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tERenderTargetLoadAction"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"ELoad"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tFExclusiveDepthStencil"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"DepthWrite_StencilWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F パラメータ構造体 (PassParameters) を RDG のパスに渡す。これだけで RDG がシェーダーへのパラメータのバインディングやライフタイム管理を行ってくれる"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddSimpleMeshPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PassParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RDG_EVENT_NAME"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"TinyRendererBasePass\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\tView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"UnscaledViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ERDGPassFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Raster"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshBatches"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FDynamicPassMeshDrawListContext"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" DynamicMeshPassContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 省略。パスの実装"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"特にリソース管理を人間が書かなくていいのは大きな利点と言えるでしょう。 注意点として、RDG が管理しているリソース(特に ~Ref みたいな型のリソース)はパスの外側ではまだ確保されていないことが普通です。そのため、リソースの実体にアクセスするためには AddPass や AddSimpleMeshPass などのパス実装の中で行う必要があります。\nRDG はパスとそれが必要とするリソースを紐づけて管理することで、リソースを最適化するため、。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"つまり、RDG で定義したパラメータ構造体を RDG パスに渡すというのは、構造体に含まれるリソースをメタデータをもとに列挙させ、必要に応じてリソースを確保・解放してもらうということになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"meshbatch-の描画命令を発行する-meshpassprocessor"},children:[{type:"element",tag:"a",props:{href:"#meshbatch-%E3%81%AE%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B-meshpassprocessor",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"MeshBatch の描画命令を発行する MeshPassProcessor"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、CPU 側でのメッシュの準備と、GPU 側でそれを処理するシェーダーが準備できたので、それらを使って描画パスを発行する MeshPassProcessor を作成します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ftinyrendererbasepassmeshprocessor"},children:[{type:"element",tag:"a",props:{href:"#ftinyrendererbasepassmeshprocessor",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FTinyRendererBasePassMeshProcessor"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FTinyRendererBasePassMeshProcessor"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","base-clause"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMeshPassProcessor"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FTinyRendererBasePassMeshProcessor"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FSceneView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                   FMeshPassDrawListContext"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InDrawListContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FMeshPassProcessor"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetFeatureLevel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InView"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InDrawListContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t  "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FeatureLevel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetFeatureLevel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* メッシュ描画時の RenderState を設定。パイプラインの挙動を制御することになる *\u002F"}]},{type:"text",value:"\n\t\tPassDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetBlendState"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TStaticBlendState"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRHI"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tPassDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDepthStencilAccess"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FExclusiveDepthStencil"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"DepthWrite_StencilWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tPassDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDepthStencilState"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TStaticDepthStencilState"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRHI"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* この MeshPassProcessor を通じて指定された MeshBatch のメッシュ描画コマンドをコマンドリストに追加する処理 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryAddMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" uint64 BatchElementMask"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FPrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterial"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                     "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 StaticMeshId"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* MeshBatch が利用する VertexFactory を取得 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FVertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" VertexFactory "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactory"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tTMeshProcessorShaders"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderVS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FTinyRendererShaderPS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" TinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* MeshBatch が利用する ShaderType を登録 *\u002F"}]},{type:"text",value:"\n\t\tFMaterialShaderTypes ShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddShaderType"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderVS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddShaderType"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderPS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 上で登録した ShaderType と MeshBatch に割り当てられたマテリアルをもとに、実際に利用するシェーダーコードたちを取得 *\u002F"}]},{type:"text",value:"\n\t\tFMaterialShaders Shaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FVertexFactoryType"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" VertexFactoryType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" VertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetType"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetShaders"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VertexFactoryType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Shaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 頂点シェーダーとピクセルシェーダーを取得 *\u002F"}]},{type:"text",value:"\n\t\tShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetVertexShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"TinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetPixelShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"TinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"PixelShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* メッシュ描画時の RenderState を設定 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshPassProcessorRenderState "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"DrawRenderState"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PassDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\tFMeshMaterialShaderElementData ShaderElementData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tShaderElementData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"InitializeMeshMaterialData"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewIfDynamicMeshCommand"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t                                             MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" StaticMeshId"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshDrawCommandSortKey SortKey "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CalculateMeshStaticSortKey"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t\tTinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" TinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"PixelShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ラスタライザの FillMode と CullMode を設定 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshDrawingPolicyOverrideSettings OverrideSettings "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ComputeMeshOverrideSettings"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" ERasterizerFillMode MeshFillMode "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ComputeMeshFillMode"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OverrideSettings"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" ERasterizerCullMode MeshCullMode "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ComputeMeshCullMode"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OverrideSettings"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* MeshBatch に対応する描画コマンドを作成し、内部でコマンドリストに追加 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BuildMeshDrawCommands"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t\tMeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tBatchElementMask"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tPrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tMaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tMaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tTinyRenderPassShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tMeshFillMode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tMeshCullMode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tSortKey"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tEMeshPassFeatures"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Default"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tShaderElementData"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"virtual"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshBatch"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                          "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" uint64 BatchElementMask"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                          "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FPrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                          "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 StaticMeshId "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"override"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" MaterialRenderProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"while"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterial"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" MaterialResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetMaterialNoFallback"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t\tMaterialResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryAddMeshBatch"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"MeshBatch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" BatchElementMask"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t                                    "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" StaticMeshId"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"break"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 最初に取得したマテリアルが利用できなかったりコマンドの作成に失敗した場合は、Fallback のマテリアルを試す。"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\t\t\t   Fallback のマテリアルがない場合には nullptr が返るので、ループを抜ける *\u002F"}]},{type:"text",value:"\n\t\t\tMaterialRenderProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" MaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetFallback"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"private"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\tFMeshPassProcessorRenderState PassDrawRenderState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tERHIFeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Type FeatureLevel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"MeshPassProcessor は、UE が提供する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshPassProcessor"}]},{type:"text",value:" を継承して作成するもので、シェーダーとそのパラメータをもとにメッシュ描画コマンドを発行します。詳細は"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2\u002F#%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"前回記事"}]},{type:"text",value:"および"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fdev.epicgames.com\u002Fdocumentation\u002Fja-jp\u002Funreal-engine\u002Fmesh-drawing-pipeline-in-unreal-engine#fmeshpassprocessor",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"公式ドキュメント"}]},{type:"text",value:"を参考にしてください。\nここで発行されたメッシュ描画コマンドが、更に RHI コマンド、プラットフォーム API へと変換され GPU に送信されることで描画が行われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshPassProcessor"}]},{type:"text",value:" には GPU のメッシュ描画バイプラインを設定するための便利な機能が多数用意されています。DepthStencil、BlendState、FillMode、CullMode などの設定を行うことで、描画の挙動を制御することができます。\nまた、上記の実装では、USF によるシェーダー実装とマテリアルをあわせて利用する方法も示されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"bp-ラッパーの作成"},children:[{type:"element",tag:"a",props:{href:"#bp-%E3%83%A9%E3%83%83%E3%83%91%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"BP ラッパーの作成"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"作成したレンダラを BP から利用するためのラッパーを作成します。\n基本的には単なる BP 向けクラスなのですべては解説しませんが、特に参考になりそうな部分のみ解説します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"api-の定義"},children:[{type:"element",tag:"a",props:{href:"#api-%E3%81%AE%E5%AE%9A%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"API の定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下のような単純な API の BP クラスを作成しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UCLASS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"BlueprintType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"STATICMESHRENDERER_API"}]},{type:"text",value:" UTinyRenderer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" UObject\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GENERATED_BODY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* レンダーターゲットを指定して TinyRenderer を作成 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UFUNCTION"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"BlueprintCallable"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Tiny Renderer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\tmeta "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"AutoCreateRefTerm "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"BackgroundColor\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" WorldContext "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"WorldContextObject\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" UTinyRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UObject"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" WorldContextObject"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                         UTextureRenderTarget2D"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 描画する StaticMesh をセット *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UFUNCTION"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"BlueprintCallable"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Static Mesh Renderer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetStaticMesh"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" int32 LODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTransform"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InTransform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 描画を行う *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UFUNCTION"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"BlueprintCallable"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Static Mesh Renderer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* カメラの設定 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"BlueprintReadWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Static Mesh Renderer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tFMinimalViewInfo ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"private"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 省略"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"カメラ設定-fminimalviewinfo-から-viewfamily-の構築"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%AB%E3%83%A1%E3%83%A9%E8%A8%AD%E5%AE%9A-fminimalviewinfo-%E3%81%8B%E3%82%89-viewfamily-%E3%81%AE%E6%A7%8B%E7%AF%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"カメラ設定 (FMinimalViewInfo) から ViewFamily の構築"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE では、描画には ViewFamily という構造体が必要です。今回作成したレンダラでも、共通した ViewFamily の設定に基づいて描画を行うように実装していました。\nViewFamily を構築するにあたっても、よく利用するカメラ設定と共通の項目で設定できたほうが便利です。そこで、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMinimalViewInfo"}]},{type:"text",value:" という構造体を設定項目として受け付けるようにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMimalViewInfo"}]},{type:"text",value:" も UE が提供している View 設定の構造体で、以下のような内容を持ちます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"struct"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMinimalViewInfo"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GENERATED_USTRUCT_BODY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F** Location *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"EditAnywhere"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" BlueprintReadWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:"Camera"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tFVector Location"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F** Rotation *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"EditAnywhere"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" BlueprintReadWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:"Camera"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tFRotator Rotation"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F** The horizontal field of view (in degrees) in perspective mode (ignored in orthographic mode). *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"EditAnywhere"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" BlueprintReadWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:"Camera"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float"}]},{type:"text",value:" FOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F** The originally desired horizontal field of view before any adjustments to account for different aspect ratios *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Transient"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float"}]},{type:"text",value:" DesiredFOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F** The desired width (in world units) of the orthographic view (ignored in Perspective mode) *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UPROPERTY"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"EditAnywhere"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" BlueprintReadWrite"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Category"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:"Camera"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"float"}]},{type:"text",value:" OrthoWidth"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:" 以下省略\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このように、よく見る UE のカメラ設定と同じような項目を持っていることがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"utinyrendererrenderer"},children:[{type:"element",tag:"a",props:{href:"#utinyrendererrenderer",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UTinyRenderer::Renderer"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UTinyRenderer は、内部で FTinyRenderer オブジェクトを保持しています。 UTinyRenderer::Renderer では FTinyRenderer の Render を呼び出すことで描画を行いますが、それ以外にも ViewFamily の初期化や RDGBuilder の作成と実行といった重要な処理を行っています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SCOPED_NAMED_EVENT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UTinyRenderer_Render"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FColor"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Green"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"StaticMesh "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"||"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UE_LOG"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LogTemp"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Warning"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"UStaticMeshRenderBP::RenderStaticMesh: Invalid parameters\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RenderTaget から 描画リソースを取得 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTextureRenderTargetResource"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTargetResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GameThread_GetRenderTargetResource"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ViewFamily オブジェクトの作成 *\u002F"}]},{type:"text",value:"\n\tFSceneViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"ConstructionValues "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ConstructionValues"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderTargetResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FEngineShowFlags"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ESFIM_Game"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tConstructionValues"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetTime"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FGameTime"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetTimeSinceAppStart"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tTUniquePtr"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FSceneViewFamilyContext"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" ViewFamily "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MakeUnique"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FSceneViewFamilyContext"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ConstructionValues"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* ScreenPercentage の無効化 *\u002F"}]},{type:"text",value:"\n\tViewFamily"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"EngineShowFlags"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ScreenPercentage "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewFamily"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetScreenPercentageInterface"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FLegacyScreenPercentageDriver"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* MinimalViewInfo から ViewInitOptions を作成 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FIntRect "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ViewRect"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"SizeX"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"SizeY"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFSceneViewInitOptions ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetViewRectangle"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewFamily "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Get"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewOrigin "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Location"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewRotationMatrix "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FMatrix"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DesiredFOV "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 投影行列を計算し、ViewInitOptions に設定 *\u002F"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMinimalViewInfo"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CalculateProjectionMatrixGivenViewRectangle"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              AspectRatio_MaintainYFOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ENQUEUE_RENDER_COMMAND"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FStaticMeshRenderCommand"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"ViewFamily "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MoveTemp"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" LODIndex "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" LODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" StaticMesh "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" StaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshTransform "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Transform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tFRHICommandListImmediate"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"mutable"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SCOPED_NAMED_EVENT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FStaticMeshRenderCommand_Render"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FColor"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Green"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* TinyRenderer オブジェクトの作成 *\u002F"}]},{type:"text",value:"\n\t\t\tFTinyRenderer "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Renderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RenderThread で ViewFamily の初期化を完了 *\u002F"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRendererModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateAndInitSingleView"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Get"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RDGBuilder の作成 *\u002F"}]},{type:"text",value:"\n\t\t\tFRDGBuilder "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GraphBuilder"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t                         "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RDG_EVENT_NAME"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"StaticMeshRender\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t                         ERDGBuilderFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"AllowParallelExecute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* StaticMesh の設定 *\u002F"}]},{type:"text",value:"\n\t\t\tRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetStaticMesh"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"StaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" LODIndex"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" MeshTransform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ToMatrixWithScale"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t\t\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 作成したレンダラによる描画処理の登録 *\u002F"}]},{type:"text",value:"\n\t\t\tRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* RDGBuilder による RHI コマンドの発行と実行 *\u002F"}]},{type:"text",value:"\n\t\t\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Execute"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"BP から設定された MinimalViewInfo には、投影モードや FOV などの情報が含まれています。これをもとに、 FSceneViewInitOptions という View 初期化オプション構造体を作成します。一部は手動で設定する必要がありますが、投影行列の計算といった複雑な部分は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMinimalViewInfo::CalculateProjectionMatrixGivenViewRectangle"}]},{type:"text",value:" を使って自動的に設定することができます。\nまた、これを利用することによって、UE のカメラと同じような挙動をさせることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ENQUEUE_RENDER_COMMAND"}]},{type:"text",value:" マクロで囲まれた部分は、次の RenderThread 処理で実行するように予約される部分です。 ViewFamily の完全な初期化は RenderThread で行う必要があるため、こちらで書かれています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、RGDBuilder や FTinyRenderer のオブジェクトもここで作成しています。これらは毎フレーム作成され、フレームの終了で破棄されるということです。\n最後には RDGBuilder に登録された描画処理を下に RHI コマンドの発行が行われます。\nこのように見ると、今回書いたレンダラは RDGBuilder に描画処理の登録を行うものであり、実際のコマンドの発行は RDGBuilder に任せていることがよくわかります。パスに関わるコマンドが一度 RDGBuilder に登録され、最後にまとめてコマンドを発行する仕組みになっていることで、不要な処理の最適化や、任意のリソースがどの期間存在していなければならないかの決定をすることができるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"パフォーマンスの検証"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E6%A4%9C%E8%A8%BC",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"パフォーマンスの検証"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"簡単にですが、作成したレンダラのパフォーマンスを検証してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下の3つを比較してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ol",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SceneCaptureComponent2D による描画 (よくやるやつ)"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"以前作成した FPreviewScene による描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"今回作成した単一パスレンダラ(TinyRenderer)の描画"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"その他詳細は以下のとおりです。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Win64 Development Build"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"描画サイズは 500x500 で描画"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"サンプルのメッシュは\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Triangles: 19382"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Vertices: 11556"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Materials: 1"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SceneCapture2D は SceneColor with SceneDepth をキャプチャし、マテリアルを使って深度で背景抜き。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FPreviewScene は FPreviewScene でレンダリング後、背景抜き。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"TinyRenderer レンダリングしてそのまま表示 (RenderTarget の ClearColor を透明にしているので背景が描画されず、抜く必要がない)"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"セットアップが雑で(特に SceneCapture2D は制御がしにくいため)少しずつ見た目が違いますが、調整すればほぼ同じ見た目にすることは可能と思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"比較"},children:[{type:"element",tag:"a",props:{href:"#%E6%AF%94%E8%BC%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"比較"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"検証環境は以下のとおりです。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"CPU: Ryzen 9 3900X 12-Core Processor"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"RAM: 128GB"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"GPU: GeForce RTX 3080 10GB"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"nsight-graphics-の-scrubber-を眺める"},children:[{type:"element",tag:"a",props:{href:"#nsight-graphics-%E3%81%AE-scrubber-%E3%82%92%E7%9C%BA%E3%82%81%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Nsight Graphics の Scrubber を眺める"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まずは、こんな比較画面のフレームを計測してみます。\n"},{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002Fcompare.png"},children:[]},{type:"text",value:"\nViewportSize: 1920x1080"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Nsight Graphics の Scrubber を使って、フレーム内の描画処理を見てみます。\n"},{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002Fnsight-scrubber.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"注意: この横軸は時間ではありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"b",props:{style:"color: blue"},children:[{type:"text",value:"青領域"}]},{type:"text",value:": メインのViewportの描画処理"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"b",props:{style:"color: red"},children:[{type:"text",value:"赤領域"}]},{type:"text",value:": SceneCapture2D による描画処理"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"b",props:{style:"color: yellow"},children:[{type:"text",value:"黃領域"}]},{type:"text",value:": FPreviewScene による描画処理"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"b",props:{style:"color: green"},children:[{type:"text",value:"緑領域"}]},{type:"text",value:": TinyRenderer による描画処理"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なんというか、驚異的です。メインの Viewport が最も大きな部分を占めているのは当然として、SceneCaptrue2D と FPreviewScene もそれなりに目立つ大きさで表示されています。また、処理内容としてもメインの Viewport と類似していて、Scene に対する一通りの描画処理が行われていそうなことがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"いっぽう、TinyRenderer はもはや Scrubber 上ではほとんど見えないほどに小さな処理で済んでいることが伺えます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"フレーム内処理時間の比較"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E5%86%85%E5%87%A6%E7%90%86%E6%99%82%E9%96%93%E3%81%AE%E6%AF%94%E8%BC%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"フレーム内処理時間の比較"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"次に、各描画処理の処理時間を比較してみます。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"描画手法"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"処理時間"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"フレーム内における割合"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"SceneCapture2D"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"4.12 ms"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"17.4 %"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"FPreviewScene"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"1.11 ms"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"4.7 %"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"TinyRenderer"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"0.02 ms (16.38 μs)"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"0.1 %"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"メインの Viewport(参考)"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"約 13 ms"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"約 55 %"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"処理速度の面でも TinyRenderer が優位に立っています。また、詳しく計測していませんが、TinyRenderer は描画先の RenderTarget と Depth しか利用しないので、リソース面の優位性もあると思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"もちろん、他の描画手法も BasePass の該当メッシュの描画処理だけ抜き出せば TinyRenderer と同等程度の処理時間しかかかっていません。"}]},{type:"text",value:" 冒頭の繰り返しになりますが、TinyRenderer は凄いことをしているわけではありません。 ただ、なにぶん標準の方法は単一メッシュ描画には不要な処理がほとんどすべてを占めてしまっており、それらを局所的に OFF にしたりすることにも限界があるため、全体としての処理時間が大きくなってしまっているのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"いっぱい描画したときの-fps-の比較"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%84%E3%81%A3%E3%81%B1%E3%81%84%E6%8F%8F%E7%94%BB%E3%81%97%E3%81%9F%E3%81%A8%E3%81%8D%E3%81%AE-fps-%E3%81%AE%E6%AF%94%E8%BC%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"いっぱい描画したときの FPS の比較"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この比較は FPreviewScene と TinyRenderer のみを対象に行いました。\nSceneCapture2D は描画したい数だけレベル上に Actor を配置する必要があるので、そもそも個別にメッシュを大量にレンダリングするのが大変すぎて検証からはずしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"画面は以下のように、10x10 で 100 個の StaticMesh を個別に描画し、毎フレーム描画するようにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3\u002F\u002F10x10.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下が FPS の比較結果です。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"描画手法"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"平均 FPS"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"TinyRenderer"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"43.0 FPS"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"FPreviewScene"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"2.2 FPS"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"SceneCapture2D"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"100 個配置してRenderTarget設定するやつ作るの面倒すぎて検証してない"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"やはり、 FPS にも大きな差が出ました。TinyRenderer は 2万ポリゴン近いメッシュを 100 個描画しても 40 FPS 程度で安定しているので、軽量なメッシュをインベントリで並べて表示するくらいの用途では十分な速度が得られると思われます。\nいっぽう、 "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer\u002F#%E7%8B%AC%E8%87%AA%E3%81%AE%E5%B0%82%E7%94%A8%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%8B",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"FPreviewScene"}]},{type:"text",value:" は設定によって SceneCapture2D よりは軽量であるはずですが、実用的な速度にはなりませんでした。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"さらなる改善可能性"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E6%94%B9%E5%96%84%E5%8F%AF%E8%83%BD%E6%80%A7",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"さらなる改善可能性"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"opaque-以外の-blendmode-の対応"},children:[{type:"element",tag:"a",props:{href:"#opaque-%E4%BB%A5%E5%A4%96%E3%81%AE-blendmode-%E3%81%AE%E5%AF%BE%E5%BF%9C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Opaque 以外の BlendMode の対応"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"現在、TinyRenderer は Opaque な BlendMode のマテリアルのみをサポートしています。半透明等の BlendMode もサポートするためには、ピクセルシェーダーの実装を変更する必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ライティングの拡張"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A9%E3%82%A4%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%AE%E6%8B%A1%E5%BC%B5",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ライティングの拡張"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"現在は一つの DirectionalLight のみをサポートしています。また、パラメータも固定されています。ピクセルシェーダーの変更によって、複数のライトやポイントライト、スポットライトなどのライトのサポートを追加することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"shader-permutaion-の最適化"},children:[{type:"element",tag:"a",props:{href:"#shader-permutaion-%E3%81%AE%E6%9C%80%E9%81%A9%E5%8C%96",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Shader Permutaion の最適化"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"TinyRenderer のための MeshMaterialShader は、TinyRenderer で描画を行わないマテリアルなどに対しても組み合わせが作成されてしまいます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"何らかの方法で、TinyRenderer で利用したいマテリアルのみを設定できれば、TinyRenderer のためにシェーダーコンパイル時間が伸びる懸念を解消できますし、レンダラのシェーダーを変更したときの作業のイテレーションも早くなります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"パフォーマンスの改善"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%91%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%B3%E3%82%B9%E3%81%AE%E6%94%B9%E5%96%84",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"パフォーマンスの改善"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すでに十分に高速ではありますが、主に CPU 側での描画コマンドの発行についてはまだ最適化の余地があります。というのも、現在の実装では毎フレーム MeshBatch や MeshDrawCommand の作成を1から行っています。\nこれらについては、フレームをまたいで再利用を行う実装を考えることは十分に可能であり、(実際にエンジンの StaticMesh を使ったシーン描画はそのようになっており)、さらなるパフォーマンスの向上が期待できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回の記事では、シンプルな StaticMesh レンダラである TinyRenderer の紹介と、その実装方法について解説しました。TinyRenderer は目的のために必要なこと以外を何もしないことで高速に動作します。\nUE の RHI や RDG、マテリアルといったグラフィックス機能は、エディタの背後で動くだけでなく、プラグイン実装のために柔軟に利用することができます。TinyRenderer の実装も、それらのお陰でかなりシンプルに実現されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"記事内でも触れましたが、TinyRenderer はあくまで単一メッシュの描画に特化したものであり、複数のメッシュやライト、半透明などの複雑な描画を行う場合には、通常の UE の描画パスを利用することが望ましいです。また、見た目に関しても通常の UE の描画パスとは完全に一致するわけではないため、その点も注意が必要です。\n単純に BP から制御してメッシュ描画を行いたい場合には、 FPreviewScene などの手法を取るのが適切と言えます。いくつかの個数のメッシュを少し表示したいだけであれば、 SceneCapture2D で頑張るのでも十分でしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"現時点では、技術的には可能でも実装していないことも多数あるため、今後気が向いたら改善していくかもしれません。よければ改造して遊んでみたり、Issue や PR を投げてもらえると楽しいので助かります。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-3",extension:".md",createdAt:"2024-04-10T00:00:00.000Z",updatedAt:"2024-04-10T00:00:00.000Z",gitCreatedAt:"2024-04-07T13:56:00.000Z",gitUpdatedAt:"2024-04-10T13:32:29.000Z"},{slug:"lets-implement-a-single-mesh-renderer-2",description:"アイテムの描画とか、一つだけのメッシュをレンダリングするのに便利なツールを実装してみる記事のその２。独自のメッシュパスを実装して単一パスの軽量なレンダラを書くのに必要なUnreal Engine の描画機能について解説する",title:"単一Static Meshレンダラを独自メッシュパスで実装する...ための前提知識編",enforceCreatedAt:"2023\u002F12\u002F25",enforceUpdatedAt:"2023\u002F12\u002F25",tags:["Unreal Engine","Unreal C++","RHI","RDG","Advent Calendar"],assets:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-2",advent_calendar:{name:"Unreal Engine (UE) Advent Calendar 2023",link:"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2023\u002Fue",day:17},toc:[{id:"fglobalshader",depth:2,text:"FGlobalShader"},{id:"fmaterialshader",depth:2,text:"FMaterialShader"},{id:"fmeshmaterialshader",depth:2,text:"FMeshMaterialShader"},{id:"rdg-を使った描画命令発行のボイラープレート",depth:2,text:"RDG を使った描画命令発行のボイラープレート"},{id:"rdg-によるリソースの取り扱い",depth:2,text:"RDG によるリソースの取り扱い"},{id:"リソースの作成",depth:3,text:"リソースの作成"},{id:"rdg-外部とのリソースのやりとり",depth:3,text:"RDG 外部とのリソースのやりとり"},{id:"基本的なパスの追加",depth:2,text:"基本的なパスの追加"},{id:"目的別のrdgパス追加ユーティリティ",depth:2,text:"目的別のRDGパス追加ユーティリティ"},{id:"fprimitivesceneproxy",depth:2,text:"FPrimitiveSceneProxy"},{id:"fmeshbatch",depth:2,text:"FMeshBatch"},{id:"fmeshpassprocessor",depth:2,text:"FMeshPassProcessor"},{id:"hlsl-への変換",depth:2,text:"HLSL への変換"},{id:"umaterial--umaterialinstance",depth:2,text:"UMaterial \u002F UMaterialInstance"},{id:"fmaterialrenderproxy",depth:2,text:"FMaterialRenderProxy"},{id:"fmaterial--fmaterialresource",depth:2,text:"FMaterial \u002F FMaterialResource"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"introduction"},children:[{type:"element",tag:"a",props:{href:"#introduction",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Introduction"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事は、昨日投稿した記事、『"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"単一 Static Meshレンダラを FPreviewScene で実装する"}]},{type:"text",value:"』の続編です。\n昨日の記事では、FPreviewScene という機能を利用し、裏に別の World \u002F Scene を用意して、そちらでメッシュをレンダリングする実験をしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"前回の手法には課題も多かったので、より単独メッシュのレンダリングに特化した独自のメッシュパスを追加することで、高速にメッシュ画像を得る記事を書こうと思いました。\nしかし、その実装を説明するための前提知識が多いので、まずは前提知識編を書きます。UE がメッシュをレンダリングする機構についてまとめるので、よければ参考にしてください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"(これは UE アドカレ 2023 に12\u002F25に投稿した記事です！　空いてた過去枠にタイムリープ投稿しています)"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"目次"},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E6%AC%A1",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"目次"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#shader-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E6%89%B1%E3%82%8F%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%8B"},children:[{type:"text",value:"Shader はどうやって扱われるのか？"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fglobalshader"},children:[{type:"text",value:"FGlobalShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmaterialshader"},children:[{type:"text",value:"FMaterialShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmeshmaterialshader"},children:[{type:"text",value:"FMeshMaterialShader"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E8%A8%AD%E5%AE%9A"},children:[{type:"text",value:"シェーダーのコンパイル設定"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E9%A0%82%E7%82%B9%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E3%81%91%E6%B8%A1%E3%81%97"},children:[{type:"text",value:"頂点データの受け渡し"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E5%91%BD%E4%BB%A4%E3%81%AE%E7%99%BA%E8%A1%8C"},children:[{type:"text",value:"グラフィックス命令の発行"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#rdg-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E7%99%BA%E8%A1%8C%E3%81%AE%E3%83%9C%E3%82%A4%E3%83%A9%E3%83%BC%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"},children:[{type:"text",value:"RDG を使った描画命令発行のボイラープレート"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#rdg-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E5%8F%96%E3%82%8A%E6%89%B1%E3%81%84"},children:[{type:"text",value:"RDG によるリソースの取り扱い"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90"},children:[{type:"text",value:"リソースの作成"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#rdg-%E5%A4%96%E9%83%A8%E3%81%A8%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E3%82%84%E3%82%8A%E3%81%A8%E3%82%8A"},children:[{type:"text",value:"RDG 外部とのリソースのやりとり"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%83%91%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0"},children:[{type:"text",value:"基本的なパスの追加"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E7%9A%84%E5%88%A5%E3%81%AErdg%E3%83%91%E3%82%B9%E8%BF%BD%E5%8A%A0%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3"},children:[{type:"text",value:"目的別のRDGパス追加ユーティリティ"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0"},children:[{type:"text",value:"メッシュレンダリング"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fprimitivesceneproxy"},children:[{type:"text",value:"FPrimitiveSceneProxy"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmeshbatch"},children:[{type:"text",value:"FMeshBatch"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmeshpassprocessor"},children:[{type:"text",value:"FMeshPassProcessor"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%A8%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E8%A1%A8%E7%8F%BE"},children:[{type:"text",value:"マテリアルとシェーダー、レンダースレッド表現"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#hlsl-%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B"},children:[{type:"text",value:"HLSL への変換"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#umaterial--umaterialinstance"},children:[{type:"text",value:"UMaterial \u002F UMaterialInstance"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmaterialrenderproxy"},children:[{type:"text",value:"FMaterialRenderProxy"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fmaterial--fmaterialresource"},children:[{type:"text",value:"FMaterial \u002F FMaterialResource"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%92%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%A7%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B"},children:[{type:"text",value:"マテリアルをシェーダーで利用する"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81"},children:[{type:"text",value:"まとめ"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"shader-はどうやって扱われるのか"},children:[{type:"element",tag:"a",props:{href:"#shader-%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E6%89%B1%E3%82%8F%E3%82%8C%E3%82%8B%E3%81%AE%E3%81%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Shader はどうやって扱われるのか？"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE には、Shader のコードや、それが利用するパラメータのリフレクション情報などをまとめた "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FShader"}]},{type:"text",value:" というクラスがあります。\nこのクラスの派生として、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FGlobalShader"}]},{type:"text",value:" や "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMaterialShader"}]},{type:"text",value:" などがあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fglobalshader"},children:[{type:"element",tag:"a",props:{href:"#fglobalshader",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FGlobalShader"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE でシェーダーを書くとき、最も利用するクラスだと思います。HLSL + C++ で完結する機能である場合にはとりあえずこれを使っておけば、VS, PS, CS はもちろん、GSなどのシェーダーも定義することができます。\n定義のためには RDG のマクロを活用すると楽に扱うことが可能で、次のサンプルのようにパラメータやエントリポイントを設定することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FBufferVisualizeShaderPS"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","base-clause"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FGlobalShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"DECLARE_GLOBAL_SHADER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBufferVisualizeShaderPS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_USE_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBufferVisualizeShaderPS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FGlobalShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BEGIN_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_REF"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FViewUniformShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FScreenPassTextureViewportParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutputViewport"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_INCLUDE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FSceneTextureShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_SAMPLER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SamplerState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Sampler"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RENDER_TARGET_BINDING_SLOTS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"END_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_GLOBAL_SHADER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBufferVisualizeShaderPS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FStaticMeshRendererShaders\u002FPrivate\u002FBufferVisualizeShader.usf\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                        "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"MainPS\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SF_Pixel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"BEGIN_SHADER_PARAMTER_STRUCT() などのマクロを使うと、その場にパラメータの構造体が宣言されます。単に構造体ができるだけではなく、変数名のリフレクションやメモリレイアウトの最適化なども行ってくれます。\nここで収集された名前はシェーダー内で値にアクセスするときのパラメータ名にもなるので、従来手動で行っていたバインド処理などを行わなくてよくなっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmaterialshader"},children:[{type:"element",tag:"a",props:{href:"#fmaterialshader",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMaterialShader"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これも "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FShader"}]},{type:"text",value:" の派生です。様々なシェーダータイプに対応している点は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FGlobalShader"}]},{type:"text",value:" と同様ですが、こちらは Material で記述されたノードグラフと組み合わせて使うためのベースクラスです。\nUE の Material は、ノードベースでシェーダーを書けるようにした機能です。背後では、Material が生成した HLSL コードを、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMaterialShader"}]},{type:"text",value:" で実装されたシェーダーが利用する形でレンダリングに使用されています。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMaterialShader"}]},{type:"text",value:" には、その組み合わせ部分をサポートするためのユーティリティが実装されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmeshmaterialshader"},children:[{type:"element",tag:"a",props:{href:"#fmeshmaterialshader",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMeshMaterialShader"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMaterialShader"}]},{type:"text",value:" を更に派生したクラスで、マテリアルを使いつつメッシュを描画することを目的とした機能が実装されています。\nUE には、レンダリング処理にメッシュ情報を渡すための処理を行う "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FVertexFactory"}]},{type:"text",value:" というクラスがあります。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMeshMaterialShader"}]},{type:"text",value:" は、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FVertexFactory"}]},{type:"text",value:" が提供する頂点バッファ情報やレイアウト情報をシェーダーのパラメータとしてバインディングすることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"シェーダーのコンパイル設定"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E8%A8%AD%E5%AE%9A",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"シェーダーのコンパイル設定"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FShader"}]},{type:"text",value:" の派生を実装するとき、そのシェーダーのコンパイル設定を行いたいことがあります。たとえば、.ush \u002F .usf 内のマクロの定義を変更したいとか、 コンパイル結果の検証を追加したいとかです。\nそのような場合には、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FShader"}]},{type:"text",value:" の以下の static メンバ関数をオーバーライドすることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Shader.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F** サブクラスでオーバーライドして、コンパイルが行われる直前にコンパイル環境を変更することができる。 *\u002F\nstatic void ModifyCompilationEnvironment(const FShaderPermutationParameters&, FShaderCompilerEnvironment&) {}\n\n\u002F** サブクラスでオーバーライドして、特定の並べ替えがコンパイルされるべきかどうかを決定することができる。 *\u002F\nstatic bool ShouldCompilePermutation(const FShaderPermutationParameters&) { return true; }\n\n\u002F** コンパイル結果が有効かどうかを判断するために、サブクラスでオーバーライドすることができる。 *\u002F\nstatic bool ValidateCompiledResult(EShaderPlatform InPlatform, const FShaderParameterMap& InParameterMap, TArray\u003CFString\u003E& OutError) { return true; }"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たとえば、 FGlobalShader を継承している場合に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"text",value:" をオーバーライドするとしたら、次のようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FGlobalShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FShaderCompilerEnvironment"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 親の実装も呼んであげる(任意)"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FGlobalShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ModifyCompilationEnvironment"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F Define を追加"}]},{type:"text",value:"\n\tOutEnvironment"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetDefine"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"SUPPORTS_ANISOTROPIC_MATERIALS\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ShouldCompilePermutaion"}]},{type:"text",value:" はかなり重要です。この関数の挙動によって、生成されるシェーダーの数に大きな影響が出る可能性があります。\nそもそも、Shader Permutation とは、シェーダー実装が適用対象、機能、プラットフォーム、ライトなど様々な使用方法で動作できるように、用途の組み合わせごとに微妙に異なるシェーダーを生成する仕組みのことです。\nUE のシェーダーには多数のマクロが利用されており、利用方法に合わせてマクロの値がスイッチするようになっています。これを知らずに運用すると、組み合わせ爆発によって膨大な数のシェーダーをコンパイルしてパッケージに含めることになってしまうこともあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ShouldCompilePermutaion"}]},{type:"text",value:" には、そのシェーダーのコンパイルが特定の条件下で必要かどうかを判定する実装を追加できます。以下は FMeshMaterialShader を継承しているときの実装例です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ShouldCompilePermutation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMeshMaterialShaderPermutationParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" FName "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"NAME_LocalVertexFactory"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"FLocalVertexFactory\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"MaterialDomain "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"=="}]},{type:"text",value:" MD_Surface"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:"\n\t\tParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"VertexFactoryType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"=="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FindVertexFactoryType"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"NAME_LocalVertexFactory"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この例では、利用している Vertex Factory(後述) が "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FLocalVertexFactory"}]},{type:"text",value:" で、利用しようとしているマテリアルにドメインが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Surface"}]},{type:"text",value:" であるときにだけコンパイルされるべきであるとしています。\nこれを設定しないと、本来利用しない or 利用できない使用方法に対しても無駄にシェーダー生成の組み合わせを増やしてしまうおそれがあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"頂点データの受け渡し"},children:[{type:"element",tag:"a",props:{href:"#%E9%A0%82%E7%82%B9%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%97%E3%81%91%E6%B8%A1%E3%81%97",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"頂点データの受け渡し"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"VertexFactory は、Vertex Shader が必要とする頂点データのリソースを提供してくれるもので、C++ \u002F HLSL の両方で提供されます。\nVertex Shader で行う処理はメッシュタイプによって違うので、 VertexFactory もメッシュにあわせて種類があります。\nたとえば、"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"StaticMesh\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FLocalVertexShader"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SkeletalMesh\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FGpuSkinVertexFactory"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"などです。これらは C++ クラスですが、次のようにして .ush と実装と関連付けることで、VertexShader への入力を定義します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"LocalVertexFactoryの例"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F\u002F C++ 側実装\nclass FLocalVertexFactory : public FVertexFactory\n{\n\tDECLARE_VERTEX_FACTORY_TYPE_API(FLocalVertexFactory, ENGINE_API);\n\t\u002F\u002F 略\n};\n\n\u002F\u002F .ush の関連付けを定義\nIMPLEMENT_VERTEX_FACTORY_TYPE(FLocalVertexFactory,\"\u002FEngine\u002FPrivate\u002FLocalVertexFactory.ush\",\n\t  EVertexFactoryFlags::UsedWithMaterials\n\t| EVertexFactoryFlags::SupportsStaticLighting\n\t| EVertexFactoryFlags::SupportsDynamicLighting\n\t| EVertexFactoryFlags::SupportsPrecisePrevWorldPos\n\t| EVertexFactoryFlags::SupportsPositionOnly\n\t| EVertexFactoryFlags::SupportsCachingMeshDrawCommands\n\t| EVertexFactoryFlags::SupportsPrimitiveIdStream\n\t| EVertexFactoryFlags::SupportsRayTracing\n\t| EVertexFactoryFlags::SupportsRayTracingDynamicGeometry\n\t| EVertexFactoryFlags::SupportsLightmapBaking\n\t| EVertexFactoryFlags::SupportsManualVertexFetch\n\t| EVertexFactoryFlags::SupportsPSOPrecaching\n\t| EVertexFactoryFlags::SupportsGPUSkinPassThrough\n\t| EVertexFactoryFlags::SupportsLumenMeshCards\n);"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すると、VertexShader で処理中のメッシュタイプに合わせた Vertex Factory の値を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FVertexFactoryInput"}]},{type:"text",value:" パラメータとして利用できるようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"VSでの入力例"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"\u002F\u002F この include で、自動的に VS が適用されているメッシュの VertexFactory が選択的に include される。\n#include \"\u002FEngine\u002FGenerated\u002FVertexFactory.ush\"\n\n\u002F\u002F FVertexFactoryInput の中身が利用している VertexFactory の定義になる\nvoid MainVS(FVertexFactoryInput Input, out float4 Position: SV_POSITION)\n{\n\t\u002F\u002F 略\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"VertexFactory のシェーダを書くときにはいくつかの「お約束」があり、ファクトリが提供すべき型の名前("},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FVertexFactoryInput"}]},{type:"text",value:"や"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FVertexFactoryIntermediates"}]},{type:"text",value:")や、関数の名前があります。\n名前が揃えられていることで、シェーダーに include させる VertexFactory シェーダーの切り替えで頂点データの取得処理を変化させることができるのです。そして、切り替えはUEのシェーダーシステムが自動的に行なってくれます。\nこれにより、様々なメッシュタイプごとに VertexShader を書かなくても、VertexFactory によって抽象化されたあとの頂点データへの処理だけを考えればよくなっているのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"グラフィックス命令の発行"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E5%91%BD%E4%BB%A4%E3%81%AE%E7%99%BA%E8%A1%8C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"グラフィックス命令の発行"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"シェーダーの定義方法を説明しましたが、それを使った命令の発行と実行を知らなければ描画を実行できません。\n現在 (UE5.3) のバージョンでは、 RDG (Rendering Dependency Graph) という機能があり、これを使うと便利に描画リソース管理や描画命令発行ができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"rdg-を使った描画命令発行のボイラープレート"},children:[{type:"element",tag:"a",props:{href:"#rdg-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%8F%8F%E7%94%BB%E5%91%BD%E4%BB%A4%E7%99%BA%E8%A1%8C%E3%81%AE%E3%83%9C%E3%82%A4%E3%83%A9%E3%83%BC%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"RDG を使った描画命令発行のボイラープレート"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RDG を使った描画機能の実装は、以下のボイラープレートから開始することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UTinyRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F Render() が GameThread で呼ばれる"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F -------"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ENQUEUE_RENDER_COMMAND マクロはラムダ式を RenderThread の実行キューに追加する"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ENQUEUE_RENDER_COMMAND"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FStaticMeshRenderCommand"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRHICommandListImmediate"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"mutable"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RenderThread で実行される。RHICmdList から GraphBuilder を作成する。"}]},{type:"text",value:"\n\t\t\tFRDGBuilder "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GraphBuilder"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t                         "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RDG_EVENT_NAME"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"StaticMeshRender\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t                         ERDGBuilderFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"AllowParallelExecute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ここでGraphBuilder を使って描画命令の発行(パスの追加とか)を行う"}]},{type:"text",value:"\n\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ↓ でBuilderが命令の発行を行う "}]},{type:"text",value:"\n\t\t\tGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Execute"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レンダースレッド実行時に渡されてくる RHICmdList とは、RHI (Rendering Hardware Interface) のコマンドバッファです。RHI はグラフィックス機能の抽象化レイヤで、ハードウェアやプラットフォームの差異をUEが吸収してくれているものです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RHI コマンドを RHICmdList に追加することで、描画処理を構築することができるのですが、RDG を使う場合は直接触れる機会が少し減ります。それは、RHI コマンドの構築は RDGBuilder が内部で行ってくれるからです。 RDGBuilder が提供する API を使って描画処理を記述すると、内部で処理のマージや並び替え、リソース管理命令の自動追加などを行った上で(DAGで実装されている)、適切なコマンドリストを生成してくれるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"rdg-によるリソースの取り扱い"},children:[{type:"element",tag:"a",props:{href:"#rdg-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E5%8F%96%E3%82%8A%E6%89%B1%E3%81%84",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"RDG によるリソースの取り扱い"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"リソースの作成"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"リソースの作成"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"例として、いくつかのリソースを RDG で作成してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F テクスチャの作成"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureDesc Desc "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FRDGTextureDesc"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Create2D"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RectSizeXY"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PF_DepthStencil"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFClearValueBinding"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"DepthFar"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" TexCreate_DepthStencilTargetable "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" TexCreate_ShaderResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureRef SceneDepth "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Desc"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"SceneDepthZ\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F バッファリソースとSRVの作成"}]},{type:"text",value:"\nTArray"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FVector4f"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" InstanceSceneDataSOA "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* データを書き込み *\u002F"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGBufferRef RDGInstanceSceneDataBuffer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateStructuredBuffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"InstanceSceneDataBuffer\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" InstanceSceneDataSOA"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nGPUScene"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"GPUSceneInstanceSceneData "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSRV"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RDGInstanceSceneDataBuffer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RDG マクロで定義したシェーダパラメータの作成"}]},{type:"text",value:"\nFTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PassParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AllocParameters"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"注意しなければいけないのは、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"RDG が管理するリソースが本当に確保されることが保証されるのは後述する RDG Pass の間だけである"}]},{type:"text",value:"ということです。上記の方法で作成したリソースは、宣言のようなものであり、実際の確保と開放は RDG が利用パスを検出して自動管理します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"rdg-外部とのリソースのやりとり"},children:[{type:"element",tag:"a",props:{href:"#rdg-%E5%A4%96%E9%83%A8%E3%81%A8%E3%81%AE%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%AE%E3%82%84%E3%82%8A%E3%81%A8%E3%82%8A",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"RDG 外部とのリソースのやりとり"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"もちろん、RDG 以外で確保されたリソースとの連携も可能です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 外部のテクスチャリソースを RDG リソースとして登録する"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTarget "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRDGTextureRef TinyRendererOutputRef "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RegisterExternalTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateRenderTarget"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRenderTargetTexture"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"TinyRendererOutput\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RDG 内部のテクスチャリソースを取り出す"}]},{type:"text",value:"\nTRefCountPtr"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"IPooledRenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" OutTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"QueueTextureExtraction"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RDGResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"OuteTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"外部のリソースはRDGに渡しても、そのまま外部で寿命を管理する必要があります。RDG から取り出したリソースは、スマートポインタとして取得されるので、スマートポインタの寿命が尽きるまでGPUリソースの寿命が延長され、RDGのスコープを考える必要はありません。\n1パスで処理を行う場合にはあまり使いませんが、ヒストリを利用したり、外部のRenderTagetに書き出したい場合などに便利です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"基本的なパスの追加"},children:[{type:"element",tag:"a",props:{href:"#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%83%91%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"基本的なパスの追加"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RDG を使ってパスを追加するときには、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GraphBuilder::AddPass()"}]},{type:"text",value:" を使うことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PassParameters "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AllocParameters"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FTinyRendererShaderParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\nGraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RDG_EVENT_NAME"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"MyPixelShaderPass\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Width"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Height"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tPassParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\tERDGPassFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Raster "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" ERDGPassFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"NeverCull"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"ResourceOne"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ResourceTwo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRHICommandList"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" RHICmdList"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F RHICmdList を操作して、レンダリングパス処理を追加する"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"AddPass にわたすラムダ式は、呼び出し時に RHICmdList が渡されてくるので、ここでは従来どおりRHICmdListを操作して描画処理を記述します。\nもちろん、RHICmdListを操作できるので従来どおり(RDG以前)の操作が自由にかけてしまうのですが、それは RDG Pass の意図ではありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RDG Pass では、引数に渡したパスパラメータに含まれる RDG リソースを検出し、GPUリソースの実体の確保を行ってくれます。そのため、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"AddPass のラムダの中ではパラメータのリソースを利用した処理を書くこと"}]},{type:"text",value:"が望まれます。逆に、本来パスに不要なパラメータを大量に渡してしまったりすると、本来必要ないリソースをパスのために RDG が確保してしまうリスクがあるので注意が必要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"目的別のrdgパス追加ユーティリティ"},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E7%9A%84%E5%88%A5%E3%81%AErdg%E3%83%91%E3%82%B9%E8%BF%BD%E5%8A%A0%E3%83%A6%E3%83%BC%E3%83%86%E3%82%A3%E3%83%AA%E3%83%86%E3%82%A3",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"目的別のRDGパス追加ユーティリティ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"GraphBuilder::AddPass()"}]},{type:"text",value:" はプリミティブなパス追加機能ですが、頻用の目的に対しては RDG がユーティリティ関数を用意しています。\nいくつかの関数の定義を紹介します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F テクスチャをコピーするパスを追加"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddCopyTexturePass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFRDGTextureRef InputTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFRDGTextureRef OutputTexture"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FRHICopyTextureInfo"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" CopyInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F スクリーンパス(指定したViewport全体を処理するパス)を追加する。Pixel Shader 画像を処理するのに便利。"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"template"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"PixelShaderType"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddDrawScreenPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFRDGEventName"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" PassName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FSceneView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FScreenPassTextureViewport"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" OutputViewport"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FScreenPassTextureViewport"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InputViewport"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" TShaderRef"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"PixelShaderType"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" PixelShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"PixelShaderType"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"FParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PixelShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tEScreenPassDrawFlags Flags "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" EScreenPassDrawFlags"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"None"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F メッシュパス(メッシュを処理するパス)を追加する。AddMeshBatchesCallback にメッシュ追加を行うコールバックを渡す。"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"template"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"PassParametersType"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"AddMeshBatchesCallbackLambdaType"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddSimpleMeshPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tPassParametersType"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PassParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" Scene"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FSceneView"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFInstanceCullingManager "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"InstanceCullingManager"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFRDGEventName"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" PassName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FIntRect"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" ViewPortRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tAddMeshBatchesCallbackLambdaType AddMeshBatchesCallback"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ComputeShader のパスを追加する。"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"template"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TShaderClass"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"inline"}]},{type:"text",value:" FRDGPassRef "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FComputeShaderUtils"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddPass"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FRDGBuilder"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" GraphBuilder"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFRDGEventName"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" PassName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" TShaderRef"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"TShaderClass"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" ComputeShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"TShaderClass"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"FParameters"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" Parameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t\t\t\tFIntVector GroupCount"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RDG では、繰り返し利用するパターンは積極的にユーティリティ化することが推奨されています。パス追加以外の部分にも豊富なユーティリティが内蔵されているので、一度 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RenderGraphUtils.h"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ScreenPass.h"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SimpleMeshDrawCommandPass.h"}]},{type:"text",value:" などは眺めておくとよいでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"メッシュレンダリング"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"メッシュレンダリング"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまで、シェーダーや描画命令の発行方法を見てきました。いよいよメッシュ表現とそれが描画に投入される流れについて見ていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fprimitivesceneproxy"},children:[{type:"element",tag:"a",props:{href:"#fprimitivesceneproxy",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FPrimitiveSceneProxy"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これはゲームスレッドの UPrimitiveComponent のミラーデータで、レンダースレッドで利用される「シーンに配置されて描画可能なもの」を表すオブジェクトです。\nComponent のタイプごとに存在し、SceneRenderer の要求を受けてメッシュデータをレンダラに提供したりしてくれます。UStaticMeshComponent \u002F FStaticMeshSceneProxy などデータソースとしてメッシュアセットを持つものは、メッシュアセットをソースとしてデータを提供することになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UPrimitiveComponent には "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateSceneProxy()"}]},{type:"text",value:" という仮想関数が定義されており、描画可能なコンポーネントを実装するときにはこれを実装する必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"FPrimitiveSceneProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" PrimitiveSceneProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" PrimitiveComponent"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateSceneProxy"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmeshbatch"},children:[{type:"element",tag:"a",props:{href:"#fmeshbatch",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMeshBatch"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FPrimitiveSceneProxy から取得されるメッシュデータのバッチです。内部に頂点データやマテリアル、利用すべき VertexFactory など、メッシュのレンダリングに必要なすべての情報を含んでいます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmeshpassprocessor"},children:[{type:"element",tag:"a",props:{href:"#fmeshpassprocessor",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMeshPassProcessor"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"メッシュ描画を扱うパスを定義するクラスです。派生クラスを定義し、MeshBatch, シェーダー, マテリアル取得などのセットアップを記述すると、FMeshDrawCommand というメッシュ描画用の命令を構築してくれます。\nFMeshDrawCommand はあとの段階で更に RHICommand に変換され、レンダリングが実行されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"動的パスを簡易に実行するだけならば、前述の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddSimpleMeshPass()"}]},{type:"text",value:" と組み合わせることで簡単にメッシュ描画パスを実行できます。\n以下はエンジン内の例です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"DepthRendering.cpp"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"AddSimpleMeshPass(GraphBuilder, PassParameters, Scene, View, &InstanceCullingManager, RDG_EVENT_NAME(\"ViewMeshElementsPass\"), View.ViewRect,\n\t[&View, Scene, DrawRenderState, &MeshElements, bRespectUseAsOccluderFlag, DepthDrawingMode](FDynamicPassMeshDrawListContext* DynamicMeshPassContext)\n\t{\n\t\tFDepthPassMeshProcessor PassMeshProcessor(\n\t\t\tEMeshPass::DepthPass,\n\t\t\tView.Family-\u003EScene-\u003EGetRenderScene(),\n\t\t\tView.GetFeatureLevel(),\n\t\t\t&View,\n\t\t\tDrawRenderState,\n\t\t\tbRespectUseAsOccluderFlag,\n\t\t\tDepthDrawingMode,\n\t\t\tfalse,\n\t\t\tfalse,\n\t\t\tDynamicMeshPassContext);\n\n\t\tconst uint64 DefaultBatchElementMask = ~0ull;\n\n\t\tfor (const FMeshBatch& MeshBatch : MeshElements)\n\t\t{\n\t\t\tPassMeshProcessor.AddMeshBatch(MeshBatch, DefaultBatchElementMask, nullptr);\n\t\t}\n\t}\n);"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FDepthMeshPassProcessor は FMeshPassProcessor の派生です。ここでは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddSimpleMeshPass()"}]},{type:"text",value:" の中で、MeshBatchを "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddMeshBatch()"}]},{type:"text",value:" することで描画コマンドを RHICommandList に追加しています。\nコード上に RHICommandList は直接見えませんが、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"DynamicMeshPassContext"}]},{type:"text",value:" の中にコンテキストのコマンドリストが保持されており、 FMeshPassProcessor がコマンドを追加してくれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"マテリアルとシェーダーレンダースレッド表現"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%A8%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E8%A1%A8%E7%8F%BE",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"マテリアルとシェーダー、レンダースレッド表現"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ご存知の通り、マテリアルアセットは、ノードベースに GPU で実行されるグラフィックス処理を記述できる機能です。\n当然ですが、 GPU にマテリアルノードを処理する機能は無いので、マテリアルから HLSL コードを生成しています。つまり、マテリアルは単なるグラフィカルなシェーダー言語であるということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"hlsl-への変換"},children:[{type:"element",tag:"a",props:{href:"#hlsl-%E3%81%B8%E3%81%AE%E5%A4%89%E6%8F%9B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"HLSL への変換"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"詳しくは述べませんが、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FHLSLMaterialTranslator"}]},{type:"text",value:" というクラスが変換を担っています。仕組みとしては、マテリアルのノードから多数の HLSL のコード片を組み立て、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MaterialTemplate.ush"}]},{type:"text",value:" というテンプレートファイルに当てはめることでマテリアルのシェーダーを生成しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ただし、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MaterialHLSLEmitter"}]},{type:"text",value:" という新しい HLSL 生成パイプラインの実装も始まっており、将来的には "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FHLSLMaterialTranslator"}]},{type:"text",value:" は非推奨のレガシーになるかもしれません。\n(大量の %s や %d を埋めていくテンプレート方式は正気でないと思っていたので納得ではあります)"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"umaterial--umaterialinstance"},children:[{type:"element",tag:"a",props:{href:"#umaterial--umaterialinstance",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UMaterial \u002F UMaterialInstance"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらは普段エディタで操作しているマテリアルアセットを表現しているクラスです。ユーザーに近いクラスで、マテリアルの編集データ及び生成済みのバイナリなどを保持します。\nUMaterial \u002F UMaterialInstance は継承関係にありませんが、どちらも UMaterialInterface というインターフェースを実装しています。　\nゲームスレッドで利用されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmaterialrenderproxy"},children:[{type:"element",tag:"a",props:{href:"#fmaterialrenderproxy",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMaterialRenderProxy"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マテリアルのレンダースレッド表現です。マテリアルパラメータを取得する機能などを実装しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fmaterial--fmaterialresource"},children:[{type:"element",tag:"a",props:{href:"#fmaterial--fmaterialresource",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FMaterial \u002F FMaterialResource"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こちらもマテリアルのレンダースレッド表現で、マテリアルの多くの設定やシェーダーマップを保持しています。\nFMaterialRenderProxy との違いがわかりにくいですが、コンポーネントとメッシュアセットの関係に近いです。メッシュアセットはメッシュデータを持ちますが、どこにどのように配置されるかはコンポーネントがデータを保持、決定します。\n同様に、FMaterial \u002F FMaterialResource はマテリアルの基本情報をすべて持っていますが、どのようなパラメータを与えて描画に利用されるかは FMaterialRenderProxy が決定します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"マテリアルをシェーダーで利用する"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%92%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%A7%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"マテリアルをシェーダーで利用する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FMaterialShader の派生として実装したシェーダーであれば、その内部でマテリアルが生成したシェーダーの結果にアクセスすることができます。\nつまり、FMaterialShader のシェーダーとマテリアルの生成したシェーダーとコンパイル時に組み合わせて、新たなシェーダーデータを生成しているということです。\nこれは、次のように書くことで実現できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 必要データ"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterial"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MaterialResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* *\u002F"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FMaterialRenderProxy"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" MaterialRenderProxy "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* *\u002F"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FVertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" VertexFactory "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* *\u002F"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F HLSL で実装した FMeshMaterialShader の派生シェーダー含んだ ShaderTypes を作成"}]},{type:"text",value:"\nFMaterialShaderTypes ShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddShaderType"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMyMaterialShaderVS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddShaderType"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMyMaterialShaderPS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ShaderTypes と VertexFactoryType をもとに、MaterialResource から実際に利用するシェーダーを取得"}]},{type:"text",value:"\nFMaterialShaders Shaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FVertexFactoryType"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" VertexFactoryType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" VertexFactory"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetType"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"MaterialResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetShaders"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ShaderTypes"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" VertexFactoryType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Shaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 無効な組み合わせだったり、コンパイルが終わっていなかったりすると失敗する"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\nTShaderRef"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMyMaterialShaderVS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" VertexShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nTShaderRef"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FMyMaterialShaderPS"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:" PixelShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F シェーダーを取り出す"}]},{type:"text",value:"\nShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetVertexShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"VertexShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\nShaders"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetPixelShader"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"PixelShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 以降でマテリアル + FMeshMaterialShader のシェーダーを利用できるようになる"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マテリアルを使ったシェーダーはエンジン改造なしでは書けないと思われることも多い気がするのですが、このようにすればマテリアルの生成したロジックを活用したグラフィック機能をプラグインなどで実装することも可能なのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事では、マテリアルをサポートした独自のメッシュパスを追加するために必要な前提知識を整理しました。ここに書いてある内容は、すべてプロジェクトやプラグインから利用可能なものです。\n次回はいよいよ、単一メッシュレンダラの実装を行います。12月中に出せたらいいな！"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer-2",extension:".md",createdAt:"2023-12-25T00:00:00.000Z",updatedAt:"2023-12-25T00:00:00.000Z",gitCreatedAt:"2023-12-25T13:29:24.000Z",gitUpdatedAt:"2023-12-25T13:53:18.000Z"},{slug:"lets-implement-a-single-mesh-renderer",description:"アイテムの描画とか、一つだけのメッシュをレンダリングするのに便利なツールを実装してみる記事",title:"単一 Static Meshレンダラを FPreviewScene で実装する",enforceCreatedAt:"2023\u002F12\u002F24",enforceUpdatedAt:"2023\u002F12\u002F24",tags:["Unreal Engine","Unreal C++","RHI","RDG","Advent Calendar"],assets:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer",advent_calendar:{name:"Unreal Engine (UE) Advent Calendar 2023",link:"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2023\u002Fue",day:24},toc:[{id:"ゲームと同じワールドでキャプチャしなければならない",depth:3,text:"ゲームと同じワールドでキャプチャしなければならない"},{id:"すぐに最適化の限界にぶち当たる",depth:3,text:"すぐに最適化の限界にぶち当たる"},{id:"アルファ抜きもハイコスト",depth:3,text:"アルファ抜きもハイコスト"},{id:"uworld--fscene",depth:2,text:"UWorld \u002F FScene"},{id:"fsceneview",depth:2,text:"FSceneView"},{id:"fsceneviewfamily",depth:2,text:"FSceneViewFamily"},{id:"fsceneviewfamilycontext",depth:3,text:"FSceneViewFamilyContext"},{id:"fscenerenderer",depth:2,text:"FSceneRenderer"},{id:"fpreviewscene",depth:2,text:"FPreviewScene"},{id:"createstaticmeshrenderer",depth:3,text:"CreateStaticMeshRenderer"},{id:"setstaticmesh",depth:3,text:"SetStaticMesh"},{id:"render",depth:3,text:"Render"},{id:"一旦使ってみる",depth:2,text:"一旦使ってみる"},{id:"背景を除去する",depth:2,text:"背景を除去する"},{id:"背景除去シェーダーを実装する",depth:3,text:"背景除去シェーダーを実装する"},{id:"モジュールにシェーダーのパスを通す",depth:3,text:"モジュールにシェーダーのパスを通す"},{id:"c-側のシェーダー対応実装を追加",depth:3,text:"C++ 側のシェーダー対応実装を追加"},{id:"作成したシェーダーを使ったパスを-sceneviewextension-で拡張機能化",depth:3,text:"作成したシェーダーを使ったパスを SceneViewExtension で拡張機能化"},{id:"extension-を適用する",depth:3,text:"Extension を適用する"},{id:"fscenepreview-を使ったメッシュレンダリングの所感",depth:2,text:"FScenePreview を使ったメッシュレンダリングの所感"},{id:"利点",depth:3,text:"利点"},{id:"欠点",depth:3,text:"欠点"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"introduction"},children:[{type:"element",tag:"a",props:{href:"#introduction",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Introduction"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine の売りの一つは広大なワールドを扱うことができるシステムや、それをリアルタイムにレンダリングする高度なグラフィックス機能です。しかし、常にそこまで高度なワールドシステムやレンダラが必要なわけではありません。\nたとえば、ゲームインベントリ画面でアイテムのメッシュをUI上に表示したい！みたいな需要はしばしばあるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この記事は、単一メッシュを描画するのに特化した描画をUEで実装してみる実験記録です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer\u002F\u002Ftop.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"目次"},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E6%AC%A1",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"目次"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E6%9C%AC%E9%A1%8C%E3%81%AE%E5%89%8D%E3%81%AB-%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E8%A7%A3%E6%B1%BA%E7%AD%96scenecapture2d%E3%81%A8%E3%81%9D%E3%81%AE%E5%95%8F%E9%A1%8C"},children:[{type:"text",value:"本題の前に: 一般的な解決策(SceneCapture2D)とその問題"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%A8%E5%90%8C%E3%81%98%E3%83%AF%E3%83%BC%E3%83%AB%E3%83%89%E3%81%A7%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%81%97%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84"},children:[{type:"text",value:"ゲームと同じワールドでキャプチャしなければならない"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%99%E3%81%90%E3%81%AB%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E9%99%90%E7%95%8C%E3%81%AB%E3%81%B6%E3%81%A1%E5%BD%93%E3%81%9F%E3%82%8B"},children:[{type:"text",value:"すぐに最適化の限界にぶち当たる"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E6%8A%9C%E3%81%8D%E3%82%82%E3%83%8F%E3%82%A4%E3%82%B3%E3%82%B9%E3%83%88"},children:[{type:"text",value:"アルファ抜きもハイコスト"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#ue-%E3%81%AE%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E7%99%BB%E5%A0%B4%E4%BA%BA%E7%89%A9%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B"},children:[{type:"text",value:"UE のレンダリングの登場人物を理解する"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#uworld--fscene"},children:[{type:"text",value:"UWorld \u002F FScene"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fsceneview"},children:[{type:"text",value:"FSceneView"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fsceneviewfamily"},children:[{type:"text",value:"FSceneViewFamily"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fsceneviewfamilycontext"},children:[{type:"text",value:"FSceneViewFamilyContext"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fscenerenderer"},children:[{type:"text",value:"FSceneRenderer"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%81%AE%E5%B0%82%E7%94%A8%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%8B"},children:[{type:"text",value:"独自の専用シーンを用意できないか？"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#fpreviewscene"},children:[{type:"text",value:"FPreviewScene"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fpreviewscene-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"},children:[{type:"text",value:"FPreviewScene を使ったレンダリングを実装してみる"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#createstaticmeshrenderer"},children:[{type:"text",value:"CreateStaticMeshRenderer"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#setstaticmesh"},children:[{type:"text",value:"SetStaticMesh"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#render"},children:[{type:"text",value:"Render"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E4%B8%80%E6%97%A6%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"},children:[{type:"text",value:"一旦使ってみる"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E8%83%8C%E6%99%AF%E3%82%92%E9%99%A4%E5%8E%BB%E3%81%99%E3%82%8B"},children:[{type:"text",value:"背景を除去する"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E8%83%8C%E6%99%AF%E9%99%A4%E5%8E%BB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B"},children:[{type:"text",value:"背景除去シェーダーを実装する"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%83%91%E3%82%B9%E3%82%92%E9%80%9A%E3%81%99"},children:[{type:"text",value:"モジュールにシェーダーのパスを通す"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#c-%E5%81%B4%E3%81%AE%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AF%BE%E5%BF%9C%E5%AE%9F%E8%A3%85%E3%82%92%E8%BF%BD%E5%8A%A0"},children:[{type:"text",value:"C++ 側のシェーダー対応実装を追加"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%91%E3%82%B9%E3%82%92-sceneviewextension-%E3%81%A7%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E5%8C%96"},children:[{type:"text",value:"作成したシェーダーを使ったパスを SceneViewExtension で拡張機能化"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#extension-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B"},children:[{type:"text",value:"Extension を適用する"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fscenepreview-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E6%89%80%E6%84%9F"},children:[{type:"text",value:"FScenePreview を使ったメッシュレンダリングの所感"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%88%A9%E7%82%B9"},children:[{type:"text",value:"利点"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E6%AC%A0%E7%82%B9"},children:[{type:"text",value:"欠点"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%81%A7"},children:[{type:"text",value:"ということで……"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"本題の前に-一般的な解決策scenecapture2dとその問題"},children:[{type:"element",tag:"a",props:{href:"#%E6%9C%AC%E9%A1%8C%E3%81%AE%E5%89%8D%E3%81%AB-%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E8%A7%A3%E6%B1%BA%E7%AD%96scenecapture2d%E3%81%A8%E3%81%9D%E3%81%AE%E5%95%8F%E9%A1%8C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"本題の前に: 一般的な解決策(SceneCapture2D)とその問題"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UI の上などにメッシュを描画したいときの一般的(？)な解決策は、 "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"SceneCapture2D"}]},{type:"text",value:" を利用することです。この手法については多くの情報があるため、説明はそちらに委ねます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fhistoria.co.jp\u002Farchives\u002F13380\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"[UE4]アルファ付きキャプチャー画像の簡単作成"}]},{type:"text",value:" - 株式会社ヒストリア様"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fyou1dan.hatenablog.com\u002Fentry\u002F2022\u002F09\u002F09\u002F113633",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"UE5 で Render Target と SceneCapture(Component)2D で背景透過でメッシュをキャプチャする"}]},{type:"text",value:" - You are done! 様"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この方法は大変簡便ですが、以下のような課題点があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ゲームと同じワールドでキャプチャしなければならない"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%81%A8%E5%90%8C%E3%81%98%E3%83%AF%E3%83%BC%E3%83%AB%E3%83%89%E3%81%A7%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3%E3%81%97%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ゲームと同じワールドでキャプチャしなければならない"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"SceneCapture2D をアクティブにするためには、配置したワールドと同じワールドにプレイヤーが存在しなければなりません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すると必然、地面の下など見えない場所に SceneCapture2D 用の撮影場所を用意してあげる必要が出てきます。ワールドのライティングやポストプロセスの影響を受けないように箱で囲ったり、ボリュームを設定したりなど、地味に面倒なセットアップが必要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、多数のレベルを持つゲームの場合には、すべてのレベルに撮影場所を配置してあげないとメッシュがレンダリングできず、煩雑です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"すぐに最適化の限界にぶち当たる"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%99%E3%81%90%E3%81%AB%E6%9C%80%E9%81%A9%E5%8C%96%E3%81%AE%E9%99%90%E7%95%8C%E3%81%AB%E3%81%B6%E3%81%A1%E5%BD%93%E3%81%9F%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"すぐに最適化の限界にぶち当たる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"SceneCapture2D を利用した状態は、通常の画面の他にもう一つ画面がある状態となります。単一メッシュを簡単に描画するだけなら、そこにかける処理コストは可能な限り削りたいでしょう。\nしかし当然ながら、SceneCapture2D で制御できるレンダリング機能は設定に表示されているものだけであり、最適化するにも限界があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"アルファ抜きもハイコスト"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E6%8A%9C%E3%81%8D%E3%82%82%E3%83%8F%E3%82%A4%E3%82%B3%E3%82%B9%E3%83%88",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"アルファ抜きもハイコスト"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"背景は不要な場合もあるので、SceneDepth や CustomStencil を使って背景を除去する必要があります。そのためにパスが増えてしまうと、さらなるコストが嵩んでいきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"ue-のレンダリングの登場人物を理解する"},children:[{type:"element",tag:"a",props:{href:"#ue-%E3%81%AE%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E7%99%BB%E5%A0%B4%E4%BA%BA%E7%89%A9%E3%82%92%E7%90%86%E8%A7%A3%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UE のレンダリングの登場人物を理解する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"後の実装法を理解するために、レンダリングの仕組みについて簡単に触れておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、以前作成した以下の資料の情報を踏まえるとより理解しやすくなると思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"script",props:{async:true,className:["docswell-embed"],src:"https:\u002F\u002Fwww.docswell.com\u002Fassets\u002Flibs\u002Fdocswell-embed\u002Fdocswell-embed.min.js",dataSrc:"https:\u002F\u002Fwww.docswell.com\u002Fslide\u002FK38NEM\u002Fembed",dataAspect:"0.5625"},children:[]},{type:"element",tag:"div",props:{className:["docswell-link"]},children:[]},{type:"text",value:"\n"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"uworld--fscene"},children:[{type:"element",tag:"a",props:{href:"#uworld--fscene",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UWorld \u002F FScene"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UWorld とは、AActor が配置されたり、マルチプレイが実行されたりする、UE のゲームロジックの進行を取りまとめるシーン表現オブジェクトです。「UWorld ← ULevel ← AActor ← UComponent」の関係性があり、ゲームスレッド側の処理に必要な全情報が含まれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FScene とは、レンダースレッド用のシーン表現オブジェクトです。FScene には描画すべきプリミティブ、ライト、デカールなどの情報が格納されます。FScene の情報は UWorld の変更に追従する形で更新されていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このように、ゲーム処理用とレンダリング処理用で個別のシーン表現を持っていることを理解する必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fsceneview"},children:[{type:"element",tag:"a",props:{href:"#fsceneview",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FSceneView"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FSceneView は、FScene 内部での視点を定義するオブジェクトです。シーン内での位置のほか、投影方法、ポストプロセス設定、利用するレンダリング機能のレベルなどを保持します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"普段利用する UE の機能でいうと、Camera に近いと言えるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fsceneviewfamily"},children:[{type:"element",tag:"a",props:{href:"#fsceneviewfamily",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FSceneViewFamily"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FSceneViewFamily は、 FScene や FSceneView などのオブジェクトを保持して取りまとめるオブジェクトです。FSceneViewFamily が保持する FScene は 1 つですが、FSceneView は1つ以上含むことができます。\nその Family 内のオブジェクトによるレンダリング全体に影響する描画設定なども含んでいます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"fsceneviewfamilycontext"},children:[{type:"element",tag:"a",props:{href:"#fsceneviewfamilycontext",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FSceneViewFamilyContext"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FSceneViewFamily の派生クラスで、スコープベースで FSceneView リソースを管理する機能を持っています。\n視点を追加するとき、 FSceneView の生ポインタを FSceneViewFamily に渡しますが、使い終わったタイミングで自分で片付ける必要があります。\nスコープで寿命が区切れる場合には、 FSceneViewFamilyContext を使っておくと、渡した FSceneView の管理を移譲できるので便利です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fscenerenderer"},children:[{type:"element",tag:"a",props:{href:"#fscenerenderer",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FSceneRenderer"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レンダラ実装の本体です。毎フレームこのインスタンスが生成\u002F破棄されます。\nFSceneViewFamily を受け取って、Family が含む Scene を、各 View について描画します。\n派生クラスとして以下のクラスがあり、モバイルプラットフォームとそれ以外とで切り替わるようになっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDeferredShadingSceneRenderer"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMobileSceneRenderer"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらのクラスの命名は致命的に誤解を招きやすいものであることに注意してください。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDeferredShadingSceneRenderer"}]},{type:"text",value:" はディファードレンダラだけでなく、フォワードレンダラも実装しています。\nまた、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FMobileSceneRenderer"}]},{type:"text",value:" も同様に、ディファード\u002Fフォワードの両方を実装しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"独自の専用シーンを用意できないか"},children:[{type:"element",tag:"a",props:{href:"#%E7%8B%AC%E8%87%AA%E3%81%AE%E5%B0%82%E7%94%A8%E3%82%B7%E3%83%BC%E3%83%B3%E3%82%92%E7%94%A8%E6%84%8F%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%81%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"独自の専用シーンを用意できないか？"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、前節で UE のレンダリングの登場人物を紹介しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"通常、UE 製のゲームは World も Scene も同時に1つしか持ちません。しかし、これは制約ではなく、自分で用意すれば同時に複数の World や Scene を運用することができます。\n独自にそれらが用意できれば、 SceneCapture2D の課題として挙げられたワールドが同一であるという問題が解決します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fpreviewscene"},children:[{type:"element",tag:"a",props:{href:"#fpreviewscene",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FPreviewScene"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ゼロから用意することもできるのですが、FPreviewScene クラスを利用すると簡単に World と Scene を用意することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実は、FPreviewScene クラスはいつもお世話になっているもので、アセットのサムネイルや、Unreal Editor 上のアセット編集画面などの Viewport をレンダリングするのに利用されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer\u002F\u002Ffpreviewscene.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"名前や用途からして Editor 専用機能のように思えますが、 Game でも使うことが可能で、World と Scene の初期化や管理をカプセル化したクラスとして活用できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"fpreviewscene-を使ったレンダリングを実装してみる"},children:[{type:"element",tag:"a",props:{href:"#fpreviewscene-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FPreviewScene を使ったレンダリングを実装してみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"BP から簡単に利用できるように、次のようなクラスを宣言します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"StaticMeshRenderer.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"UCLASS(BlueprintType)\nclass RENDERINGPRACTICE_API UStaticMeshRenderer : public UObject\n{\n\tGENERATED_BODY()\n\npublic:\n\t\u002F**\n\t * @brief StaticMeshRendererを作成する\n\t *\u002F\n\tUFUNCTION(BlueprintCallable, Category = \"Static Mesh Renderer\", meta = (AutoCreateRefTerm = \"BackgroundColor\"))\n\tstatic UStaticMeshRenderer* CreateStaticMeshRenderer(UTextureRenderTarget2D* RenderTarget, const FLinearColor& BackgroundColor);\n\n\t\u002F**\n\t * @brief StaticMeshとそのTransformを設定する\n\t *\u002F\n\tUFUNCTION(BlueprintCallable, Category = \"Static Mesh Renderer\")\n\tvoid SetStaticMesh(UStaticMesh* InStaticMesh, const FTransform& InTransform);\n\n\t\u002F**\n\t * @brief StaticMeshを1フレームだけ描画する。\n\t *\u002F\n\tUFUNCTION(BlueprintCallable, Category = \"Static Mesh Renderer\")\n\tvoid Render();\n\n\t\u002F**\n\t * @brief 描画するカメラの情報\n\t *\u002F\n\tUPROPERTY(BlueprintReadWrite, Category = \"Static Mesh Renderer\")\n\tFMinimalViewInfo ViewInfo;\n\nprivate:\n\t\u002F**\n\t * @brief 描画に使用するWorldとSceneを保持するFPreviewScene\n\t *\u002F\n\tTUniquePtr\u003CFPreviewScene\u003E RenderScene;\n\t\n\t\u002F**\n\t * @brief 描画先のRenderTarget\n\t *\u002F\n\tUPROPERTY()\n\tTObjectPtr\u003CUTextureRenderTarget2D\u003E RenderTarget;\n\n\t\u002F**\n\t * @brief 描画するStaticMesh\n\t *\u002F\n\tUPROPERTY()\n\tTObjectPtr\u003CUStaticMeshComponent\u003E StaticMeshComponent;\n\n\t\u002F**\n\t * @brief 背景色\n\t *\u002F\n\tFLinearColor BackgroundColor;\n};"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"それぞれの関数の実装を紹介しつつ説明します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"createstaticmeshrenderer"},children:[{type:"element",tag:"a",props:{href:"#createstaticmeshrenderer",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"CreateStaticMeshRenderer"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"単一メッシュレンダラのインスタンスを作成します。 FPreviewScene の初期化もここで行います。\nまた、描画先の RenderTarget もセットできるようにしておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"UStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UStaticMeshRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateStaticMeshRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UTextureRenderTarget2D"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                                                                   "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FLinearColor"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" BackgroundColor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tUStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" StaticMeshRenderer "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"NewObject"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"UStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetTransientPackage"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" NAME_None"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RF_Transient"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderScene "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MakeUnique"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FPreviewScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FPreviewScene"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ConstructionValues"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetEditor"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetLightRotation"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FRotator"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"304.736"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"39.84"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetSkyBrightness"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.69f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetCreatePhysicsScene"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t                                                            "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetTransactional"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"RenderTarget "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tStaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"BackgroundColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" BackgroundColor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" StaticMeshRenderer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"重要なのは、 FPreviewScene の構築パラメータに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:".SetEditor(false)"}]},{type:"text",value:" を渡すことです。こうすることで、Game時でも動作する World と Scene を内部で構築してくれます。\nライトの設定なども行うことができるので、実現したい見た目に対して調整すると良いでしょう。BP にパラメータとして公開してもいいかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"setstaticmesh"},children:[{type:"element",tag:"a",props:{href:"#setstaticmesh",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"SetStaticMesh"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"描画する StaticMesh をセットします。World に直接 StaticMesh は追加できないので、StaticMeshComponent を作成して Mesh をセットしてから追加します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UStaticMeshRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetStaticMesh"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UStaticMesh"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FTransform"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" InTransform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"StaticMeshComponent"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tStaticMeshComponent "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"NewObject"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"UStaticMeshComponent"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetWorld"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tRenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddComponent"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"StaticMeshComponent"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FTransform"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"Identity"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\tStaticMeshComponent"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetStaticMesh"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InStaticMesh"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tStaticMeshComponent"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetRelativeTransform"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"InTransform"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tRenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetScene"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UpdateStaticDrawLists"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"render"},children:[{type:"element",tag:"a",props:{href:"#render",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Render"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レンダリングを実行します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UStaticMeshRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Render"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"StaticMeshComponent "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"||"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"RenderTarget"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"UE_LOG"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"LogTemp"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Warning"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"UStaticMeshRenderBP::RenderStaticMesh: Invalid parameters\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n\tFTextureRenderTargetResource"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" RenderTargetResource "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GameThread_GetRenderTargetResource"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\tFSceneViewFamilyContext "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FSceneViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ConstructionValues"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tRenderTargetResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetScene"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FEngineShowFlags"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ESFIM_Game"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n  ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"EngineShowFlags"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"AntiAliasing "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"EngineShowFlags"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ScreenPercentage "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetScreenPercentageInterface"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FLegacyScreenPercentageDriver"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1.0f"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FIntRect "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ViewRect"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"SizeX"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderTarget"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"SizeY"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFSceneViewInitOptions ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SetViewRectangle"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewFamily "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewOrigin "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Location"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewRotationMatrix "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FInverseRotationMatrix"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Rotation"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FMatrix"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FPlane"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FPlane"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FPlane"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FPlane"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DesiredFOV "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"FOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"BackgroundColor "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" BackgroundColor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FMinimalViewInfo"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CalculateProjectionMatrixGivenViewRectangle"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewInfo"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              AspectRatio_MaintainYFOV"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              ViewRect"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t                                                              ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\tViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Views"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Add"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FSceneView"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ViewInitOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\tFCanvas "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Canvas"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"RenderTargetResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t               "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"nullptr"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t               RenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetWorld"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t               RenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetWorld"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetFeatureLevel"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t               FCanvas"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"CDM_DeferDrawing"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRendererModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BeginRenderingViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"Canvas"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"※ このコードでは省いていますが、実際には不要なポストプロセスやパスを切る設定を入れることができます"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"RenderTarget から取得した RHIリソース、カメラ設定から構築した FSceneView などを使って FSceneViewFamily を用意します。\nそれらを "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GetRendererModule().BeginRenderingViewFamily()"}]},{type:"text",value:" に渡すと、内部でプラットフォームに適した "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FSceneRenderer"}]},{type:"text",value:" を構築してレンダリングを実行してくれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"思ったよりずっと簡単なのではないでしょうか？"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"一旦使ってみる"},children:[{type:"element",tag:"a",props:{href:"#%E4%B8%80%E6%97%A6%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"一旦使ってみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下のBPグラフは、描画先の RenderTarget を Image Widget セットして StaticMesh が UI 上に表示されるようするサンプルです"}]},{type:"text",value:"\n"},{type:"element",tag:"iframe",props:{src:"https:\u002F\u002Fblueprintue.com\u002Frender\u002Ffrw9dthw\u002F",scrolling:"no",allowFullScreen:true,width:"100%",height:"500px"},children:[]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ViewInfo にカメラ設定、 Mesh に描画したい StaticMesh を入れています。ここでは少しずつ回転しながら毎フレーム描画されるようにしています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer\u002F\u002Ffirst.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ちゃんと描画されているようです！"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"背景を除去する"},children:[{type:"element",tag:"a",props:{href:"#%E8%83%8C%E6%99%AF%E3%82%92%E9%99%A4%E5%8E%BB%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"背景を除去する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"続いて、上で実装した描画機能に背景除去機能を拡張しましょう。ここでは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SceneViewExtension"}]},{type:"text",value:" という機能を使って描画のポストプロセスにパスを追加してみます。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SceneViewExtension"}]},{type:"text",value:" とは、主に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FSceneRenderer"}]},{type:"text",value:" のレンダリング処理への拡張を提供する仕組みのことで、様々なタイミングでGBufferにアクセスして値を読み書きすることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"背景除去シェーダーを実装する"},children:[{type:"element",tag:"a",props:{href:"#%E8%83%8C%E6%99%AF%E9%99%A4%E5%8E%BB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"背景除去シェーダーを実装する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まずはプロジェクトやプラグイン内に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Shaders\u002FPrivate\u002F"}]},{type:"text",value:" ディレクトリを作成し、以下のようなファイルを作成します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"BackgroundEraseShader.usf"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"#pragma once\n\n#include \"\u002FEngine\u002FPublic\u002FPlatform.ush\"\n#include \"\u002FEngine\u002FPrivate\u002FScreenPass.ush\"\n#include \"\u002FEngine\u002FPrivate\u002FCommon.ush\"\n\nSamplerState Sampler;\nSCREEN_PASS_TEXTURE_VIEWPORT(OutputViewport)\n\nstruct FInput\n{\n\tnoperspective float4 UVAndScreenPos: TEXCOORD0;\n\tfloat4 Position: SV_POSITION;\n};\n\nvoid BackgroundEraseMainPS(in FInput Input, out float4 OutColor: SV_Target0)\n{\n\tconst float2 ViewportUV = (Input.Position.xy - OutputViewport_ViewportMin.xy) * OutputViewport_ViewportSizeInverse.xy;\n\tconst float2 BufferUV = ViewportUVToBufferUV(ViewportUV);\n\n\tconst float Depth = Texture2DSample(SceneTexturesStruct.SceneDepthTexture, Sampler, BufferUV).r;\n\tconst float4 Color = Texture2DSample(SceneTexturesStruct.SceneColorTexture, Sampler, BufferUV);\n\n\tOutColor = float4(Color.rgb, Depth \u003E 0.0f ? 1.0f : 0.0f);\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"非常に単純なピクセルシェーダです。深度情報と色情報を両方 GBuffer からサンプルした上で、深度情報が書き込まれているピクセル以外の Alpha 値を 0 にしているだけです。\nこのピクセルシェーダによるパスを上で作成したレンダラの最後に接続することで背景を除去できますが、もうちょっと C++ 側での作業が必要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"モジュールにシェーダーのパスを通す"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%81%AE%E3%83%91%E3%82%B9%E3%82%92%E9%80%9A%E3%81%99",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールにシェーダーのパスを通す"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Module の Startup 時に、エンジンが認識する Shader ディレクトリを追加しておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FRenderingPracticeModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"StartupModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tIPluginManager"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" PluginManager "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"IPluginManager"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Get"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FString PluginShaderDir "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" PluginManager"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FindPlugin"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"RenderingPractice\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetBaseDir"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u002F"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Shaders\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddShaderSourceDirectoryMapping"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TEXT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FStaticMeshRendererShaders\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" PluginShaderDir"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"自分はプラグイン内に入れたので、プラグインのRootディレクトリから "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Shaders\u002F"}]},{type:"text",value:" のパスを決定し、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"StaticMeshRendererShadres\u002F"}]},{type:"text",value:" という別名を定義することにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"c-側のシェーダー対応実装を追加"},children:[{type:"element",tag:"a",props:{href:"#c-%E5%81%B4%E3%81%AE%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E5%AF%BE%E5%BF%9C%E5%AE%9F%E8%A3%85%E3%82%92%E8%BF%BD%E5%8A%A0",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"C++ 側のシェーダー対応実装を追加"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++ でシェーダーによる処理を呼び出せるようにするために、C++側の対応するクラスを作成する必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FBackgroundErasePS"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","base-clause"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FGlobalShader"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"DECLARE_GLOBAL_SHADER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBackgroundErasePS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_USE_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBackgroundErasePS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FGlobalShader"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BEGIN_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_REF"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FViewUniformShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" View"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FScreenPassTextureViewportParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" OutputViewport"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_STRUCT_INCLUDE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FSceneTextureShaderParameters"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SceneTextures"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"SHADER_PARAMETER_SAMPLER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"SamplerState"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Sampler"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RENDER_TARGET_BINDING_SLOTS"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"END_SHADER_PARAMETER_STRUCT"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_GLOBAL_SHADER"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"FBackgroundErasePS"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                        "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"\u002FStaticMeshRendererShaders\u002FPrivate\u002FBackgroundEraseShader.usf\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n                        "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"BackgroundEraseMainPS\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" SF_Pixel"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"最近の UE が採用している RDG のマクロを利用することで、パラメータ定義が非常に簡潔に行なえていることがわかります。\nこのシェーダーは、SceneView のパラメータ、出力先 Viewport、GBufferなど SceneTextures、テクスチャサンプラをパラメータとして渡すことで利用できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"作成したシェーダーを使ったパスを-sceneviewextension-で拡張機能化"},children:[{type:"element",tag:"a",props:{href:"#%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%91%E3%82%B9%E3%82%92-sceneviewextension-%E3%81%A7%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E5%8C%96",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"作成したシェーダーを使ったパスを SceneViewExtension で拡張機能化"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"上記のシェーダーを、ポストプロセスパスとして追加する SceneViewExtension を作成します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"StaticMeshRendererSceneViewExtension.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"struct FStaticMeshRendererSceneViewExtensionContext : FSceneViewExtensionContext\n{\nprivate:\n\tvirtual FName GetRTTI() const override;\n  {\n    return RTTIName;\n  }\npublic:\n\tinline static const FName RTTIName = TEXT(\"FStaticMeshRendererSceneViewExtensionContext\");\n};\n\nclass FStaticMeshRendererSceneViewExtension final : public FSceneViewExtensionBase\n{\npublic:\n\tFStaticMeshRendererSceneViewExtension(const FAutoRegister& AutoRegister);\n\t\n\tvirtual void SetupViewFamily(FSceneViewFamily& InViewFamily) override {}\n\tvirtual void SetupView(FSceneViewFamily& InViewFamily, FSceneView& InView) override {}\n\tvirtual void BeginRenderViewFamily(FSceneViewFamily& InViewFamily) override {}\n\t\n\tvirtual void SubscribeToPostProcessingPass(EPostProcessingPass Pass, FAfterPassCallbackDelegateArray& InOutPassCallbacks, bool bIsPassEnabled) override;\n\nprivate:\n\tstatic FScreenPassTexture AfterTonemapPass(FRDGBuilder& GraphBuilder, const FSceneView& View, const FPostProcessMaterialInputs& Inputs);\n};\n\nFStaticMeshRendererSceneViewExtension::FStaticMeshRendererSceneViewExtension(const FAutoRegister& AutoRegister):\n\tFSceneViewExtensionBase(AutoRegister)\n{\n\tFSceneViewExtensionIsActiveFunctor IsActiveFunctor;\n\n\tIsActiveFunctor.IsActiveFunction = [](const ISceneViewExtension* SceneViewExtension,\n\t                                      const FSceneViewExtensionContext& Context)\n\t{\n\t\treturn Context.IsA(FStaticMeshRendererSceneViewExtensionContext());\n\t};\n\n\tIsActiveThisFrameFunctions.Add(IsActiveFunctor);\n}\n\nvoid FStaticMeshRendererSceneViewExtension::SubscribeToPostProcessingPass(EPostProcessingPass Pass,\n                                                                          FAfterPassCallbackDelegateArray&\n                                                                          InOutPassCallbacks, bool bIsPassEnabled)\n{\n\tif (Pass == EPostProcessingPass::Tonemap)\n\t{\n\t\tInOutPassCallbacks.Add(\n\t\t\tFAfterPassCallbackDelegate::CreateStatic(&FStaticMeshRendererSceneViewExtension::AfterTonemapPass));\n\t}\n}\n\nFORCENOINLINE FScreenPassTexture FStaticMeshRendererSceneViewExtension::AfterTonemapPass(FRDGBuilder& GraphBuilder,\n\tconst FSceneView& View,\n\tconst FPostProcessMaterialInputs& Inputs)\n{\n\tconst FScreenPassTexture& SceneColor = Inputs.GetInput(EPostProcessMaterialInput::SceneColor);\n\n\tFScreenPassRenderTarget Output = Inputs.OverrideOutput;\n\n\tif (!Output.IsValid())\n\t{\n\t\tOutput = FScreenPassRenderTarget::CreateFromInput(GraphBuilder,\n\t\t                                                  SceneColor,\n\t\t                                                  View.GetOverwriteLoadAction(),\n\t\t                                                  TEXT(\"StaticMeshRendererSceneViewExtension\"));\n\t}\n\n\tconst FScreenPassTextureViewport SceneColorViewport(SceneColor);\n\tconst FScreenPassTextureViewport OutputViewport(Output);\n\n\tFBackgroundErasePS::FParameters* PassParameters = GraphBuilder.AllocParameters\u003CFBackgroundErasePS::FParameters\u003E();\n\tPassParameters-\u003EView = View.ViewUniformBuffer;\n\tPassParameters-\u003EOutputViewport = GetScreenPassTextureViewportParameters(OutputViewport);\n\tPassParameters-\u003ESceneTextures = Inputs.SceneTextures;\n\tPassParameters-\u003ESampler = TStaticSamplerState\u003CSF_Bilinear\u003E::GetRHI();\n\tPassParameters-\u003ERenderTargets[0] = Output.GetRenderTargetBinding();\n\n\tTShaderMapRef\u003CFBackgroundErasePS\u003E PixelShader(GetGlobalShaderMap(View.FeatureLevel));\n\n\tAddDrawScreenPass(GraphBuilder,\n\t                  RDG_EVENT_NAME(\"BackgroundErase\"),\n\t                  View,\n\t                  OutputViewport,\n\t                  SceneColorViewport,\n\t                  PixelShader,\n\t                  PassParameters);\n\n\treturn MoveTemp(Output);\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"SubscribeToPostProcessingPass()"}]},{type:"text",value:" をオーバーライドして、 ポスプロの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToneMap"}]},{type:"text",value:" のタイミングにパスの処理を行うようにしています。\nパスの処理では、 RDG が提供している "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddDrawScreenPass()"}]},{type:"text",value:" というスクリーンパス(画面全体に対して処理をするPixelShaderが主役のパス)向けの追加関数を使うことで、簡潔に追加処理を記述できています。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Context"}]},{type:"text",value:" は、多数の SceneViewExtension の中からこの Extension を選択するためのマーカーとして実装しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Module の Startup で Extension を登録するようにしておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FRenderingPracticeModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"StartupModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* -------"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"  *  省略"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"  ------- *\u002F"}]},{type:"text",value:"\n\n\tFCoreDelegates"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"text",value:"OnPostEngineInit"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddLambda"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"this"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tStaticMeshRendererSceneViewExtension\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" FSceneViewExtensions"},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","generic-function"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"NewExtension"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"FStaticMeshRendererSceneViewExtension"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これで、SceneViewExtension が利用可能になりました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"extension-を適用する"},children:[{type:"element",tag:"a",props:{href:"#extension-%E3%82%92%E9%81%A9%E7%94%A8%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Extension を適用する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"作成した Extension を、単一メッシュレンダリング向けに用意した ViewFamily で利用するよう設定するには、以下の行を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Render()"}]},{type:"text",value:" 関数に書き足すだけで OK です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"UStaticMeshRenderer"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"RenderWithAlpha"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"bool"}]},{type:"text",value:" bEnableAlpha"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\tFSceneViewFamilyContext "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FSceneViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ConstructionValues"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n\t\tRenderTargetResource"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RenderScene"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetScene"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"FEngineShowFlags"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ESFIM_Game"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ↓↓以下を追加"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"bEnableAlpha"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"static"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"const"}]},{type:"text",value:" FStaticMeshRendererSceneViewExtensionContext ExtensionContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ViewExtensions "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" GEngine"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"text",value:"ViewExtensions"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"-\u003E"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GatherActiveExtensions"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ExtensionContext"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ↑↑以上を追加"}]},{type:"text",value:"\n\t\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetRendererModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"BeginRenderingViewFamily"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"Canvas"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:"ViewFamily"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Extension の利用を引数からのフラグで制御可能にしたので、BPで背景の処理をパスごと有無を切り替えられます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer\u002F\u002Fwith-alpha.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"きちんと背景が抜けました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer\u002F\u002Fwith-alpha-pic.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fscenepreview-を使ったメッシュレンダリングの所感"},children:[{type:"element",tag:"a",props:{href:"#fscenepreview-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%81%AE%E6%89%80%E6%84%9F",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FScenePreview を使ったメッシュレンダリングの所感"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"FScenePreview を使った単一メッシュレンダリングを実験してみて、以下のようなことがわかりました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"利点"},children:[{type:"element",tag:"a",props:{href:"#%E5%88%A9%E7%82%B9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"利点"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"簡単に実装できる"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"隔離したシーンをセットアップしてキャプチャが行えるので便利。BP上だけで画像が作れる。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SceneCapture2d などよりはレンダリング機能へ深くアクセスできる"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"毎フレーム更新ではなく、メッシュ画像をランタイム生成する用途などには十分使える。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"欠点"},children:[{type:"element",tag:"a",props:{href:"#%E6%AC%A0%E7%82%B9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"欠点"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"パフォーマンス的に優れてるわけではない。また、数が増えると World \u002F Scene のオーバーヘッドが目立ちそう"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FSceneRenderer の内部をいじり回すことはできない"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"アルファ抜きは結局Extensionなどでパスを追加して対応するしか無い"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"ということで"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%81%A7",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ということで……"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実はこの記事は前座なのです。次回「独自メッシュパス編」では、より下のほうから手を入れることで、解決できなかった問題を回避したバージョンを実装していきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"幸いまだアドベントカレンダーの記事の枠(過去)は空いているようなので、数日以内にタイムリープして投稿したいと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"追記:"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n長くなったので続編記事を「前提知識編」「実装編」に分割しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"前提知識編: "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fstrv.dev\u002Fblog\u002Funrealengine--lets-implement-a-single-mesh-renderer-2",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"単一Static Meshレンダラを独自メッシュパスで実装する...ための前提知識編"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"実装編: 未投稿"}]},{type:"text",value:"\n"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Flets-implement-a-single-mesh-renderer",extension:".md",createdAt:"2023-12-24T00:00:00.000Z",updatedAt:"2023-12-24T00:00:00.000Z",gitCreatedAt:"2023-12-24T08:48:16.000Z",gitUpdatedAt:"2023-12-26T12:48:10.000Z"},{slug:"a-little-harder-introduction-to-blueprint",description:"Blueprint に本当に入門するために、Blueprint の実行モデルや実装について説明する記事",title:"すこし厳しい Blueprint 入門",enforceCreatedAt:"2022\u002F12\u002F18",enforceUpdatedAt:"2022\u002F12\u002F18",tags:["Unreal Engine","Unreal C++","Blueprint","Advent Calendar"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint",advent_calendar:{name:"Unreal Engine (UE) Advent Calendar 2022",link:"https:\u002F\u002Fqiita.com\u002Fadvent-calendar\u002F2022\u002Fue",day:18},toc:[{id:"検証環境",depth:2,text:"検証環境"},{id:"対象読者",depth:2,text:"対象読者"},{id:"記述範囲と注意事項",depth:2,text:"記述範囲と注意事項"},{id:"ドメイン固有言語-dsl",depth:2,text:"ドメイン固有言語 (DSL)"},{id:"非ネイティブコンパイル言語",depth:2,text:"非ネイティブコンパイル言語"},{id:"cとの相互運用性",depth:2,text:"C++との相互運用性"},{id:"型安全ではない弱い静的型付け",depth:2,text:"型安全ではない、弱い静的型付け"},{id:"計算モデル",depth:2,text:"計算モデル"},{id:"命令セット設計",depth:2,text:"命令セット設計"},{id:"blueprint-vm-命令表",depth:2,text:"Blueprint VM 命令表"},{id:"blueprint-vm--デカい-c-の-wrapper",depth:2,text:"Blueprint VM ≒ デカい C++ の Wrapper"},{id:"連携の本質は関数呼び出し",depth:2,text:"連携の本質は関数呼び出し"},{id:"ufunction",depth:2,text:"UFunction"},{id:"ufunction-の内側",depth:3,text:"UFunction の内側"},{id:"ufunction-マクロの役割-thunk--customthunk",depth:3,text:"UFUNCTION() マクロの役割 Thunk \u002F CustomThunk"},{id:"ufunctionの呼び出しと大きな流れ",depth:2,text:"UFunctionの呼び出しと大きな流れ"},{id:"c-関数に対する処理",depth:3,text:"C++ 関数に対する処理"},{id:"blueprint-関数に対する処理",depth:3,text:"Blueprint 関数に対する処理"},{id:"fframe",depth:2,text:"FFrame"},{id:"典型的なスタックフレームっぽいやつ",depth:3,text:"典型的なスタックフレームっぽいやつ"},{id:"レジスタっぽいやつ",depth:3,text:"レジスタっぽいやつ"},{id:"fframe-による-blueprint-vm-命令のステップ実行",depth:2,text:"FFrame による Blueprint VM 命令のステップ実行"},{id:"blueprint-vm-命令の定義",depth:2,text:"Blueprint VM 命令の定義"},{id:"blueprint-バイトコードの逆アセンブル",depth:2,text:"Blueprint バイトコードの逆アセンブル"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"introduction"},children:[{type:"element",tag:"a",props:{href:"#introduction",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Introduction"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine ユーザーたるもの、Blueprint は日々活用されていることでしょう。そういった皆々様方は、かつてBlueprint に入門されたことかと思いますが、Blueprint\nの裏側を覗きに行く機会はあまりないかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine に搭載されたスクリプティング言語としての Blueprint が、はたしてどのような形で記述され、誰によって実行され、どうやって C++ と連携しているのか？\nそんな裏側について掘り下げ、「Blueprint に入門」してみるのが本記事です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"使えなさそうで、意外と実用できる場面もある知識だったりしますので、興味のある方はぜひ読んでみてください。「そんなこととっくに知ってるぜ」というパワー系の皆さんは、本記事の粗を探してつついてくれると大変助かります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"目次"},children:[{type:"element",tag:"a",props:{href:"#%E7%9B%AE%E6%AC%A1",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"目次"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%89%8D%E6%8F%90"},children:[{type:"text",value:"前提"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83"},children:[{type:"text",value:"検証環境"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85"},children:[{type:"text",value:"対象読者"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E8%A8%98%E8%BF%B0%E7%AF%84%E5%9B%B2%E3%81%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85"},children:[{type:"text",value:"記述範囲と注意事項"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE-blueprint"},children:[{type:"text",value:"プログラミング言語としての Blueprint"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E-dsl"},children:[{type:"text",value:"ドメイン固有言語 (DSL)"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E9%9D%9E%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E8%A8%80%E8%AA%9E"},children:[{type:"text",value:"非ネイティブコンパイル言語"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#c%E3%81%A8%E3%81%AE%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A7"},children:[{type:"text",value:"C++との相互運用性"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%9E%8B%E5%AE%89%E5%85%A8%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E5%BC%B1%E3%81%84%E9%9D%99%E7%9A%84%E5%9E%8B%E4%BB%98%E3%81%91"},children:[{type:"text",value:"型安全ではない、弱い静的型付け"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E3%81%AE%E6%AD%B4%E5%8F%B2%E7%9A%84%E8%83%8C%E6%99%AF%E3%81%A8-unrealkismet"},children:[{type:"text",value:"Blueprint の歴史的背景と UnrealKismet"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E6%A6%82%E8%A6%81"},children:[{type:"text",value:"Blueprint VM 概要"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E8%A8%88%E7%AE%97%E3%83%A2%E3%83%87%E3%83%AB"},children:[{type:"text",value:"計算モデル"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%91%BD%E4%BB%A4%E3%82%BB%E3%83%83%E3%83%88%E8%A8%AD%E8%A8%88"},children:[{type:"text",value:"命令セット設計"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E5%91%BD%E4%BB%A4%E8%A1%A8"},children:[{type:"text",value:"Blueprint VM 命令表"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm--%E3%83%87%E3%82%AB%E3%81%84-c-%E3%81%AE-wrapper"},children:[{type:"text",value:"Blueprint VM ≒ デカい C++ の Wrapper"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E8%A9%B3%E8%A7%A3"},children:[{type:"text",value:"Blueprint VM 詳解"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E9%80%A3%E6%90%BA%E3%81%AE%E6%9C%AC%E8%B3%AA%E3%81%AF%E9%96%A2%E6%95%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97"},children:[{type:"text",value:"連携の本質は関数呼び出し"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#ufunction"},children:[{type:"text",value:"UFunction"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ufunction-%E3%81%AE%E5%86%85%E5%81%B4"},children:[{type:"text",value:"UFunction の内側"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#ufunction-%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E5%BD%B9%E5%89%B2-thunk--customthunk"},children:[{type:"text",value:"UFUNCTION() マクロの役割 Thunk \u002F CustomThunk"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#ufunction%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A8%E5%A4%A7%E3%81%8D%E3%81%AA%E6%B5%81%E3%82%8C"},children:[{type:"text",value:"UFunctionの呼び出しと大きな流れ"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#c-%E9%96%A2%E6%95%B0%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86"},children:[{type:"text",value:"C++ 関数に対する処理"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E9%96%A2%E6%95%B0%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86"},children:[{type:"text",value:"Blueprint 関数に対する処理"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fframe"},children:[{type:"text",value:"FFrame"}]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E5%85%B8%E5%9E%8B%E7%9A%84%E3%81%AA%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4"},children:[{type:"text",value:"典型的なスタックフレームっぽいやつ"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4"},children:[{type:"text",value:"レジスタっぽいやつ"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#fframe-%E3%81%AB%E3%82%88%E3%82%8B-blueprint-vm-%E5%91%BD%E4%BB%A4%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%AE%9F%E8%A1%8C"},children:[{type:"text",value:"FFrame による Blueprint VM 命令のステップ実行"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E5%91%BD%E4%BB%A4%E3%81%AE%E5%AE%9A%E7%BE%A9"},children:[{type:"text",value:"Blueprint VM 命令の定義"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E9%80%86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AB"},children:[{type:"text",value:"Blueprint バイトコードの逆アセンブル"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%93%E3%81%AE%E7%9F%A5%E8%AD%98%E4%BD%95%E3%81%AB%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE"},children:[{type:"text",value:"この知識、何に使えるの？"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81"},children:[{type:"text",value:"まとめ"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"},children:[{type:"text",value:"おわりに"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"前提"},children:[{type:"element",tag:"a",props:{href:"#%E5%89%8D%E6%8F%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"前提"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"検証環境"},children:[{type:"element",tag:"a",props:{href:"#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"検証環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UE 5.1"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UHT は C# 実装版を利用"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"対象読者"},children:[{type:"element",tag:"a",props:{href:"#%E5%AF%BE%E8%B1%A1%E8%AA%AD%E8%80%85",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"対象読者"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"C++ がある程度読める"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Unreal のリフレクションに関する知識 (FPropertyがわかればよい) がある"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"原理に興味がある"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"記述範囲と注意事項"},children:[{type:"element",tag:"a",props:{href:"#%E8%A8%98%E8%BF%B0%E7%AF%84%E5%9B%B2%E3%81%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"記述範囲と注意事項"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"本記事での範疇は、Blueprint コードの内部表現、Blueprint 実行システムの構造などに焦点を当てます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint Graph 画面の描画や、ノードの定義方法などについてはあまり詳しく掘り下げません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、本記事はエンジンのソースを読むことで得られた情報に基づいており、用語などは極力ソースに準拠するようにしていますが、説明のための記事上の用語が存在することがあります。Unreal\nEngine 以外の一般論については通常の用語を使用しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"プログラミング言語としての-blueprint"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E%E3%81%A8%E3%81%97%E3%81%A6%E3%81%AE-blueprint",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"プログラミング言語としての Blueprint"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、Blueprint の実行システムについて、大まかな構造を理解しましょう。Blueprint をひとつのプログラミング言語としてみたとき、以下のような特徴を持つと言えるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"ドメイン固有言語 (DSL)"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"スクリプト言語"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"ノードベース・ビジュアルプログラミング言語"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"非ネイティブコンパイル言語"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"C++ との相互運用性"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"オブジェクト指向言語"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"明示的な型付け"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"型安全ではない、弱い静的型付け"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"型などについては "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fja.wikipedia.org\u002Fwiki\u002F%E5%9E%8B%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"Wikipedia"}]},{type:"text",value:"\nに説明を任せるとして、この後のために説明しておきたい事項について触れておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ドメイン固有言語-dsl"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E-dsl",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ドメイン固有言語 (DSL)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint は汎用言語ではなく、特定のタスクに特化した"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fja.wikipedia.org\u002Fwiki\u002F%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E5%9B%BA%E6%9C%89%E8%A8%80%E8%AA%9E",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"ドメイン固有言語"}]},{type:"text",value:"です。このことは、Blueprint の設計にも大きく影響しています。詳しくは後述しますが、演算のような基本処理から、タスクスケジューリングのような高度な処理まで、Blueprint の実行基盤は全面的に Unreal Engine に依存しています。そのため、スタンドアロンな言語として切り離して利用するのはなかなか難しい作りになっていますが、よく言えば Unreal Engine と深く統合されていると言えます。切り離す必要もないですしね。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ところで、Wikipedia のドメイン固有言語のページを覗くと、Unreal Engine への言及があります。なんとそこで触れられているのは Blueprint ではなく Unreal Script なのですが……。加筆すべきか？"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"非ネイティブコンパイル言語"},children:[{type:"element",tag:"a",props:{href:"#%E9%9D%9E%E3%83%8D%E3%82%A4%E3%83%86%E3%82%A3%E3%83%96%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E8%A8%80%E8%AA%9E",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"非ネイティブコンパイル言語"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint がネイティブコンパイル言語ではないというのは、最終的に Blueprint で記述された処理が実行される際に、機械語となって各プラットフォームの CPU で直接実行されない(\nできない)ということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これはスクリプト言語では珍しいことではありません。独自の処理系をソフトウェアとして実装し、その処理系に向けたコードを与えれば、CPU\nで実行される機械語でなくともソフトウェア上で「実行する」ことは可能です。処理系がコードを解釈して、示される意味のとおりに、実際のCPUやOSを制御するように実装されていれば良いからです。\nBlueprint はこのタイプの言語であり、Unreal Engine の上に実装されたソフトウェアの処理系によって解釈・実行されます。こういったコードを解釈・実行するようなソフトウェアのことをVMと呼ぶこともあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"一方で、Blueprint はコンパイルもされる言語です。このことは上記の内容と矛盾しません。Blueprint はコンパイルされると、 "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Blueprint bytecode"}]},{type:"text",value:"\nというバイト列形式の中間表現を吐き出します。上記で述べた処理系が直接扱うのは、この bytecode のほうであり、ノードによる表現は直接扱えないのです。なお、詳細は後述しますが、Blueprint\nbytecode を実行する処理系を "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Blueprint VM"}]},{type:"text",value:" と言います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このような仕組みを取っているのは、主に実行時コストを落とすためだと思われます。ノードによる表現が作成する、接続関係によるネットワーク表現は人間にとっては直感的ですが、そのまま実行するには向きませんし、扱うデータが大きくなります。そのため、より実行時に処理しやすく軽量な中間表現として\nbytecode を事前に生成しておき、実行時には bytecode のみを処理するという形式を取っているのでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fblueprint-pipeline.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、他に bytecodeのような中間表現が用いられることのメリットは、中間表現を生成するコンパイラに選択肢を持たせることができることなどがあります。中間表現の仕様さえ満たしていれば、それを生成しているのがどんなコンパイラでも、中間表現を手書きできる謎の人間でも構わないわけです。このあたりの特性を利用している言語の例としては、.NET言語(\nC#, F#, ....)や"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fja.wikipedia.org\u002Fwiki\u002FJava%E4%BB%AE%E6%83%B3%E3%83%9E%E3%82%B7%E3%83%B3",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"JVM"}]},{type:"text",value:"言語(Java, Scala,\nKotlin, ....)の実行系、あるいはコンパイラ基盤であるLLVMのLLVM-IR などに例があります。\nBlueprint も、Blueprint VM バイトコードを吐き出す別言語のコンパイラというものを作成するのは不可能ではないはずです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、過去には Blueprint のコンパイルバックエンドに、C++のコードを吐き出す実装(ネイティブ化)\nが存在しました。"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fdocs.unrealengine.com\u002F5.1\u002Fja\u002Fcompiler-overview-for-blueprints-visual-scripting-in-unreal-engine\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"こちらの公式ドキュメント"}]},{type:"text",value:"\nを参照すると、5.1現在も "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FKismetCppBackend"}]},{type:"text",value:" がデバッグ用に存在していることになっていますが、これは誤りであり、コード上からは完全に削除されているため、現在ではあらゆる Blueprint\nは bytecode として実行されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"cとの相互運用性"},children:[{type:"element",tag:"a",props:{href:"#c%E3%81%A8%E3%81%AE%E7%9B%B8%E4%BA%92%E9%81%8B%E7%94%A8%E6%80%A7",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"C++との相互運用性"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++との相互運用性は、Blueprint の極めて強力な特徴です。Unreal Engine が独自のスクリプト言語を持っていることの大きなメリットとも言えるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"通常、複数言語の混在した開発において、言語間のデータの受け渡しや関数の呼び出しは大きな課題であり、そのためのレイヤや相互運用のためのライブラリがプロジェクトに導入されることも珍しくありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、Blueprint ははじめから Unreal Engine で使われることを想定して設計され、独自のビルドシステムや C++ 側の実装の存在を前提として実装されているので、ほとんど意識せずに\nC++ との相互運用が可能となっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Finteroperability.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このことは Blueprint の言語設計にも影響を与えているはずです。たとえば、Blueprint はかなり強くオブジェクト指向を意識した言語です。C++で定義されたクラスや、作成されたオブジェクトの階層的な構造をそのまま持ち込もうとすると、必然的にそうなるのでしょう。もちろん、ゲーム開発においてオブジェクト指向が大きな実績を持っているということもあるとは思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"型安全ではない弱い静的型付け"},children:[{type:"element",tag:"a",props:{href:"#%E5%9E%8B%E5%AE%89%E5%85%A8%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E5%BC%B1%E3%81%84%E9%9D%99%E7%9A%84%E5%9E%8B%E4%BB%98%E3%81%91",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"型安全ではない、弱い静的型付け"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これについてはあまり詳しく触れません。Blueprint は静的型付け言語ですが、型安全性は保証されていません。\nたとえば、ピンの型にWildcard(何でも入れられる)などを利用した場合、実行時に型の不一致でエラーが発生することがあります。\n一方で、基本的に型を意識して扱うことができ、これもやはりC++との相互運用性を考えたスクリプティング言語としての経緯が見えるところです(そうじゃなくても型ほしいですけど)。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まあただ、Blueprint には UObject という "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"†最強の基本クラス†"}]},{type:"text",value:" がいるので、なんとも言えませんが。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"blueprint-の歴史的背景と-unrealkismet"},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E3%81%AE%E6%AD%B4%E5%8F%B2%E7%9A%84%E8%83%8C%E6%99%AF%E3%81%A8-unrealkismet",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint の歴史的背景と UnrealKismet"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint に関するコードを読んでいくと、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Kismet"}]},{type:"text",value:" という語がよく登場しますので、軽く紹介しておきます。\nBlueprint は、Unreal Engine 4から搭載された機能でした。しかし、Unreal Engine におけるノードベースのビジュアルスクリプティング言語の歴史は Unreal Engine 4 からではありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint の系譜は Unreal Engine 3 から始まっています。残念ながら私は実際に触ったことはないのですが(当時10歳)、Unreal Engine 3 にも、 "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"UnrealKismet"}]},{type:"text",value:" というビジュアルスクリプティング言語が存在しました。\nそして、Unreal Engine 4 の機能として公開された Blueprint 実装のコードベースは、この Kismet の多くを引き継いだものなのです。この継承の歴史は Unreal Engine 5 になっても途絶えておらず、エンジン内の Blueprint に関連するコードの髄所に Kismet という語が認められます。また、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"K2Node"}]},{type:"text",value:" の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"K2"}]},{type:"text",value:" なども、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Kismet 2"}]},{type:"text",value:" の略であると思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"blueprint-vm-概要"},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E6%A6%82%E8%A6%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint VM 概要"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、Blueprint の基本的な特徴を把握したところで、Blueprint が実際に実行されている実行系の構造を見ていきます。\nBlueprint の実行系とは、前述の Blueprint bytecode を読んで、それが意味するところの処理を実行してくれる実装のことです。このような解釈・実行系のことをVMと呼ぶこともあると言いましたが、Blueprint の該当する実装においてもコード上で "},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Blueprint VM"}]},{type:"text",value:" と書かれることがあり、端的でわかりやすいので、この用語を採用します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"計算モデル"},children:[{type:"element",tag:"a",props:{href:"#%E8%A8%88%E7%AE%97%E3%83%A2%E3%83%87%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"計算モデル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Blueprint VM"}]},{type:"text",value:" の特徴をつかむために、どのような計算モデルを採用しているのか知ることにはメリットがあります。\nこの種の VM では"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fja.wikipedia.org\u002Fwiki\u002F%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%9E%E3%82%B7%E3%83%B3",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"スタックマシン"}]},{type:"text",value:"などの計算モデルが採用されることが多いと思いますが、Blueprint がドメイン固有言語であり、C++と協調して動く、ゲームエンジン内の VM であるという特徴が、計算モデルにも影響を与えているように思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"というのも、Blueprint VM はスタックマシンともレジスタマシンとも断定し難い、双方の特徴を持った独自の構造をしているように(僕の目には)見えます。\nこのような構造になっているのには、Blueprint VM はデータがその内部に完結する必要がないという点の影響が大きいのではないかと個人的には思っています。この種の VM を汎用的な実行基盤として構築するのならば、そこで扱う全てのデータはVMが管理するレジスタなりメモリ上なりに収められ、規定のデータ構造や操作による管理で完結していなければなりません。\nしかし、Blueprint VM はC++が隣に存在することが前提の仮想機械であり、Blueprint VM が管理しないC++上に確保されているC++変数の値などに大きく依存しています。C++ はすでに完全な機能を備えた言語処理系を持つ言語ですので、Blueprint VM は単体で完全な機能を備える必要がないわけです。すると当然、独立した通常の VM 実装とは異なる点が出てくるということでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"命令セット設計"},children:[{type:"element",tag:"a",props:{href:"#%E5%91%BD%E4%BB%A4%E3%82%BB%E3%83%83%E3%83%88%E8%A8%AD%E8%A8%88",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"命令セット設計"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"汎用 VM はそれだけであらゆる処理が実行できる(チューリング完全になる)ように構築されるので、(命令セットの設計思想によりますが)四則演算や論理演算などの基本的な命令を含む完結した命令セットを持ちます。これと比較すると、Blueprint VM の設計は非常に特殊です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たとえば、Blueprint VM は演算命令を一つも持ちません。「加算がしたければ加算処理を行う C++ 関数を呼び出せばよい」というような設計思想で作られているように思われます。実際、Blueprintにおける "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"int32"}]},{type:"text",value:" 同士の加算は、以下のように "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION()"}]},{type:"text",value:" マクロで作成された C++ 関数で処理されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"int32同士の加算"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F** Addition (A + B) *\u002F\nUFUNCTION(BlueprintPure, meta=(DisplayName = \"int + int\", CompactNodeTitle = \"+\", Keywords = \"+ add plus\", CommutativeAssociativeBinaryOperator = \"true\"), Category=\"Math|Integer\")\nstatic int32 Add_IntInt(int32 A, int32 B = 1);\n\nKISMET_MATH_FORCEINLINE int32 UKismetMathLibrary::Add_IntInt(int32 A, int32 B)\n{\n\treturn A + B;\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、いかなるメモリ管理も行いません。メモリ管理は Unreal Engine の GC に依存しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"代わりに、C++ との連携のための命令は豊富に持っています。たとえば、たった今見たような C++ で実装された関数は、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_CallMath [0x67]"}]},{type:"text",value:" という命令によって呼び出すことができます。この命令は、ネイティブ関数として実装された "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" も呼び出すことができる命令です。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" からネイティブ関数ポインタを取得し、引数や呼び出しコンテキストなどのデータと、戻り値を格納すべきアドレスをディスパッチした上で呼び出しを実行します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"blueprint-vm-命令表"},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E5%91%BD%E4%BB%A4%E8%A1%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint VM 命令表"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで、Blueprint VM に搭載されている命令の一覧を提示しておきます。\n使われ方がわからないとピンとこないと思いますが、後の内容を読みつつ、必要に応じて参照する形で利用してください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"かなり大きなテーブルになったので、折りたたんであります。"}]},{type:"text",value:"\n"},{type:"element",tag:"details",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"summary",props:{},children:[{type:"element",tag:"b",props:{},children:[{type:"text",value:"Blueprint VM 命令セット"}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"(一部編集中。ソースコードのコメントを元に翻訳したり、ソースを呼んで解説を追記する形で作成していますが、間に合わなくて空欄だったりコメント原文のままの箇所があります。)"}]},{type:"text",value:"\n"},{type:"element",tag:"style",props:{type:"text\u002Fcss"},children:[{type:"text",value:"\n.tg  {border-collapse:collapse;border-spacing:0;}\n.tg td{border-color:black;border-style:none;border-width:1px;font-size:14px;\n  overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg th{border-color:black;border-style:none;border-width:1px;font-size:14px;\n  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}\n.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}\n"}]},{type:"text",value:"\n"},{type:"element",tag:"table",props:{className:["tg"],style:"table-layout: fixed;"},children:[{type:"text",value:"\n"},{type:"element",tag:"colgroup",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"col",props:{style:"inline-size: 12em"},children:[]},{type:"text",value:"\n"},{type:"element",tag:"col",props:{style:"inline-size: 4em"},children:[]},{type:"text",value:"\n"},{type:"element",tag:"col",props:{style:""},children:[]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"thead",props:{},children:[{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"th",props:{className:["tg-0pky"]},children:[{type:"text",value:"命令名"}]},{type:"text",value:"\n    "},{type:"element",tag:"th",props:{className:["tg-0pky"]},children:[{type:"text",value:"バイトコード"}]},{type:"text",value:"\n    "},{type:"element",tag:"th",props:{className:["tg-0pky"]},children:[{type:"text",value:"説明"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"tbody",props:{},children:[{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LocalVariable"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x00"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"関数のローカル変数を取得。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_InstanceVariable"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x01"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"オブジェクト変数を取得。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_DefaultVariable"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x02"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"コンテキストのオブジェクトのCDOを取得。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Return"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x04"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"関数から戻る。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Jump"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x06"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"ローカルアドレスに基づいて指定されたコード上の場所に Jump する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_JumpIfNot"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x07"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"式が false だったならば、ローカルアドレスに基づいて Jump する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Assert"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x09"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"アサートを発行。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Nothing"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x0B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"何もしない"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Let"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x0F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FProperty を利用して、任意サイズの値の代入処理を行う。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ClassContext"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x12"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"CDO を利用して、指定した UClass の CDO をコンテキストとして処理を実行する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_MetaCast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x13"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"UClass 間のメタキャスト命令。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetBool"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x14"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"真偽値の代入命令。Bool 値変数は Bitfield にパックして保持されるため、専用の命令が用意されている。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndParmValue"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x15"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"関数の任意引数デフォルト値の終了を示すようだが、5.1現在利用されているようには見えない。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndFunctionParms"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x16"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"関数の呼び出し引数定義の終了。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Self"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x17"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Self オブジェクトを取得。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Skip"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x18"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"スキップ可能な式を表すようだが、5.1現在利用されているようには見えない。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Context"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x19"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"式を評価して作成した UObject のコンテキストで後続の処理を実行する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Context_FailSilent"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Context と同様だが、作成した UObject が無効値だった場合に例外をスローしない。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_VirtualFunction"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"仮想関数を引数付きで呼び出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_FinalFunction"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"完全に実装された通常の関数を引数付きで呼び出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_IntConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"int32 を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_FloatConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1E"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"float を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_StringConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x1F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FString を実行スタックから読み出す。読み込む実行スタック上の文字列は、ヌル終端する ANSI char として扱われる。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ObjectConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x20"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"UObject を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_NameConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x21"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FName を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_RotationConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x22"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FRotation を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_VectorConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x23"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FVector を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ByteConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x24"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"実行スタックを 1 byte 読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_IntZero"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x25"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"int32 の定数 0 を結果に書き込む。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_IntOne"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x26"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"int32 の定数 1 を結果に書き込む。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_True"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x27"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"bool の定数 true を結果に書き込む。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_False"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x28"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"bool の定数 false を結果に書き込む。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_TextConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x29"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FText を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_NoObject"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"UObject* の定数 nullptr を結果に書き込む。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_TransformConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FTransform を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_IntConstByte"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"実行スタックの 1 byte の値を読み出し、int32 で取得する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_NoInterface"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"オブジェクトを保持していない TScriptInterface を結果に書き込む。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".SetObject(nullptr);"}]},{type:"text",value:" を呼び出した状態。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_DynamicCast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2E"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"UObjectの dynamic cast を実行する。スタック上から `UClass` オブジェクトを読み出し、そのクラスに続く命令で評価される `UObject` がキャスト可能か(継承関係のチェック)を行う。キャスト可能であれば、有効な値を返し、キャスト不能であれば無効値を返す。この命令内では UObject 型しか扱っておらず、C++的な dynamic cast は行っていない。UClass の保持するリフレクション情報を元に、キャスト可能かどうかに基づいて、有効ならば評価された UObject を返すが、無効ならば返さないという処理である。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_StructConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x2F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"UScriptStruct を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndStructConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x30"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_StructConst"}]},{type:"text",value:" に対応して利用され、実行スタック上で "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_StructConst"}]},{type:"text",value:" のデータの終了を示す。ただし、UScriptStruct から存在すべきプロパティは判明するため、実行時にはこれは利用されておらず、シリアライズなどのエディタ処理で利用されている。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SetArray"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x31"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"渡された TArray へのセットを開始する。実行スタックから評価された Array プロパティとオブジェクトアドレス、続いて "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_EndArray"}]},{type:"text",value:" が現れるまで要素の値を読み取り順次 Array に追加する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndArray"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x32"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_SetArray"}]},{type:"text",value:" に対応して利用され、TArray のセットの終了を示す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_PropertyConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x33"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FProperty を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_UnicodeStringConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x34"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FString を実行スタックから読み出す。読み込む実行スタック上の文字列は、ヌル終端する UTF-16 バイト列として扱われる。サロゲートペアを考慮して読み込まれる。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Int64Const"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x35"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"int64 を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_UInt64Const"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x36"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"uint64 を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_DoubleConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x37"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"double を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Cast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x38"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"スタックからキャストコード(キャストする型の組み合わせと方向)を読み取り、そのコードに紐付けられたネイティブ関数を呼び出し、処理を引き継ぐ。呼び出されたネイティブ関数の中では、後続のスタック上のバイトを特定の型と見做して変換処理を実行する。この命令はBlueprint 実行処理の内部でキャストの必要が発生した際に利用されているようで、普段Blueprintを記述するときに直接利用することはない。たとえば、EX_Castには FloatToDouble の処理を行う関数があるが、Blueprint Graph 上で配置する Float to Cast のキャストノードは通常のC++関数であり、関連はない。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SetSet"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x39"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"渡された TSet へのセットを開始する。実行スタックから評価された Set プロパティとオブジェクトアドレス、要素数を読み取り、続いて "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_EndSet"}]},{type:"text",value:" が現れるまで要素の値を読み取り順次 Set に追加する。要素数が 0 であれば空の Set の作成のみが行われ、値の読み取りなしに実行スタックに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_EndSet"}]},{type:"text",value:" が現れなければならない。ただし、実装的には要素数は 1 以上かそれ未満かしか見ておらず、続く要素数ではなく追加していく Set の初期 Slack サイズを示している。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndSet"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_SetSet"}]},{type:"text",value:" に対応して利用され、TSet のセットの終了を示す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SetMap"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"渡された TMap へのセットを開始する。実行スタックから評価された Map プロパティとオブジェクトアドレス、要素数を読み取り、続いて "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_EndMap"}]},{type:"text",value:" が現れるまで要素の値を読み取り順次 Map に追加する。 要素の値は K, V, K, V... の順で実行スタックに積まれている。要素数が 0 であれば空の Map の作成のみが行われ、値の読み取りなしに実行スタックに "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_EndSet"}]},{type:"text",value:" が現れなければならない。ただし、実装的には要素数は 1 以上かそれ未満かしか見ておらず、続く要素数ではなく追加していく Map の初期 Slack サイズを示している。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndMap"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_SetMap"}]},{type:"text",value:" に対応して利用され、TMap のセットの終了を示す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SetConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"TSet を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndSetConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3E"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_SetConst"}]},{type:"text",value:"と対応して利用され、実行スタック上の値データ列の終了を示す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_MapConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x3F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"TMap を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndMapConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x40"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_MapConst"}]},{type:"text",value:"と対応して利用され、実行スタック上の値データ列の終了を示す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Vector3fConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x41"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"FVector3f を実行スタックから読み出す。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_StructMemberContext"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x42"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"スタック上の構造体メンバ Property と、続く命令で評価される構造体のオブジェクトを元に、Property が示すメンバのコンテキストを取得・設定する。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetMulticastDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x43"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Assignment to a multi-cast delegate"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x44"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Assignment to a delegate"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LocalVirtualFunction"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x45"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Special instructions to quickly call a virtual function that we know is going to run only locally"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LocalFinalFunction"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x46"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Special instructions to quickly call a final function that we know is going to run only locally"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LocalOutVariable"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x48"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"local out (pass by reference) function parameter"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_DeprecatedOp4A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_InstanceDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"const reference to a delegate or normal function object"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_PushExecutionFlow"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"push an address on to the execution flow stack for future execution when a EX_PopExecutionFlow is executed. Execution continues on normally and doesn't change to the pushed address."}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_PopExecutionFlow"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"continue execution at the last address previously pushed onto the execution flow stack."}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ComputedJump"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4E"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"実行スタックの続く命令を評価して得られたオフセットを元にジャンプを行う。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_PopExecutionFlowIfNot"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x4F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"continue execution at the last address previously pushed onto the execution flow stack, if the condition is not true."}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Breakpoint"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x50"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Breakpoint 命令。エディタ上のコンパイルでのみ存在し、それ以外では "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_Nothing"}]},{type:"text",value:" のように振る舞う。"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_InterfaceContext"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x51"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Call a function through a native interface variable"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ObjToInterfaceCast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x52"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Converting an object reference to native interface variable"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndOfScript"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x53"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Last byte in script code"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_CrossInterfaceCast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x54"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Converting an interface variable reference to native interface variable"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_InterfaceToObjCast"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x55"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Converting an interface variable reference to an object"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_WireTracepoint"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Trace point. Only observed in the editor, otherwise it behaves like EX_Nothing."}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SkipOffsetConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"A CodeSizeSkipOffset constant"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_AddMulticastDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Adds a delegate to a multicast delegate's targets"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ClearMulticastDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Clears all delegates in a multicast target"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_Tracepoint"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5E"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Trace point. Only observed in the editor, otherwise it behaves like EX_Nothing."}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetObj"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x5F"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"assign to any object ref pointer"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetWeakObjPtr"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x60"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"assign to a weak object pointer"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_BindDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x61"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"bind object and name to delegate"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_RemoveMulticastDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x62"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Remove a delegate from a multicast delegate's targets"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_CallMulticastDelegate"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x63"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Call multicast delegate"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_LetValueOnPersistentFrame"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x64"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ArrayConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x65"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_EndArrayConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x66"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SoftObjectConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x67"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_CallMath"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x68"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"static pure function from on local call space"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_SwitchValue"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x69"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_InstrumentationEvent"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x6A"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Instrumentation event"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ArrayGetByRef"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x6B"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_ClassSparseDataVariable"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x6C"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"Sparse data variable"}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "},{type:"element",tag:"tr",props:{},children:[{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"EX_FieldPathConst"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[{type:"text",value:"0x6D"}]},{type:"text",value:"\n    "},{type:"element",tag:"td",props:{className:["tg-0pky"]},children:[]},{type:"text",value:"\n  "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ざっと見ても、C++ で定義された、かなり高級な型の値を実行スタックから読み出す命令や、同じく高級な型の代入命令などが多数存在します。また、特定の値を示すリテラルのように働き、固定の値を結果として書き込む命令も多いです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"blueprint-vm--デカい-c-の-wrapper"},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm--%E3%83%87%E3%82%AB%E3%81%84-c-%E3%81%AE-wrapper",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint VM ≒ デカい C++ の Wrapper"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"繰り返し述べたように、Blueprint VM は独立した VM とは言いにくい実装になっています。それ自体が困難ですが、仮に C++ と Unreal Engine から Blueprint VM を引き剥がしてスタンドアロンで動かしたとすると、四則演算も比較もできなくなりますから、まともな処理を動かすことはできないでしょう。\n代わりに、C++ や Unreal Engine のシステムと深く結びついているため、Blueprint ではコンテンツ制作はもちろん、エディタに関するスクリプティングなどについても高い自由度を提供できているといえるかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"blueprint-vm-詳解"},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E8%A9%B3%E8%A7%A3",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint VM 詳解"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"そもそも、Blueprint の処理はどのように呼び出されるのでしょうか。UEngine は C++ のエントリポイントから起動しますから、Blueprint に処理を任せるために C++ と Blueprint を接続している仕組みがあるはずです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この章では、Blueprint が実行される大きな流れについての説明を行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"連携の本質は関数呼び出し"},children:[{type:"element",tag:"a",props:{href:"#%E9%80%A3%E6%90%BA%E3%81%AE%E6%9C%AC%E8%B3%AA%E3%81%AF%E9%96%A2%E6%95%B0%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"連携の本質は関数呼び出し"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine 内部で Blueprint の処理が開始される場合、その多くは「Blueprint の関数を呼び出す」という操作に対応しています。\nこれはあらゆる処理において言えることです。Blueprint の Event についても、コンパイル時には関数に変換されており、C++ から呼び出されるときには直接的には関数として扱われています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たとえば、Event の代表格である "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Tick"}]},{type:"text",value:" や "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BeginPlay"}]},{type:"text",value:" などは、コンパイル時に以下のような中間グラフ上の関数(Function stub)に変換されてからコンパイルされます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fevent-nodes.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fevent-stub-tick.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fevent-stub-beginplay.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、Blueprint から C++ の処理を呼び出したいときもあります。このときにも、対応するのは C++ の関数を呼び出すという操作です。\nということで、Blueprint と C++ の連携を紐解く切り口として、相互に関数が呼び出される仕組みを見ていきましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ufunction"},children:[{type:"element",tag:"a",props:{href:"#ufunction",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UFunction"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine においての Blueprint \u002F C++ の相互関数呼び出しには、 UFunction というクラスが大きな役割を果たしています。\nUFunctionを一言で説明すると、「Blueprint か C++ の関数を表す関数オブジェクト」です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++ の関数オブジェクトといえば、Unreal C++ なら "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TFunction\u003C\u003E"}]},{type:"text",value:"、STL なら "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"\u003Cfunction\u003E"}]},{type:"text",value:" の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"std::function\u003C\u003E"}]},{type:"text",value:" などが思い浮かぶでしょう。これらは、C++ の関数様のオブジェクトを取り回すのに特化したクラスです。一方、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" は、Blueprint と C++ の双方で呼び出し可能な関数を表すクラスなのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ufunction-の内側"},children:[{type:"element",tag:"a",props:{href:"#ufunction-%E3%81%AE%E5%86%85%E5%81%B4",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UFunction の内側"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"とはいえ、C++ の関数と Blueprint の関数はコンパイル後の内部表現が全く異なりますから、完全に共通化したデータを保持しているわけではありません。以下は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" のなかで関数呼び出しに関わるメンバを示した図です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fufunction-structure.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UStruct"}]},{type:"text",value:" を継承した型であり、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UStruct"}]},{type:"text",value:" のほうにも重要な情報が保持されています。\nこれらのパラメータのうち、C++ の関数と Blueprint の関数で使われ方が大きく異なるのは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" と "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Script"}]},{type:"text",value:" です。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Func\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"C++ の関数である時にのみ有効で、それ以外の場合には nullptr。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"C++ の関数ポインタを保持する。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Script\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"バイト列を保持する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TArray\u003Cuint8\u003E"}]},{type:"text",value:" メンバ。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Blueprint の関数であるときにのみ長さが1以上となり、Blueprint バイトコードを保持する。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の呼び出し処理では、その "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" が C++ 関数を表しているのか Blueprint 関数を表しているのかによって処理を分岐し、結果として共通した使用法で双方の関数を呼び出せるようにしているのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"上図に示したそれ以外のメンバの役割は以下です。こちらは Blueprint \u002F C++ 共通で利用されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FunctionFlags\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fdocs.unrealengine.com\u002F5.1\u002Fen-US\u002FAPI\u002FRuntime\u002FCoreUObject\u002FUObject\u002FEFunctionFlags\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"EFunctionFlags"}]},{type:"text",value:"で定義されたフラグをビットフィールドとして保持する。C++ 関数であるかを表す "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FUNC_Native"}]},{type:"text",value:" なども定義されており、関数の属性を判別するのに多用される。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"NumParams\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"関数の引数や戻り値などは、関数のパラメータとして扱われる。それらの総数を表す。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"ParamsSize\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"関数のパラメータが総計で占めることになるメモリ上のサイズを表す。関数呼び出しの際に、パラメータのために確保すべき領域を知るためなどに利用される。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"ChildProperties\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FProperty のリンクリスト。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の場合は、関数のパラメータのリフレクション情報を保持する。これにより、引数の具体的な型や、オブジェクト上での配置位置オフセットなどが判明し、パラメータの利用が可能となる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このように、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" は Blueprint \u002F C++ の関数のシグニチャのための共通した表現を持ち、その処理の実体のみを個別に扱うことで、Blueprint \u002F C++ どちらからも呼び出し可能な関数を実現しているクラスなのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ufunction-マクロの役割-thunk--customthunk"},children:[{type:"element",tag:"a",props:{href:"#ufunction-%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E5%BD%B9%E5%89%B2-thunk--customthunk",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UFUNCTION() マクロの役割 Thunk \u002F CustomThunk"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" と聞いて、いつも Unreal C++ で書いている "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION"}]},{type:"text",value:" マクロを付けたメンバ変数のことを連想したのに、なにか違うものの説明をされて戸惑っている人がいるかもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fdocs.unrealengine.com\u002F5.1\u002Fja\u002Fufunctions-in-unreal-engine\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"公式ドキュメント"}]},{type:"text",value:"含め、「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION()"}]},{type:"text",value:" をつけると "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" になる」と説明されることがありますが、厳密に言うと、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION"}]},{type:"text",value:" マクロを付けた関数自体が "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" になるわけではありません。中身が書き換わるわけでもありませんし、実装はそのまま利用されます。しかし、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION"}]},{type:"text",value:" マクロを付けた関数には、その関数を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" メンバとして取り扱い可能にする(シグニチャをあわせて引数のディスパッチを行う)ためのラッパー関数が外部に生成されます。この生成は Unreal Header Tool によってビルド前に行われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ラッパー関数を生成する目的は、呼び出しのシグニチャを統一することです。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION"}]},{type:"text",value:" マクロは様々な引数や戻り値を持った関数に付けられますが、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" メンバが保持できるシグニチャは一定です。そこで、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" が保持できるシグニチャを持ったラッパー関数で包み、内部で引数の値や戻り値の処理を個別に行うことで、どんな関数でも "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" で保持できるように差異を吸収するのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このラッパー関数によって、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION"}]},{type:"text",value:" マクロを付けた任意の C++ 関数を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" で保持することができるようになります。すると、C++ で実装した関数が Blueprint \u002F C++ で扱えるようになるという仕組みなのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fwhat-ufunction.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ちなみに、このラッパー関数のことを、Unreal Engine では Thunk function (サンク関数) と呼んでいるようです。この名前に「オッ」となった人はいるでしょうか。そうです。出会って戸惑うUFUNCTION() 指定子ランキングトップの "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFUNCTION(CustomThunk)"}]},{type:"text",value:" とは、このサンク関数をUHTに自動生成させることを抑制し、自分自身でカスタムのサンク関数を記述するための指定子なのです。\nCustomThunkの使い方については、別の記事を書こうと思っています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ufunctionの呼び出しと大きな流れ"},children:[{type:"element",tag:"a",props:{href:"#ufunction%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%81%A8%E5%A4%A7%E3%81%8D%E3%81%AA%E6%B5%81%E3%82%8C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UFunctionの呼び出しと大きな流れ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" はローカルだけでなくリモート(サーバーなど)で実行されることもあるので、エンジン内でも様々な方法の実行処理が記述されています。ここでは、ローカル関数に特化した呼び出しの流れを見てみます。簡単のため、一部コードは省いて、コメントを追記しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ScriptCore.cpp"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#define RESULT_PARAM Z_Param__Result\n#define RESULT_DECL void* const RESULT_PARAM\n\nvoid ProcessLocalFunction(UObject* Context, UFunction* Fn, FFrame& Stack, RESULT_DECL)\n{\n  \u002F\u002F UFunction の有効性をチェック\n\tcheckSlow(Fn);\n  \u002F\u002F C++関数か？\n\tif(Fn-\u003EHasAnyFunctionFlags(FUNC_Native))\n\t{\n    \u002F\u002F C++の関数を直接呼び出し\n\t\tFn-\u003EInvoke(Context, Stack, RESULT_PARAM);\n\t}\n\telse\n\t{\n    \u002F\u002F UFunction が持つ Script メンバに保持された Blueprint バイトコードを実行\n\t\tProcessScriptFunction(Context, Fn, Stack, RESULT_PARAM, ProcessLocalScriptFunction);\n\t}\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"c-関数に対する処理"},children:[{type:"element",tag:"a",props:{href:"#c-%E9%96%A2%E6%95%B0%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"C++ 関数に対する処理"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" には "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Invoke()"}]},{type:"text",value:" という、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" に保持する C++ 関数を呼び出すための専用メンバが存在します。C++ 関数に対する呼び出しは、このメンバを呼び出すだけで対応されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"「この呼び出し方では様々な引数の関数に対応できないのでは？」と思うかもしれませんが、問題ありません。 "},{type:"element",tag:"a",props:{href:"#ufunction-%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E5%BD%B9%E5%89%B2-thunk--customthunk"},children:[{type:"text",value:"UFunction の説明の項"}]},{type:"text",value:" で述べた通り、C++ のネイティブ関数を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" で利用する場合、必ずシグニチャが統一されたラッパーである Thunk 関数が存在します。\n最終的に関数に渡される引数の値や、その関数が紐づくオブジェクトは、すべてここで渡されている "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Context"}]},{type:"text",value:" や "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Stack"}]},{type:"text",value:" から Thunk 関数が取り出し、最終的な引数として決定します。\nまた、関数の戻り値は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RESULT_DECL"}]},{type:"text",value:" に格納されます。コード上部に定義を引用しましたが、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RESULT_DECL"}]},{type:"text",value:" は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"void* const"}]},{type:"text",value:" を表すので、任意の戻り値のアドレスを受けることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"例として、Blueprint における Int 同士の加算を定義している以下の関数を保持する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Invoke()"}]},{type:"text",value:" した場合を見てみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Add_IntInt()"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"static int32 Add_IntInt(int32 A, int32 B = 1);"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UHT によって以下の Thunk 関数が自動生成され、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Func"}]},{type:"text",value:" に保持されているので、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Invoke()"}]},{type:"text",value:" で実行されるのもこの Thunk 関数です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Thunk関数"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F\u002F static int32 Add_IntInt(int32 A, int32 B) の Thunk 関数\nvoid UKismetMathLibrary::execAdd_IntInt(UObject* Context, FFrame& Stack, void* const Z_Param__Result)\n{\n\tFIntProperty::TCppType Z_Param_A = FIntProperty::GetDefaultPropertyValue();\n\t\u002F\u002F 第1引数を Stack.Code のバイトコードを評価して取得する。Codeが進む。\n\tStack.StepCompiledIn\u003CFIntProperty\u003E(&Z_Param_A);;\n\n\tFIntProperty::TCppType Z_Param_B = FIntProperty::GetDefaultPropertyValue();\n\t\u002F\u002F 第2引数を Stack.Code のバイトコードを評価して取得する。Codeが進む。\n\tStack.StepCompiledIn\u003CFIntProperty\u003E(&Z_Param_B);;\n\n\t\u002F\u002F 次の Stack.Code が nullptr でなければ、1つ Code を進める。\n\tStack.Code += !!Stack.Code;;\n\n\t\u002F\u002F 引数を C++関数にディスパッチ。値を結果格納用の引数に書き込んで終了。\n\t*(int32*)Z_Param__Result = UKismetMathLibrary::Add_IntInt(Z_Param_A, Z_Param_B);\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Stack"}]},{type:"text",value:" から C++ 関数に渡すべき引数の値などを読み出し、全ての準備が整ってから実際の C++関数の呼び出しを行っていることがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"blueprint-関数に対する処理"},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E9%96%A2%E6%95%B0%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E5%87%A6%E7%90%86",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint 関数に対する処理"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint 関数は、ネイティブ実行可能なコードではなく Blueprint VM のバイトコードなので、単純に呼び出すことはできず、逐次バイトコードを処理していく必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"上のコードで利用されている "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ProcessScriptFunction()"}]},{type:"text",value:" のシグニチャは以下です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"template"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typename"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Exec"}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"\u003E"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ProcessScriptFunction"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UObject"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Context"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" UFunction"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" Function"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FFrame"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RESULT_DECL"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Exec ExecFtor"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ProcessScriptFunction()"}]},{type:"text",value:" は、Blueprint 関数の呼び出しの前処理と、呼び出しまでを行ってくれるヘルパー関数です。\nBlueprint 関数の引数や戻り値パラメータを保持するメモリ領域は、C++ の関数と異なり自動で確保されないので、呼び出す前に明示的に確保を行う必要があります。また、関数呼び出しに際しては、確保したメモリ領域や、関数の処理の実行状況、実行しているバイトコードへの命令カウンタなどをまとめて管理するスタックフレーム(のようなもの)を新たに構築する必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ProcessScriptFunction()"}]},{type:"text",value:" が行う前処理の中では、渡された "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" のプロパティ情報などを元に、必要なメモリの確保や初期化を行い、スタックフレーム(のようなもの)の構築までを行ってくれます。これは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" 型の変数として引き継がれていきます。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" については後ほど詳しく触れます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"第5引数の型がテンプレート型引数によって指定されており、ここに渡した関数が最後のバイトコード実行の処理として利用されます。\nまた、第5引数(最後の引数)に渡されているのは以下の関数です。簡単のため、例外処理は削除しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ProcessLocalScriptFunction"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UObject"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Context"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" FFrame"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RESULT_DECL"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tUFunction"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" Function "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UFunction"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Node"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F No POD struct can ever be stored in this buffer. "}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"MS_ALIGN"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"16"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" uint8 "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Buffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"MAX_SIMPLE_RETURN_VALUE_SIZE"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GCC_ALIGN"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"16"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F バイトコードの実行。EX_Return 命令が現れるまで実行し続ける。"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"while"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Code "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!="}]},{type:"text",value:" EX_Return"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 後続のバイトコードを一つ読み取り、その命令を実行する。内部では処理に依存した数だけ Stack.Code が進む。"}]},{type:"text",value:"\n\t\tStack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Step"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Object"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Buffer"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n  "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 処理が終わったので一つコードを進め(EX_Return命令をステップオーバー)、終了処理に入る"}]},{type:"text",value:"\n  Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Code"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"++"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n  "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Code "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!="}]},{type:"text",value:" EX_Nothing"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 次の命令が EX_Nothing でなければ、後続の命令を評価し、RESULT_PARAM に関数の結果を格納する"}]},{type:"text",value:"\n    Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Step"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Object"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RESULT_PARAM"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"else"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F EX_Nothing なら、命令カウンタを一つ進めて(EX_Nothingをステップオーバー)終了"}]},{type:"text",value:"\n    Stack"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Code"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"++"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n  "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ProcessLocalScriptFunction()"}]},{type:"text",value:" はローカルでバイトコードを実行する関数です。\nこの関数には、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ProcessScriptFunction()"}]},{type:"text",value:" が整えてくれた "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame& Stack"}]},{type:"text",value:" が渡されてきます。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Stack.Code"}]},{type:"text",value:" は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の保持するバイトコード上の位置を示すポインタで、いわゆるプログラムカウンタの役割を果たします(後述)。処理をみると、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Stack.Code"}]},{type:"text",value:" を進めることで命令の処理位置が進んでいき、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_Return"}]},{type:"text",value:" まで実行され続けることがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fframe"},children:[{type:"element",tag:"a",props:{href:"#fframe",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FFrame"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" の実行にも登場しましたが、Blueprint VM の実行処理をより詳しく見ていくためには、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" のことを知る必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" は、C \u002F C++ など言語にも存在するスタックフレームに近い役割を果たすクラスです。スタックフレームとは、関数呼び出しのためにスタック領域に構築される、ローカル変数、リターンアドレス(呼び出し元のアドレス)、引数などの情報を持ったデータ構造です。関数が呼び出されると、その関数の命令を実行するための作業領域がメモリ上に必要ですし、自分がどこから呼ばれたのかがわからなければ関数からの return ができないので、それらの情報を扱うためのデータ構造を関数の呼び出し時に構築しているのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" はスタックフレーム同様、関数呼び出しのたびに構築され、関数が終了すると破棄されるので、呼び出しがネストすると多段的に存在することもありますが、特定の関数呼び出しに対応する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" は一つであると考えてよいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" はスタック領域に確保されるわけではありませんし、データ構造としてもスタックではありません。プログラムカウンタの役割を持つ変数や、直近の命令の結果を保持する変数などもメンバに持つので、それらはレジスタ的であるとも言えます。\n下図は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" の主要なメンバ変数を示したものです。典型的なスタックフレームにありそうなものを青、レジスタ的な働きをしているものを橙に塗り分けたので、参考程度に御覧ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Ffframe-structure.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"典型的なスタックフレームっぽいやつ"},children:[{type:"element",tag:"a",props:{href:"#%E5%85%B8%E5%9E%8B%E7%9A%84%E3%81%AA%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"典型的なスタックフレームっぽいやつ"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UFunction* Node\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"現在の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" に対応する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" のポインタを保持する。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UObject* Object\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"現在の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" に対応するコンテキストオブジェクト。多くの場合、関数が属する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UObject"}]},{type:"text",value:" のインスタンスと考えてもよい。ローカル変数へのアクセスなどに利用される。一部の命令の実行において、暗黙的に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"this"}]},{type:"text",value:" と同等の役割として扱われる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"uint8* Locals\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"現在の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" に対応する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" のローカル変数を保持しているメモリ領域の先頭アドレス。複数のローカル変数が連続して配置されることがあるが、別途得られたローカル変数の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" の情報を元に先頭アドレスからのオフセットを計算し、任意のローカル変数にアクセスできるようになっている。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FOutParamRec* OutParams\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"ミュータブルな参照渡しなどによって、戻り値以外の出力パラメータと認識される引数がある場合、その引数は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CPF_OutParm"}]},{type:"text",value:" というフラグを持つようになる。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"OutParams"}]},{type:"text",value:" は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FOutParmRec"}]},{type:"text",value:" のメンバとして、最初の追加出力引数の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" へのポインタ、その "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" へのデータの保存先アドレス、および次の追加出力パラメータを保持する。リンクリストになっているので、一つずつ辿っていくことで、すべての追加出力パラメータにアクセスできる。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"戻り値を格納すべき領域は OutParams のように "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" のメンバとしてではなく、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RESULT_DECL"}]},{type:"text",value:" のように、命令を処理する関数の引数として既定のものが渡されてくる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"レジスタっぽいやつ"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レジスタっぽいやつ"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"uint8* Code\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"いわゆるプログラムカウンタのような変数。実行中のバイトコードの実体は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UFunction"}]},{type:"text",value:" のメモリ領域などに配置されているが、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Code"}]},{type:"text",value:" はそのバイトコード上の特定の位置をポイントすることで、現在実行中の命令位置を保持する。この変数の指す位置をインクリメントすることで、バイトコードの実行が進む。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"FProperty* MostRecentProperty\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"直近の命令でアクセスされた "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" のアドレスを保持する。これにより、Blueprint VM は、続く命令で前の命令で得られたプロパティに対するアクセスが可能になる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"uint8* MostRecentPropertyAddress\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"MostRecentProperty"}]},{type:"text",value:" のデータの実体が配置されたメモリ領域の先頭アドレス。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" は型のリフレクション情報であり、値そのものは持たないので、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" の情報やメソッドを利用してこのメモリ領域から値を読み出すことで、実値へのアクセスが可能となる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"uint8* MostRecentPropertyContainer\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"MostRecentPropertyContainer"}]},{type:"text",value:" は、直近の命令でアクセスされた "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" コンテナのメモリ領域の先頭アドレスを保持する。処理のステップによっては、「あるメンバプロパティのアドレス位置はまだわからないが、そのプロパティを持っているオブジェクトのアドレスはわかる」といったシチュエーションがよくある。プロパティを保持するオブジェクトのことを Property Container と呼んでおり、追加で Property Container のアドレスにオフセットをかけることでメンバのアドレスに到達できる。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FProperty"}]},{type:"text",value:" が保持するリフレクション情報には、オブジェクト内での自身のメモリ配置のオフセット情報が含まれているが、それは相対的な値であるため、オフセットをかける対象となる絶対アドレスとして "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MostRecentPropertyContainer"}]},{type:"text",value:" が必要となる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"fframe-による-blueprint-vm-命令のステップ実行"},children:[{type:"element",tag:"a",props:{href:"#fframe-%E3%81%AB%E3%82%88%E3%82%8B-blueprint-vm-%E5%91%BD%E4%BB%A4%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%AE%9F%E8%A1%8C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"FFrame による Blueprint VM 命令のステップ実行"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint VM のバイトコード実行の実体は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" による "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Code"}]},{type:"text",value:" ポインタのインクリメントです。 バイトコードには命令のほか、オブジェクトのバイト表現が埋め込まれたり、値リテラルを表すバイトが埋め込まれたりします。それらを処理次第、バイト数分だけ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Code"}]},{type:"text",value:" を進めるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"処理の実行に最も多用される "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" のメンバ関数は、以下の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame::Step()"}]},{type:"text",value:"です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"void"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"FFrame"}]},{type:"element",tag:"span",props:{className:["token","punctuation","double-colon"]},children:[{type:"text",value:"::"}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Step"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"UObject"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Context"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" RESULT_DECL"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tint32 B "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"Code"},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"++"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"GNatives"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"B"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword","type-opencl-host-cpp"]},children:[{type:"text",value:"Context"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"this"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"RESULT_PARAM"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このメンバは、一つ先のバイトコードを読み出し、そのバイト値を関数ポインタの配列 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GNatives[]"}]},{type:"text",value:" のインデックスとすることで、命令コードによる命令関数の呼び出しを実現している関数です。先に命令表で示した命令コードが、ここでの変数 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"B"}]},{type:"text",value:" に数値として読み出されるということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"GNatives[]"}]},{type:"text",value:" は以下のように定義されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"COREUOBJECT_API FNativeFuncPtr GNatives"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"text",value:"EX_Max"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この配列に対して、命令処理を実装した関数が、各々追加されています。以下は単純な "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_Jump"}]},{type:"text",value:" 命令の実装です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"EX_Jump"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"void UObject::execJump( UObject* Context, FFrame& Stack, RESULT_DECL )\n{\n  \u002F\u002F 現在の Stack.Code 位置から、CodeSkipSizeType のサイズのメモリを読み出し、CodeSkipSizeType として解釈して返す。\n  \u002F\u002F sizeof(CodeSkipSizeType) だけ Stack.Code が進む。 \n\tCodeSkipSizeType Offset = Stack.ReadCodeSkipCount();\n  \u002F\u002F 現在の Stack.Code を、`UFunction` の保持するバイトコードへの特定オフセット位置に置き換える\n\tStack.Code = &Stack.Node-\u003EScript[Offset];\n}\nIMPLEMENT_VM_FUNCTION( EX_Jump, execJump ); \u002F\u002F GNatives に EX_Jump の値(列挙型であり命令コードを示す)で登録"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CodeSkipSizeType"}]},{type:"text",value:" とはバイトコード上のオフセットを表すのに十分なサイズの数値型で、多くのプラットフォームでは "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"uint32"}]},{type:"text",value:" です。\nこの処理によって、バイトコード上に示されたジャンプ位置に現在の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Stack.Code"}]},{type:"text",value:" を書き換え、後続する命令の内容を変更することができます。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CodeSkipSizeType"}]},{type:"text",value:" が "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"uint32"}]},{type:"text",value:" であると仮定したときのバイトコードを図示するなら、以下のようになるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fex-jump.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、もう少し複雑な例として、条件付きジャンプ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_JumpIfNot"}]},{type:"text",value:" も見てみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"EX_JumpIfNot"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"void UObject::execJumpIfNot( UObject* Context, FFrame& Stack, RESULT_DECL )\n{\n\tCHECK_RUNAWAY;\n\n  \u002F\u002F 希望されるジャンプ先のオフセット位置をバイトコードから読み出す\n\tCodeSkipSizeType Offset = Stack.ReadCodeSkipCount();\n\n\t\u002F\u002F 続く命令を Step で評価する。その結果を第二引数の `Value` に受け取る。\n\tbool Value = 0;\n\tStack.Step( Stack.Object, &Value );\n\n  \u002F\u002F `Value` の値によってジャンプするか否かを分岐\n\tif( !Value )\n\t{\n\t\tStack.Code = &Stack.Node-\u003EScript[ Offset ];\n\t}\n}\nIMPLEMENT_VM_FUNCTION( EX_JumpIfNot, execJumpIfNot );"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_JumpIfNot"}]},{type:"text",value:" では、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame::Step()"}]},{type:"text",value:" で実行された "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"execJumpIfNot()"}]},{type:"text",value:" の中で、更に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame::Step()"}]},{type:"text",value:" を呼び出しています。\nこのパターンは多くの命令の実装で見られるもので、バイトコードの表現の自由度を向上させています。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_JumpIfNot"}]},{type:"text",value:" は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Value"}]},{type:"text",value:" を評価式に持つ単純な分岐命令などに利用できるものです。しかし、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Value"}]},{type:"text",value:" の値の決定を命令処理内部で更に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame::Step()"}]},{type:"text",value:" することで、ジャンプするか否かの決定を、後続の任意のバイトコードの実行結果によって決定できるようになっているのです。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Value"}]},{type:"text",value:" の値を決定するのはもしかすると単にバイトコード上に埋め込まれた定数かもしれませんし、複雑な処理の結果かもしれません。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["without-shadow"]},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fex-jump-if-not.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"続いて、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MostRecentProperty"}]},{type:"text",value:" などを利用する命令の例として、ローカル変数へのアクセス命令 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EX_LocalVariable"}]},{type:"text",value:" も見ておきます。\n(例のごとく例外処理は省いています)"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"EX_LocalVariable"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"void UObject::execLocalVariable( UObject* Context, FFrame& Stack, RESULT_DECL )\n{\n  \u002F\u002F バイトコードから、読み出したいプロパティを表す `FProperty` を読み出す。その分 Code は進む。\n\tFProperty* VarProperty = Stack.ReadProperty();\n  \u002F\u002F `Stack.Locals` が指すローカル変数メモリ領域に対して、`FProperty` のメモリ配置情報を適用し、読み出したいプロパティデータのアドレスを決定する。そのアドレスを `MostRecentProeprtyAddress` に入れておく。\n  Stack.MostRecentPropertyAddress = VarProperty-\u003EContainerPtrToValuePtr\u003Cuint8\u003E(Stack.Locals);\n  \u002F\u002F ↑ で `MostRecentProeprtyAddress` を更新したので、そのプロパティのコンテナである `Stack.Locals` のアドレスに `MostRecentPropertyContainer` も更新しておく\n  Stack.MostRecentPropertyContainer = Stack.Locals;\n\n  if (RESULT_PARAM)\n  {\n    \u002F\u002F プロパティに Getter が定義されているか\n    if (VarProperty-\u003EHasGetter())\n    {\n      \u002F\u002F されていたら Getter で読み出し、RESULT_PARAM に受け取る\n      VarProperty-\u003EGetValue_InContainer(Stack.MostRecentPropertyContainer, RESULT_PARAM);\n    }\n    else\n    {\n      \u002F\u002F されていなかったら、プロパティデータのアドレスからデータを RESULT_PARAM にコピーして値を読み出す\n      VarProperty-\u003ECopyCompleteValueToScriptVM(RESULT_PARAM, Stack.MostRecentPropertyAddress);\n    }\n  }\n}\nIMPLEMENT_VM_FUNCTION( EX_LocalVariable, execLocalVariable );"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このように、プロパティに直接アクセスする命令の中では、アクセスしたプロパティの履歴を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" の Recent~ 系のメンバに記録してくれるのです。これにより、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" を共用する後続の命令もそのプロパティにアクセス可能になるので、プロパティアクセスに頻繁に利用されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらの命令が読めれば、大抵の命令の処理は読むことができます。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ScriptCore.cpp"}]},{type:"text",value:" に実装がありますので、気になる命令は見てみるとよいでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"blueprint-vm-命令の定義"},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E5%91%BD%E4%BB%A4%E3%81%AE%E5%AE%9A%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint VM 命令の定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"#blueprint-vm-%E5%91%BD%E4%BB%A4%E8%A1%A8"},children:[{type:"text",value:"Blueprint VM 命令表"}]},{type:"text",value:" で、定義されている命令とその役割は記載しましたが、実際にはどこにどうやって定義されているのかについてはまだ触れていませんでした。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Runtime\u002FCoreUObject\u002FPublic\u002FUObject\u002FScript.h"}]},{type:"text",value:" をみるとすぐにわかります。公式ドキュメントにも記載のある、 "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fdocs.unrealengine.com\u002F5.1\u002Fen-US\u002FAPI\u002FRuntime\u002FCoreUObject\u002FUObject\u002FEExprToken\u002F",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"EExprToken"}]}]},{type:"text",value:" が、Blueprint VM の命令のコードを決定しています。\nここで定義した列挙型の値を、一つ前の項でも見た命令の実装と紐づけて、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GNatives[]"}]},{type:"text",value:" に入れておくことで、命令の呼び出しを実現しているようです。"}]},{type:"text",value:"\n"},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"blueprint-バイトコードの逆アセンブル"},children:[{type:"element",tag:"a",props:{href:"#blueprint-%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E9%80%86%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Blueprint バイトコードの逆アセンブル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまで、実装ベースで Blueprint VM の背後を見てきました。しかし、バイトコードの役割がわかるようになったからには、実際に実行されているバイトコードを確認してみたくなるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine には、コンパイルして生成されたバイトコードを人間が読みやすい形で逆アセンブルして出力する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FKismetBytecodeDisassembler"}]},{type:"text",value:" というクラスが定義されています。これは Blueprint コンパイラの中でも利用できるようになっていて、Engine.ini に以下を加えることで有効化できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"[Kismet]\nCompileDisplaysBinaryBackend=True"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これが有効化されていると、Blueprint のコンパイル時に、生成されたバイトコードを逆アセンブルしたテキストがログ出力されるようになります。\nたとえば、以下のグラフをコンパイルすると……"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint\u002F\u002Fsample-nodes.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これが出てきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-ini"]},children:[{type:"element",tag:"code",props:{className:["language-ini"]},children:[{type:"text",value:"LogK2Compiler: [function ExecuteUbergraph_L_GameEntry]:\nLabel_0x0:\n     $4E: Computed Jump, offset specified by expression:\n         $0: Local variable of type int32 named EntryPoint. Parameter flags: (Parameter).\nLabel_0xA:\n     $68: Call Math (stack node KismetSystemLibrary::PrintString)\n       $17: EX_Self\n       $1F: literal ansi string \"Hello\"\n       $27: EX_True\n       $27: EX_True\n       $2F: literal struct LinearColor (serialized size: 16)\n         $1E: literal float 0.000000\n         $1E: literal float 0.660000\n         $1E: literal float 1.000000\n         $1E: literal float 1.000000\n         $30: EX_EndStructConst\n       $1E: literal float 2.000000\n       $21: literal name None\n       $16: EX_EndFunctionParms\nLabel_0x52:\n     $6: Jump to offset 0x7D\nLabel_0x57:\n     $45: Local Virtual Script Function named NewFunction\n       $28: EX_False\n       $1D: literal int32 0\n       $21: literal name None\n       $16: EX_EndFunctionParms\nLabel_0x78:\n     $6: Jump to offset 0xA\nLabel_0x7D:\n     $4: Return expression\n       $B: EX_Nothing\nLabel_0x7F:\n     $53: EX_EndOfScript\nLogK2Compiler: [function ReceiveBeginPlay]:\nLabel_0x0:\n     $46: Local Final Script Function (stack node L_GameEntry_C::ExecuteUbergraph_L_GameEntry)\n       $1D: literal int32 87\n       $16: EX_EndFunctionParms\nLabel_0xF:\n     $4: Return expression\n       $B: EX_Nothing\nLabel_0x11:\n     $53: EX_EndOfScript\nLogK2Compiler: [function NewFunction]:\nLabel_0x0:\n     $68: Call Math (stack node KismetSystemLibrary::PrintString)\n       $17: EX_Self\n       $1F: literal ansi string \"Hello\"\n       $27: EX_True\n       $27: EX_True\n       $2F: literal struct LinearColor (serialized size: 16)\n         $1E: literal float 0.000000\n         $1E: literal float 0.660000\n         $1E: literal float 1.000000\n         $1E: literal float 1.000000\n         $30: EX_EndStructConst\n       $1E: literal float 2.000000\n       $21: literal name None\n       $16: EX_EndFunctionParms\nLabel_0x48:\n     $4: Return expression\n       $B: EX_Nothing\nLabel_0x4A:\n     $53: EX_EndOfScript\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"$xx"}]},{type:"text",value:" のように表示されているのが Blueprint VM の命令コードであり、それに合わせて命令の名前などを併記してくれています。\nまた、インデントを変えることでその内部で実行されている命令を表現してくれています。リテラル値を表す命令などではその値も示してくれているので、大変読みやすいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ただ、実際に Config に上記の設定を加えてみると、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Trace~"}]},{type:"text",value:" などのよくわからない命令が大量に入ると思います。これは Blueprint デバッガのための命令がノード単位で挿入されるからです。これを回避するには、エンジンのソースコードをいじるか、デバッガでデバッグ命令を挿入するかのフラグを上書きする必要があります。僕は面倒なので後者の手法で、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FKismetFunctionContext::bCreateDebugData"}]},{type:"text",value:" の値を "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"false"}]},{type:"text",value:" に上書きすることで綺麗な出力を得ています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"この知識何に使えるの"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%93%E3%81%AE%E7%9F%A5%E8%AD%98%E4%BD%95%E3%81%AB%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%AE",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"この知識、何に使えるの？"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"普段意識する必要は全く無いでしょう。しかし、記事中でも少し触れた "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CustomThunk"}]},{type:"text",value:" などの Thunk 関数を自作するようなコードは非常に強力です。というのも、本来は Blueprint VM 側に処理が隠されてしまい、結果の引数しか受け取れないはずの C++ 実装で、実行中の Blueprint VM の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FFrame"}]},{type:"text",value:" に直接操作を加えることができるのです。このため、ある種のメタプログラミングのようなことが可能になります。\n代表格は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Wildcard"}]},{type:"text",value:" ピンなどです。たまに見かける、繋いではじめて型が確定する灰色のピンがあると思いますが、あれが "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Wildcard"}]},{type:"text",value:" ピンで、そういった特殊な機能を気軽に利用できるようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、最適化などの面でもかなり役立つと思います。Blueprint VM を見ていると、案外まだ最適化の余地がありそうな実装がちらほら見受けられます。エンジンに手を加えずとも、Blueprint VM に様々な命令を実行させることはプロジェクトからも可能ですから、「さいきょうの最適化ノード」を構築することもできるでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回の記事では間に合いませんでしたが、バイトコードを生成しているコンパイラに対して手を加えることもできます。Blueprint Compiler には CompilerExtension というコンパイラ拡張用のAPIが存在しており、コンパイラ側から実行したいバイトコードを変更することができます。K2_Node を深いレベルから実装する場合、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FNodeHandlingFunctor::Compile()"}]},{type:"text",value:" という、ノードの動作を Blueprint Compiler が処理できるステートメントに記述し直す処理を実装する必要があります。この場合にも Blueprint VM の知識は大いに役立つでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Blueprint VM は、Unreal Engine でのコンテンツ制作に特化したドメイン固有言語であるということが、実装からもよくわかりました。\n高速化のためにバイトコードに変換されていますが、C++ との連携機能は柔軟かつ強力であり、我々が遊ぶ余地も沢山ありそうです。\nみなさんもどんどん 「Blueprint を書いて」いきましょう！"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"コンパイラまで書こうと思ったけど間に合わなかったよ！！！"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ところで、そろそろ公式に動きがありそうな新スクリプト言語 Verse が気になります。現時点の情報として、エンジンをまたいで利用可能なスクリプト言語であるとのことなので、Blueprint VM とは全く別の実行基盤が搭載されると考えたほうがよさそうです。\n一応コンテンツ制作向けということで DSL とも言えるのかもしれませんが、汎化の具合によっては一つの汎用言語として、Blueprint VM の実装思想とはかなり異なるものなのかもしれません。待ち遠しいですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"明日は "},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fqiita.com\u002Fdgtanaka",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"@dgtanake"}]},{type:"text",value:" さんの『UEのPCゲーム対応について』です。楽しみですね。\n　"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fa-little-harder-introduction-to-blueprint",extension:".md",createdAt:"2022-12-18T00:00:00.000Z",updatedAt:"2022-12-18T00:00:00.000Z",gitCreatedAt:"2022-12-03T11:05:47.000Z",gitUpdatedAt:"2022-12-18T08:05:11.000Z"},{slug:"try-using-enhanced-input",description:"Enhanced Input Plugin を解説してみる記事",title:"Enhanced Input の基礎的な解説",tags:["Unreal Engine","Blueprint","Input System","Enhanced Input"],assets:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input",toc:[{id:"input-action",depth:2,text:"Input Action"},{id:"input-mapping-context",depth:2,text:"Input Mapping Context"},{id:"trigger-と-modifier",depth:2,text:"Trigger と Modifier"},{id:"trigger",depth:3,text:"Trigger"},{id:"modifier",depth:3,text:"Modifier"},{id:"イベントの受け取り方",depth:2,text:"イベントの受け取り方"},{id:"利用する-input-mapping-context-の登録",depth:3,text:"利用する Input Mapping Context の登録"},{id:"イベントを利用する",depth:3,text:"イベントを利用する"},{id:"ia_move-移動アクション定義",depth:2,text:"IA_Move: 移動アクション定義"},{id:"ia_look-視点変更アクション定義",depth:2,text:"IA_Look: 視点変更アクション定義"},{id:"imc_keyboard-キーボードでのキーマッピング時の設定",depth:2,text:"IMC_Keyboard: キーボードでのキーマッピング時の設定"},{id:"ia_move-へのマッピング",depth:3,text:"IA_Move へのマッピング"},{id:"ia_look-へのマッピング",depth:3,text:"IA_Look へのマッピング"},{id:"imc_mouse-マウス入力時の設定",depth:2,text:"IMC_Mouse: マウス入力時の設定"},{id:"ia_move-へのマッピング-1",depth:3,text:"IA_Move へのマッピング"},{id:"ia_look-へのマッピング-1",depth:3,text:"IA_Look へのマッピング"},{id:"移動実装",depth:2,text:"移動実装"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"概要"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E6%A6%82%E8%A6%81",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"概要"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE には、Project Setting から可能な Input Mapping 機能があります。しかし、それとは別に、Enhanced Input という入力処理のプラグインがエンジンにビルトインされています。\nEnhanced Input は入力アクションの定義やマッピングをアセットベースで行うことが可能なほか、入力によって得られる値を柔軟に変換することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回は、Enhanced Input を使った入力処理を解説してみようと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"環境"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E7%92%B0%E5%A2%83",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Unreal Engine 5.0.1"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Windows 11"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"準備"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E6%BA%96%E5%82%99",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"準備"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Enhaned Input を利用するためには、まずプラグインを有効化する必要があります。 有効化して、エディタを再起動しましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"enable plugin",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fenable-plugin.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、Enhanced Input で入力を受け取るためには、Project Setting から "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Default Player Input Class"}]},{type:"text",value:" と "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Default Input Component Class"}]},{type:"text",value:" を変更する必要があります。　以下のように変更しましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"project setting",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fproject-setting.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"解説"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E8%A7%A3%E8%AA%AC",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"解説"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Enhanced Input を有効化すると、以下の 3 つのアセットが作成可能になります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"asset types",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fasset-types.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Input Action"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Input Mapping Context"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Player Bindable Input Config"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このうち、Input Action と Input Mapping Context についての説明を行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"input-action"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#input-action",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Input Action"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Input Action は、名前の通り"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"アクション"}]},{type:"text",value:"を定義できるアセットです。ここで言うアクションとは、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"移動"}]},{type:"text",value:"とか、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"銃を打つ"}]},{type:"text",value:"とか、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"レベル上のアクタにインタラクトする"}]},{type:"text",value:"のような、ゲーム上での意味を持つ行動の単位で、特に入力に紐づいて発生するものであると考えると良いと思います。進めていくとわかりますが、このアセットを作成し、アセット名を付けること自体が、一つのアクションの定義となっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このアセットでは、主に以下のようなことが設定できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Value Type : アクションから取得できる値の型\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"bool"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Axis1D → float"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Axis2D → Vector2D"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Axis3D → Vector"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Triggers : イベントを発火させるデフォルトのトリガ条件"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Modifiers : 取得前に行われるデフォルトの値変換処理"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"input action details",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Finput-action-details.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらが主要な設定項目なのですが、面白いことに、この中で Input Action が必ず設定しなければならないのは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Value Type"}]},{type:"text",value:" のみです。Triggers と Modifiers の設定は、後に説明する Input Mapping Context でも設定することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで考えておきたいのは、Project Setting などから行う入力マッピングと、Input Action で行えるアクション定義とでは、設定できる対象の"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"粒度"}]},{type:"text",value:"が異なるということです。\nキーボードでの前後左右移動を実装したいとき、従来であれば "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Move Forward"}]},{type:"text",value:" \u002F "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Move Right"}]},{type:"text",value:"のような軸別のイベントを複数定義して行うのが一般的だったと思います。\nしかし、Enhanced Input で移動を実装しようと思ったら、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IA_Move"}]},{type:"text",value:"という Input Action アセット（名前は例）を一つ作成し、Value Type に 2 次元の入力であることを示す"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Axis2D"}]},{type:"text",value:"を設定することで対応します。\nアクションが求める入力値のタイプと、そのアクションとを、入力のレベルでそのまま対応させるのです。明快ですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、Input Action では、そのアクションが"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"実際にどのデバイスのどの入力と紐づくのか"}]},{type:"text",value:"ということを設定しません。ここでは、アクションの宣言(アセットの作成と同義)と、そのアクションから得られる値の型さえ設定すればよいのです。インターフェースのようです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"input-mapping-context"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#input-mapping-context",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Input Mapping Context"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Input Mapping Context は、Input Action を使って定義したアクションと、実際のデバイスによる入力とのマッピングを行えるアセットです。\nInput Mapping Context によるキーマップは、アセットの単位で実行時に Player Controller に追加したり削除したりすることができます。\nシーンによって可能な操作を変更したり、入力に利用するデバイス別に Input Mapping Context を用意して切り替えたり、あとから DLC などで追加のデバイス用マッピングを追加したりなど、非常に柔軟な運用が可能となります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"主な設定項目は以下のようなものです。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"アクション定義として利用する Input Action"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"アクションにマップする入力(配列)\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Triggers: この入力における追加のトリガ条件"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Modifiers: この入力における追加の値変換処理"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Player Mappable Options: キーコンフィグの実装に利用できる、このマップ設定を指す名前などの情報"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"input mapping context details",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Finput-mapping-context-details.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Input Mapping Context には、複数の Input Action によるアクション定義への入力マッピングを設定できます。\n"},{type:"element",tag:"img",props:{alt:"multiple input action",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fmultiple-input-action.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Input Action 側でも設定できた Triggers や Modifiers ですが、Input Mapping Context に存在するプロパティも効果は全く同じです。異なるのは、その設定の影響範囲です。\nInput Action 側で設定した場合には、その Input Action によるアクション定義を使った、すべてのシチュエーションにおいて設定が適用されます。\n一方、Input Mapping Context 側で設定する場合には、その Input Mapping Context が有効な状況(Context)で、その特定のキーマッピングを利用した場合にのみ有効となる設定となります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"個人的には、基本は Input Mapping Context の方で設定を行うこととして、様々なシーンや入力デバイスを通しても共通と思われるトリガ条件や、常に行う値変換などがある場合にのみ、Input Action 側での設定を行うのが良いのではないかと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"trigger-と-modifier"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#trigger-%E3%81%A8-modifier",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Trigger と Modifier"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"改めて、Trigger と Modifier についての説明をしたいと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"trigger"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#trigger",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Trigger"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Trigger は、Input Action で定義したアクション、もしくは Input Mapping Context で定義されたキーマップが、イベントをトリガする条件を設定するものです。配列として複数設定することが可能です。\n注意として、Trigger はイベントの発火をフィルタするものであると捉えたほうがよいものです。イベントの発火を生み出すものではありません。\nEnhanced Input では、Trigger の登録数が 0 である場合、マッピングされたキーに何らかの入力がある時に、毎 Tick イベントが発火します。\nそこに Trigger を設定すると、Trigger の条件を満たすときにのみイベントが発火するようになるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Trigger には様々な種類が用意されており、選択したものによって、表示される設定項目が変わります。\nここに表示される Trigger は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UInputTrigger"}]},{type:"text",value:"クラスを継承して定義することによって、独自に実装することもできます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"triggers",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Ftriggers.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"modifier"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#modifier",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Modifier"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Modifier は、キー入力から得られた生の値を、対応するアクションの処理に利用できる値に変換するために利用するものです。\nInput Action で定義したアクション、もしくは Input Mapping Context で定義されたキーマップに対して設定することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"modifiers",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fmodifiers.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"例えば、前後左右の移動を行う場合、最終的な移動処理では、X 軸と Y 軸のそれぞれへの入力の大きさを値として（2 次元値として）利用したくなります。\nそんなとき、Input Action では、Value Type に"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Axis2D"}]},{type:"text",value:"を設定します。しかし、入力デバイスがキーボードなどである場合、前後左右それぞれに異なるキーをマッピングしなければならず、単純なマッピングでは求める値をアクションから得ることができません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Value Type が"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Axis2D"}]},{type:"text",value:"なアクションに対してキーボードからの入力が発生すると、それがどのキーであったとしても、Enhanced Input は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"text",value:"という値を受け取ります。ここで、Modifier を使うと、以下のように各方向への入力に対して、ほしい値を作り出すことができます。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"押されたキー"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"生の値"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"Modifier による変換"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"アクションから取得できる値"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"「前に進む」"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"行わない"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"「後ろに進む」"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Negate"}]},{type:"text",value:" Modifier で X 軸の符号反転を行う。"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(-1.0, 0.0)"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"「右に進む」"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Swizzle Input Axis Values"}]},{type:"text",value:" Modifier で、(X, Y)の値を(Y, X)に並び替える。"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(0.0, 1.0)"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"「左に進む」"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Negate"}]},{type:"text",value:" Modifier で X 軸の符号反転を行う。"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"その後、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Swizzle Input Axis Values"}]},{type:"text",value:" Modifier で、(X, Y)の値を(Y, X)に並び替える。"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(0.0, -1.0)"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これはすごいですね！　これまでの Project Setting によるマッピングでは、単純なスケールの変換くらいしかできませんでした。しかし、Enhanced Input では、次元を持った値を、様々な Modifier を組み合わせることで自在に変換し、あらゆる入力デバイスに対して対応できる統一的なアクションを定義することができるのです。\nこの機能を見ると、Input Action と Input Mapping Context の双方で Trigger や Modifier が設定できた理由がよくわかります。\nInput Action には共通の設定を行い、Input Mapping Context には様々な入力デバイスやシーンに応じたキーマッピングとトリガ条件、値の変換を記述することができるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Modifier も Trigger 同様、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UInputModifier"}]},{type:"text",value:"クラスを継承することで、独自に実装することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"イベントの受け取り方"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E5%8F%97%E3%81%91%E5%8F%96%E3%82%8A%E6%96%B9",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"イベントの受け取り方"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これでアクションとキーマッピングの定義法はわかったかと思います。\nここでは、実際にイベントを受け取る方法についての説明を行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"利用する-input-mapping-context-の登録"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B-input-mapping-context-%E3%81%AE%E7%99%BB%E9%8C%B2",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"利用する Input Mapping Context の登録"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Enhanced Input が発行するイベントを受け取るには、利用している"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"に、利用したい Input Mapping Context アセットを登録する必要があります。\nここで設定した Input Mapping Context アセットの内容が、その"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"で利用できるキーマッピング設定となるのです。この登録は、実行時に解除したり新たに登録したりすることができます。\n実際には、以下のように、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"が保持している "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Enhanced Input Local Player Subsystem"}]},{type:"text",value:"を通して設定を行うことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"pc imc register",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fpc-imc-register.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"が取得できる、Character や Pawn から設定を行うこともできます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"ch imc register",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fch-imc-register.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"複数のマッピングを登録したい場合には、配列などに Input Mapping Context を格納して、ループで登録したりなんてこともできます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"イベントを利用する"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"イベントを利用する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これで、イベントを受け取ることができます。\nEnhanced Input が有効になっていると、Input Action アセットを作成しただけで、ノード一覧に該当するイベントノードが登録されるようです。\nこの時点で、Input Mapping Context に設定したキーマッピングで、このイベントを発火させることができるようになります。\n定義に利用した Trigger の種類によって、有効な実行ピン(Triggered, Started, Ongoing, ...)が変化します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"ia event",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fia-event.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"注意点として、このノードは、そのアクションを利用する Input Mapping Context が登録されていなくても配置できるというものがあります。\n配置はできますが、利用している"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"に、そのアクションのイベントを発火させる Input Mapping Context が登録されていないと、永遠に発火することはありません。\nまた、このイベントノードは普通のイベントノードとは別物で(どこでもノード一覧に出てくることからもわかりますが)、Enhanced Input プラグイン内部で拡張されたノードです。\n配置すると、対応する Input Action をノード内部で"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ハード参照"}]},{type:"text",value:"します。\nつまり、このノードを配置した"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Character"}]},{type:"text",value:"や"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Controller"}]},{type:"text",value:"も、その Input Action アセットをハード参照することになります。\nこれを避けたい場合、C++などで Input Action セットのソフト参照からイベントを発火させるツールを書いたり、同様のものをプロジェクト専用の Player Controller クラスに実装したりする必要があると思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"移動ができる設定の例"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E7%A7%BB%E5%8B%95%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E8%A8%AD%E5%AE%9A%E3%81%AE%E4%BE%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"移動ができる設定の例"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"簡易的な移動が可能な設定の例を提示します。以下のことを実現します。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"マウスによる視点変更"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"視点方向に基づいた前後左右移動"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"複数種のデバイスによる移動入力\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"キーボード入力のコンテキスト"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"マウス入力のコンテキスト"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ia_move-移動アクション定義"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_move-%E7%A7%BB%E5%8B%95%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%AE%9A%E7%BE%A9",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Move: 移動アクション定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"IA_Move"}]},{type:"text",value:"という Input Action アセットを作成し、以下の項目を設定します。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Value Type: Axis2D(Vector2D)"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これだけです。"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"移動という入力アクションは、2 次元の値を提供するものである"}]},{type:"text",value:"という定義をしただけです。\n前後左右への移動ですので、2 次元の値です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ia_look-視点変更アクション定義"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_look-%E8%A6%96%E7%82%B9%E5%A4%89%E6%9B%B4%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E5%AE%9A%E7%BE%A9",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Look: 視点変更アクション定義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"IA_Look"}]},{type:"text",value:"という Input Action アセットを作成し、以下の項目を設定します。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Value Type: Axis2D(Vector2D)"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なんと"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IA_Move"}]},{type:"text",value:"と全く同じです。今回の視点変更は左右上下を見渡すことができればよいので、必要なのはやはり 2 次元の値だからです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"imc_keyboard-キーボードでのキーマッピング時の設定"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#imc_keyboard-%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E3%81%A7%E3%81%AE%E3%82%AD%E3%83%BC%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0%E6%99%82%E3%81%AE%E8%A8%AD%E5%AE%9A",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IMC_Keyboard: キーボードでのキーマッピング時の設定"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMC_Keyboard"}]},{type:"text",value:"という Input Mapping Context アセットを作成し、以下の項目を設定します。\n少し設定項目が多いので、画像で示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"imc keyboard",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fimc-keyboard.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ia_move-へのマッピング"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_move-%E3%81%B8%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Move へのマッピング"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"W"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"A"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"S"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"D"}]},{type:"text",value:" キーへのマッピングを行っています。\n移動なので、押されているときには常にイベントが発火し続けてほしいです。\nEnhanced Input は Trigger なしの場合に入力があると毎 Tick イベントが発火するようになるので、Trigger は設定しなくてよいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"各キーが示す方向にあわせて、入力で得られた生の値に対する Modifier による変換を設定しています。これについては、Modifier について説明した説で示した例が、この内容の説明となっています。そちらをご参照ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ia_look-へのマッピング"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_look-%E3%81%B8%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Look へのマッピング"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マウスの画面上での 2 次元移動へのマッピングを行っています。\n移動同様、常にイベントが発火してほしいものなので、Trigger は設定していません。マウスの動きが発生していと入力中という判定になります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マウスの移動から得られる生の値ははじめから 2 次元値なので、そのまま視点移動に使えそうな気もしますが、実際には画面の座標系の関係で Y 軸の値を反転させてやる必要があります。\nそのために、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Nagate"}]},{type:"text",value:" Modifier を一つ追加して、Y 軸の反転を設定しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"imc_mouse-マウス入力時の設定"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#imc_mouse-%E3%83%9E%E3%82%A6%E3%82%B9%E5%85%A5%E5%8A%9B%E6%99%82%E3%81%AE%E8%A8%AD%E5%AE%9A",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IMC_Mouse: マウス入力時の設定"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こちらは、マウス入力によって移動も行う場合の設定です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"imc mouse",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fimc-mouse.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ia_move-へのマッピング-1"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_move-%E3%81%B8%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0-1",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Move へのマッピング"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マウスで左右の移動を行うのは難しいので、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"マウスの左ボタンを 0.25 秒以上押し続けると前進を始める"}]},{type:"text",value:"というものにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ボタン入力は 1 次元の値なので、2 次元の値を要求する "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IA_Move"}]},{type:"text",value:"の場合、生の値は "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"(1.0, 0.0)"}]},{type:"text",value:"になります。これはそのままで前進を示す値(X 軸に正の値)なので、特に Modifier は必要ありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"0.25 秒以上押し続けたら、という条件は、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Hold"}]},{type:"text",value:" Trigger を追加し、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Hold Time Threshold"}]},{type:"text",value:" を設定することで対応しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"ia_look-へのマッピング-1"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ia_look-%E3%81%B8%E3%81%AE%E3%83%9E%E3%83%83%E3%83%94%E3%83%B3%E3%82%B0-1",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IA_Look へのマッピング"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMC_Keyboard"}]},{type:"text",value:"の場合と同様です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"移動実装"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E7%A7%BB%E5%8B%95%E5%AE%9F%E8%A3%85",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"移動実装"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マッピングの登録と、発火したイベントによる実際の移動や視点変更は、以下のように作成しました。\nこれは Player Controller に対する実装です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"pc impl",src:"\u002Farticle-assets\u002Funrealengine\u002Ftry-using-enhanced-input\u002F\u002Fpc-impl.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"BeginPlay のところを見ると、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"EInputDevice"}]},{type:"text",value:" の値で、マウスのキーマッピングとキーボードのキーマッピングのどちらを利用するかを簡潔に切り替えることができるようになっていることがわかります。\nそして、Input Action に対応した 2 つのイベントには、簡易的な移動と視点変更が実装されています。一つのアクションに対して一つのイベントが定義され、はじめから使いやすい変換済の値が入力されてくることを前提とできるため、こちらも大変簡潔に記述することができています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回は見やすさのため、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Input Mapping Context"}]},{type:"text",value:"の指定や、どのマッピングを利用するかの選択などを固定で記述していますが、実際には、これらすべてを実行時に動的に変更することができます。\nまた、この例のように異なるデバイスのマッピングを利用する場合には、切り替えではなく両方を同時に登録して使うことのほうが多いかとは思いますが、まあわかり易い例として……。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"良い機能ですね(しみじみ)。いっぱい使いたいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Player Bindable Input Config"}]},{type:"text",value:"について説明しませんでしたが、これを利用すると簡単にプレイヤーが利用可能なキーコンフィグを作成できます。機会を見て解説したいと思います。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Ftry-using-enhanced-input",extension:".md",createdAt:"2022-04-25T16:11:43.000Z",updatedAt:"2022-04-25T16:32:10.000Z",gitCreatedAt:"2022-04-25T16:11:43.000Z",gitUpdatedAt:"2022-04-25T16:32:10.000Z"},{slug:"the-directory-structure-of-modules-in-unrealengine",description:"結局モジュールのソース配置ってどういう効果を持ってるの？",title:"Unreal Engine におけるモジュール構造とUBTの挙動について",tags:["Unreal Engine","Unreal Build Tool","Unreal C++"],toc:[{id:"モジュールのスコープ",depth:2,text:"モジュールのスコープ"},{id:"ディレクトリ構造がヘッダのインクルードにもたらす効果",depth:2,text:"ディレクトリ構造がヘッダのインクルードにもたらす効果"},{id:"ubt-の内部でのインクルードパスの追加処理",depth:2,text:"UBT の内部でのインクルードパスの追加処理"},{id:"modulerules-によるモジュールのインクルードパスの制御方法",depth:2,text:"ModuleRules によるモジュールのインクルードパスの制御方法"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"概要"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E6%A6%82%E8%A6%81",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"概要"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Unreal Engine で C++を用いた開発を行うとき、まずはじめに出会う概念がモジュールです。Unreal Engine では巨大なプロジェクト(エンジン本体を含む)での機能別の依存関係を適切に管理するために、モジュールと言う仕組みを導入しています。\nこの仕組みは、Unreal Build Tool という C#製のツールによって実装されており、UBT が開発者の追加したモジュールやエンジンが持っているモジュール、マーケットプレイスえ購入してきたプラグインのモジュールなどを認識し、依存関係を解決することで、Unreal Engine でのビルドを実行しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++ソースを含むモジュールを作成する場合、以下のような構造が基本となります。 (C++モジュールに関連するものだけを記載しています。)"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"Source\n├── ModuleA\n│   ├── ModuleA.Build.cs\n│   └── [ソースを置く場所]\n└── ModuleB\n    ├── ModuleB.Build.cs\n    └── [ソースを置く場所]\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Source"}]},{type:"text",value:"の下には複数のモジュールを配置することも可能であるため、含むモジュールの個数や分け方によって"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Source"}]},{type:"text",value:"から実際のモジュールのディレクトリまでの経路は異なる場合があります。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Source"}]},{type:"text",value:"直下にモジュールの中身が置かれる場合もありますし、上記のように "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Source"}]},{type:"text",value:" の下に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleA"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleB"}]},{type:"text",value:"といったように複数のモジュールが配置されることもあります。\nしかし、モジュールのルートディレクトリ上の例では"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleA"}]},{type:"text",value:"や"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleB"}]},{type:"text",value:"など)の下の構造は、C++モジュールであれば、どの種類のモジュールでも同じルールで認識されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"そんな重要なモジュールディレクトリですが、内部のソースファイルの配置をどのようにすればよいかという点において、まとまった情報が皆無です。というか、UBT がモジュール内部のソースをどう認識しているのかのドキュメントが見当たりません。\nこれまでエンジンのモジュール等を見ながら雰囲気で配置を行っていたのですが、そろそろきちんとした理解を得ようと思い立ち、UBT のソースコードから調べてみました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"検証環境注意"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83%E6%B3%A8%E6%84%8F",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"検証環境&注意"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UE5.0"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ざっとソースを眺めてわかったつもりになってる情報を書いているだけなので、間違っているかもしれません。誤りを発見された方はご指摘ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、本記事で記載しているのは"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ディレクトリ構造に対する UBT の挙動について"}]},{type:"text",value:"であり、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"モジュールにおけるディレクトリ構造のベストプラクティスなどではない"}]},{type:"text",value:"ことにご留意ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"モジュールに対する-ubt-の挙動"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B-ubt-%E3%81%AE%E6%8C%99%E5%8B%95",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールに対する UBT の挙動"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"モジュールのスコープ"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%97",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールのスコープ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"本題の前に、モジュールのスコープという概念に触れておきます。UBT 内部では、すべてのモジュールを以下のいずれかのスコープに分類しているようです。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"スコープ"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"なにそれ"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Engine"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エンジンが直接保持しているモジュール。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource"}]},{type:"text",value:" 以下の、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Runtime"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Developer"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Editor"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ThirdParty"}]},{type:"text",value:" などに配置されたモジュールはこのスコープに属する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Engine Plugins"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エンジンがビルトインしているプラグインが保持するモジュール。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FPlugins"}]},{type:"text",value:" 以下にあるプラグインが持つモジュールはこのスコープに属する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Engine Programs"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エンジンが保持しているスタンドアロン系のツールが保持するモジュール。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource\u002FPrograms"}]},{type:"text",value:" 以下にあるモジュールはこのスコープに属する。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UnrealHeaderTool"}]},{type:"text",value:" などはこれ。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Marketplace"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"マーケットプレイスから入手され、ランチャーによって追加されたプラグインが保持するモジュール。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FPlugins\u002FMarketplace"}]},{type:"text",value:" 以下にあるプラグインが持つモジュールはこのスコープに属する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Project"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"プロジェクト側で直接保持するモジュール。 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"[ProjectName]\u002FSource"}]},{type:"text",value:" 以下にあるプロジェクトのモジュールと、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"[ProjectName]\u002FPlugins"}]},{type:"text",value:" 、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:".uproject"}]},{type:"text",value:" ファイルで "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AddtionalPluginDirectories"}]},{type:"text",value:"に指定されたディレクトリにあるプラグインのモジュールはこのスコープに属する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Plugin"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"外部プラグイン(Foreign plugin)が保持するモジュール。例えば UBT に "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"-Plugin"}]},{type:"text",value:" オプションで特定の "},{type:"element",tag:"code",props:{},children:[{type:"text",value:".uplugin"}]},{type:"text",value:" を指定して渡したようなプラグイン) が保持するモジュールはこのスコープに属する。"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このモジュールのスコープという概念が一体何に使われているのかというと、モジュール間の依存関係の制約に利用されているようです。\nスコープはそれぞれが独立して存在しているわけではなく、包含関係(親子関係)を持っています。具体的には、以下のような関係です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"Engine (すべての親)\n↑\nEngine Plugins\n↑\nEngine Programs\n↑\nMarketplace\n↑\nProject\n↑\nPlugin (すべての子)"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実際の使われ方は後で登場します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ディレクトリ構造がヘッダのインクルードにもたらす効果"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0%E3%81%8C%E3%83%98%E3%83%83%E3%83%80%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AB%E3%83%BC%E3%83%89%E3%81%AB%E3%82%82%E3%81%9F%E3%82%89%E3%81%99%E5%8A%B9%E6%9E%9C",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ディレクトリ構造がヘッダのインクルードにもたらす効果"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールのディレクトリ構造がもたらす効果の中で最も大きいのは、他のモジュールに対するヘッダファイルの公開\u002F非公開の制御です。この制御はモジュール同士のビルド時のリンケージ(リンク範囲)とも連動しており、モジュールシステムにおける依存関係管理の要となっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たとえば、以下のように "},{type:"element",tag:"code",props:{},children:[{type:"text",value:".Build.cs"}]},{type:"text",value:" ファイルの "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleRules"}]},{type:"text",value:" を記述したとします。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"using"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","namespace"]},children:[{type:"text",value:"UnrealBuildTool"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ExampleModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","type-list"]},children:[{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ModuleRules"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ExampleModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ReadOnlyTargetRules"}]},{type:"text",value:" Target"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"base"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Target"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\tPCHUsage "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" PCHUsageMode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"UseExplicitOrSharedPCHs"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n\t\tPublicDependencyModuleNames"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddRange"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Core\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"CoreUObject\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Engine\""}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このモジュールは、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Core"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CoreUObject"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine"}]},{type:"text",value:" という 3 つのモジュールに依存することになります。\nこれを行うことで、依存指定したモジュールで公開されているヘッダファイルにアクセスできるようになり、バイナリのリンクも通るようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"公開されたヘッダファイル"}]},{type:"text",value:"とはどのように指定されるものなのでしょうか？\nよく見るモジュール構造は以下の様なものです。この例はエンジンの UMG モジュールから借りてきました。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"UMG\n├── Private\n│   ├── Animation\n│   │   └── ...\n│   └── ...\n├── Public\n│   ├── Animation\n│   │   └── ...\n│   └── ...\n└── UMG.Build.cs\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このモジュール構造のよく見る要素は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Private"}]},{type:"text",value:"や"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Public"}]},{type:"text",value:"と言ったディレクトリ名だと思います。UBT 内部では、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UEBuildModuleCPP"}]},{type:"text",value:"というクラスにおいて、これらの特別扱いされるディレクトリが定義されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Classes"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Public"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Internal"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Private"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらのフォルダは UBT のソース内では"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"デフォルトインクルードパス"}]},{type:"text",value:"と呼称されているため、本記事でも今後はこれに倣います。\nデフォルトインクルードパスはそれぞれ、以下のような効果を持っています。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"デフォルトインクルードパス"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"効果"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Classes"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Classes"}]},{type:"text",value:" ディレクトリを参照してきたモジュールにインクルードパスとして公開する。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Classes"}]},{type:"text",value:" 内のヘッダは依存元モジュールから参照可能になる。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Public"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Classes"}]},{type:"text",value:" ディレクトリと同様。ただし、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"bNestedPublicIncludePaths"}]},{type:"text",value:"オプションが"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"true"}]},{type:"text",value:"になっている場合においては、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Public"}]},{type:"text",value:"ディレクトリ内部のディレクトリが再帰的に公開リストに追加される。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Internal"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"参照してきたモジュールのスコープが、自分属するスコープと同じか、いずれかの親スコープに含まれている(つまり、自分と同じか、より内部のモジュールである)場合にのみ、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Internal"}]},{type:"text",value:"ディレクトリをインクルードパスとして公開する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Private"}]},{type:"element",tag:"td",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Private"}]},{type:"text",value:"は、このディレクトリを含むモジュール自身をコンパイルする際、モジュール内部からインクルード可能なインクルードパスとしてプライベートなコンパイル環境に追加される。"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"他のモジュールに依存されたとしても、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Private"}]},{type:"text",value:"がインクルードパスとして他のモジュールに公開されることはない。"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"デフォルトで用意されている構造を利用する場合、以上のフォルダを利用すれば、依存関係を適切に制御したモジュールを構築することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ubt-の内部でのインクルードパスの追加処理"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#ubt-%E3%81%AE%E5%86%85%E9%83%A8%E3%81%A7%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AB%E3%83%BC%E3%83%89%E3%83%91%E3%82%B9%E3%81%AE%E8%BF%BD%E5%8A%A0%E5%87%A6%E7%90%86",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UBT の内部でのインクルードパスの追加処理"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまででデフォルトインクルードパスの働きをは掴めましたが、インクルードパスについてはもうちょっと書けることがあります。\nまず、デフォルトインクルードパスの UBT ハードコード部分がどういった処理を行っているかを以下に示します。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"デフォルトインクルードパス"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"具体処理"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Classes"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"自身のモジュール定義クラスのメンバ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PublicIncludePaths"}]},{type:"text",value:" に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Classes"}]},{type:"text",value:" のパスを追加する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Public"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"自身のモジュール定義クラスのメンバ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PublicIncludePaths"}]},{type:"text",value:" に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Public"}]},{type:"text",value:" のパスを追加する。また、そのサブディレクトリを"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"LegacyPublicIncludePaths"}]},{type:"text",value:"に再帰的に追加する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Internal"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"自身のモジュール定義クラスのメンバ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"InternalIncludePaths"}]},{type:"text",value:"に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Internal"}]},{type:"text",value:"のパスを追加する。"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Private"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"自身のモジュール定義クラスのメンバ "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PrivateIncludePaths"}]},{type:"text",value:" に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Private"}]},{type:"text",value:" のパスを追加する。"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらは、特定の名称のディレクトリを、モジュール定義クラスの特定のメンバに追加するという処理を行っているだけです。\n重要なのはここからで、これらが追加されている追加先のメンバには、普段モジュール定義として記述している"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".Build.cs"}]},{type:"text",value:"の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleRules"}]},{type:"text",value:"からも間接的にパスの追加が可能なのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すごそうに言いましたが、これ自体はすでにやったことがある人も多いかと思います。重要なのはむしろ逆で、デフォルトインクルードパスは予め定義されているというだけで、それほど特別なものではなく、適切に定義すれば"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleRules"}]},{type:"text",value:"からでも同等の効果を得る可能なディレクトリであるということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"modulerules-によるモジュールのインクルードパスの制御方法"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#modulerules-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%AF%E3%83%AB%E3%83%BC%E3%83%89%E3%83%91%E3%82%B9%E3%81%AE%E5%88%B6%E5%BE%A1%E6%96%B9%E6%B3%95",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ModuleRules によるモジュールのインクルードパスの制御方法"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さて、ここからの情報はインターネットにも落ちているものだと思いますが、 "},{type:"element",tag:"code",props:{},children:[{type:"text",value:".Build.cs"}]},{type:"text",value:" こと "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleRules"}]},{type:"text",value:" からモジュールが公開するインクルードパスの制御を行う方法を紹介します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"using"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","namespace"]},children:[{type:"text",value:"UnrealBuildTool"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ExampleModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","type-list"]},children:[{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ModuleRules"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"public"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"ExampleModule"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ReadOnlyTargetRules"}]},{type:"text",value:" Target"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"base"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Target"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\t\tPublicIncludePaths"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddRange"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 参照してきたモジュールに公開したいディレクトリを指定 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tInternalncludePaths"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddRange"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* 参照してきたモジュールが自分と同じスコープか、"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\t\t\tより内部（親方向）のモジュールであれば公開したいディレクトリを指定 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\tPrivateIncludePaths"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"AddRange"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\t\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F* このモジュール自身のビルドでインクルードパスとして利用したい内部のディレクトリを指定 *\u002F"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\t\t"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\t"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらを適切に設定すれば、デフォルトインクルードパスの構造を完全に無視して、独自の構造のモジュールを定義することも可能だと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なんでこの情報こんなに無いんだろう？"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fthe-directory-structure-of-modules-in-unrealengine",extension:".md",createdAt:"2022-04-16T17:57:26.000Z",updatedAt:"2022-04-16T17:57:26.000Z",gitCreatedAt:"2022-04-16T17:57:26.000Z",gitUpdatedAt:"2022-04-16T17:57:26.000Z"},{slug:"about-the-if-material-node-in-hlsl",description:"UEのマテリアルのIfノードは、HLSLにおいてはどのような形で実現されているのかのメモ",title:"マテリアルのIfノードはHLSLでどう展開されるのか",tags:["Unreal Engine","UE Material","UE Tips"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fabout-the-if-material-node-in-hlsl",toc:[{id:"サンプルマテリアル",depth:2,text:"サンプルマテリアル"},{id:"生成された-hlsl-コードを見てみる",depth:2,text:"生成された HLSL コードを見てみる"},{id:"該当部の-hlsl-コード",depth:2,text:"該当部の HLSL コード"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"前提シェーダープログラムは分岐に弱いらしい"},children:[{type:"element",tag:"a",props:{href:"#%E5%89%8D%E6%8F%90%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%80%E3%83%BC%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%AF%E5%88%86%E5%B2%90%E3%81%AB%E5%BC%B1%E3%81%84%E3%82%89%E3%81%97%E3%81%84",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"前提:シェーダープログラムは分岐に弱いらしい"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"シェーダープログラムは GPU で実行されます。GPU は CPU と比較すると、if などの命令パイプラインに分岐が入る命令が苦手なのは有名な話です。\n分岐が入ったプログラムでは、分岐の前後においてすべての実行コアが同じ命令を同じ時間実行していることが保証できなくなってしまい、SIMD のメリットを享受しにくくなってしまうためだと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"マテリアルの-if-ノードが気になる"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%81%AE-if-%E3%83%8E%E3%83%BC%E3%83%89%E3%81%8C%E6%B0%97%E3%81%AB%E3%81%AA%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"マテリアルの If ノードが気になる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE のマテリアルノードはシェーダーコンパイルの過程でノード → usf (unreal shader file) → HLSL → ... と変換されていき、最終的に各プラットフォームで利用可能な形式になります。\nところで、UE のマテリアルには If ノードがあります。前述の通り、If はシェーダープログラムにおいてボトルネックになりやすいポイントらしいのですが、マテリアルノードで配置した If はシェーダーコード上ではどういった形式になるのでしょうか"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"サンプルマテリアル"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"サンプルマテリアル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回は以下のようなマテリアルを対象として考えます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"sample material",src:"\u002Farticle-assets\u002Funrealengine\u002Fabout-the-if-material-node-in-hlsl\u002F\u002Fsample-material.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"極めて単純なマテリアルです。Base Color に If ノードを使った特に意味のない処理を接続しています。それ以外の値はデフォルト値のままです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"生成された-hlsl-コードを見てみる"},children:[{type:"element",tag:"a",props:{href:"#%E7%94%9F%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F-hlsl-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"生成された HLSL コードを見てみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マテリアルノードから生成された HLSL コードは、エディタの以下の位置から閲覧することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"show hlsl",src:"\u002Farticle-assets\u002Funrealengine\u002Fabout-the-if-material-node-in-hlsl\u002F\u002Fshow-hlsl.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"code",src:"\u002Farticle-assets\u002Funrealengine\u002Fabout-the-if-material-node-in-hlsl\u002F\u002Fhlsl-code.jpg"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ただ、このウィンドウはコードを読むには表示上も機能上も全く適していないので、Copy ボタンからコードをコピーし、お好きなエディタ上で閲覧することをおすすめします。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"該当部の-hlsl-コード"},children:[{type:"element",tag:"a",props:{href:"#%E8%A9%B2%E5%BD%93%E9%83%A8%E3%81%AE-hlsl-%E3%82%B3%E3%83%BC%E3%83%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"該当部の HLSL コード"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"hoge"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"void CalcPixelMaterialInputs(in out FMaterialPixelParameters Parameters, in out FPixelMaterialInputs PixelMaterialInputs)\n{\n    \u002F\u002F 略\n    MaterialFloat3 Local1 = ((abs(0.00000000 - 5.00000000) \u003E 0.00001000) ? (0.00000000 \u003E= 5.00000000 ? MaterialFloat3(1.00000000,0.00000000,0.00000000) : MaterialFloat3(0.00000000,0.00000000,1.00000000)) : MaterialFloat3(0.00000000,1.00000000,0.00000000));\n    \u002F\u002F 略\n    PixelMaterialInputs.BaseColor = Local1;\n    \u002F\u002F 略\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"省略しまくっていますが、今回の If ノードに対応する箇所は上記のコードのように実現されていました。見ると、素朴な条件演算子によって実現されていることがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"一般的に、シェーダープログラムにおいては条件演算子のほうが通常の If 文よりも高速であると言われます。\nIf 文は命令の流れ自体を切り替えてしまう(真の分岐)のに対して、条件演算子は条件式と、値として返すために引数として取った式のすべてを先に評価し、条件式の値に基づいて返す値を選択するという処理になる(ことが多い)ためです。\nこれであれば、実際には命令パイプライン上での分岐は発生していないため、値を得るための演算コストが分岐処理のコストを上回らない限りにおいては条件演算子が高速に動作します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"非常に曖昧な書き方をしましたが、これはコンパイラの最適化なども考慮に入れれば、GPU 上での処理とコードの記述が常にこのように対応するとは限らないためです。\n少なくとも、単純な式を扱う条件演算子は前述のような挙動をすると考えて良いと思います。逆に、コンパイラの賢さにもよりますが、内部が非常に単純な If 文であれば、真の分岐は行わずに両方の分岐先を実行した上で値を選択する可能性もあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この辺りについては、OpenGL Wiki によい記述がありましたのでよければご参照ください。(英語)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fwww.khronos.org\u002Fopengl\u002Fwiki\u002FShader#Execution_model_and_divergence",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"Shader#Execution model and divergence - OpenGL Wiki"}]}]},{type:"text",value:"\n"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめのようななにか"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%81%AA%E3%81%AB%E3%81%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめのようななにか"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"処理速度の話はプラットフォームごとのアーキテクチャやコンパイラの賢さによって複雑な場合分けが発生するためなんとも言えませんが、マテリアルの If ノードは条件演算子に展開されるということだけはわかりました。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fabout-the-if-material-node-in-hlsl",extension:".md",createdAt:"2022-02-13T13:41:25.000Z",updatedAt:"2022-02-13T13:48:20.000Z",gitCreatedAt:"2022-02-13T13:41:25.000Z",gitUpdatedAt:"2022-02-13T13:48:20.000Z"},{slug:"raytracing-on-a-material",description:"UEのマテリアルを使って、基本的な球のレイトレーシングを実装してみた記事",title:"UEのマテリアル上でレイトレーシングしてみた",tags:["Unreal Engine","UE Material"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material",toc:[{id:"レイトレーシングに使う座標系",depth:2,text:"レイトレーシングに使う座標系"},{id:"座標変換",depth:3,text:"座標変換"},{id:"レイを飛ばす始点と方向",depth:2,text:"レイを飛ばす始点と方向"},{id:"描画に必要な環境のパラメータを得る方法",depth:2,text:"描画に必要な環境のパラメータを得る方法"},{id:"球とレイの衝突判定",depth:2,text:"球とレイの衝突判定"},{id:"レイ",depth:2,text:"レイ"},{id:"球の衝突判定-custom-ノード",depth:2,text:"球の衝突判定 Custom ノード"},{id:"入力",depth:3,text:"入力"},{id:"出力",depth:3,text:"出力"},{id:"コード",depth:3,text:"コード"},{id:"衝突位置の関連値を計算",depth:2,text:"衝突位置の関連値を計算"},{id:"hit",depth:3,text:"Hit"},{id:"position",depth:3,text:"Position"},{id:"normal",depth:3,text:"Normal"},{id:"t-1",depth:3,text:"T"},{id:"簡易シェーディングマテリアルマテリアル関数",depth:2,text:"簡易シェーディングマテリアルマテリアル関数"},{id:"color",depth:3,text:"Color"},{id:"複数オブジェクトの描画",depth:2,text:"複数オブジェクトの描画"},{id:"実際に外部の環境情報を入力するマテリアル",depth:2,text:"実際に外部の環境情報を入力するマテリアル"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"はじめに"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"はじめに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"次の画像を御覧ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"intro lit",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fintro-lit.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"4 つの球がワールド上に配置されている用に見えます。しかし、これを Unlit 表示にすると次のようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"intro unlit",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fintro-unlit.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"何か不自然ですね。ではワイヤフレーム表示にしてみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"intro wireframe",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fintro-wireframe.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なんと、色がついた 3 つの球はポリゴンによるものではなく、板ポリに適用されたマテリアルによって描画されたものでした。本物のポリゴンによる球は白だけだったのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"趣旨"},children:[{type:"element",tag:"a",props:{href:"#%E8%B6%A3%E6%97%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"趣旨"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE のマテリアルだけを使って、簡易的な球のレイトレーシングを実装するサンプルを作ってみました。\nまた、UE のマテリアルで利用可能な機能を活用して、以下のようなことが実現されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"マテリアル上に描画された空間が連続して見えるように、使用中の CameraActor 位置に基づいた描画を行う"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"SkyLight の位置に基づいた、周囲のオブジェクトから浮かない簡易的な陰影づけ"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実際に動かしてみると、こんな感じです。"}]},{type:"text",value:"\n"},{type:"element",tag:"video",props:{controls:true,src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fmove.mp4"},children:[{type:"text",value:"move"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"完全にやってみたくてやった遊びなので実用性はあまりないですが、マテリアルのいろんな機能を使うサンプルとしては楽しいと思います。そんなに難しいことも出てきません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"環境"},children:[{type:"element",tag:"a",props:{href:"#%E7%92%B0%E5%A2%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Engine Version: 5.0.0 Early Access 2"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"作成に用いる考えと準備"},children:[{type:"element",tag:"a",props:{href:"#%E4%BD%9C%E6%88%90%E3%81%AB%E7%94%A8%E3%81%84%E3%82%8B%E8%80%83%E3%81%88%E3%81%A8%E6%BA%96%E5%82%99",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"作成に用いる考えと準備"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"レイトレーシングに使う座標系"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%A4%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%B3%E3%82%B0%E3%81%AB%E4%BD%BF%E3%81%86%E5%BA%A7%E6%A8%99%E7%B3%BB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レイトレーシングに使う座標系"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイトレーシングを行うには座標空間が必要です。今回は、マテリアルが適用されたオブジェクトの中心位置を、レイトレーシングで描画する内部座標系の原点"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{separator:"true"},children:[{type:"text",value:","}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{separator:"true"},children:[{type:"text",value:","}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"(0, 0, 0)"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mpunct"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.16666666666666666em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mpunct"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.16666666666666666em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]}]}]}]}]},{type:"text",value:"と決めました。\n(今後、レイトレーシングに使うマテリアル内部の空間の座標系のことは内部座標系と呼びます。)\nこれにより、マテリアルを適用したオブジェクトごとに異なる座標系上でレイトレーシングが行われることになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"座標変換"},children:[{type:"element",tag:"a",props:{href:"#%E5%BA%A7%E6%A8%99%E5%A4%89%E6%8F%9B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"座標変換"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回の実装では、内部座標系から見たら外側の、CameraActor の位置情報などをレイの生成に利用します。当然ですが、CameraActor などから取得できるのはワールド座標系での位置情報が原則です。この情報を内部座標系での処理に利用するには、ワールド座標系 → 内部座標系の座標変換が必要となります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで対象とするの 2 つの座標系は、どちらも同じ大きさ(?)の直交座標系であるため、線形代数で登場するような座標変換の手法は必要ありません。原点位置をオフセットするような演算を行うだけでよく、これは減算で実現できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"変換のために、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToRTSpace"}]},{type:"text",value:"というマテリアル関数を作成しました。ここで、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TargetPosition"}]},{type:"text",value:"はワールド座標系上の変換元の点、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ObjectOrigin"}]},{type:"text",value:"は今回の内部座標系の基準とする、ワールド座標系上でのオブジェクトの原点です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"to rtspace",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fto-rt-space.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今後、ワールド座標系 → 内部座標系の値の受け渡しで変換が必要なときに利用します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"レイを飛ばす始点と方向"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%A4%E3%82%92%E9%A3%9B%E3%81%B0%E3%81%99%E5%A7%8B%E7%82%B9%E3%81%A8%E6%96%B9%E5%90%91",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レイを飛ばす始点と方向"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイトレーシングを行うためには、レイを飛ばさなければなりません。今回は image-order なレイトレーシングを考えるため、カメラ位置から、描画されるピクセル一つ一つに向かうようなレイを生成します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すると、レイの始点はカメラ位置（ワールド座標系から内部座標系に変換されたもの）となり、レイの方向は「カメラ位置 → マテリアルが適用されたオブジェクト表面上の点位置」とできます。\nこの方向ベクトルはまたしても減算で手に入れることができます。得られた方向ベクトルは後々のために正規化しておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイの方向を得る処理は、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateRayDirection"}]},{type:"text",value:"というマテリアル関数に記述しました。ここで、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AbsoluteWorldPosition"}]},{type:"text",value:"はマテリアルが適用されたオブジェクトの表面上の点、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CameraPosition"}]},{type:"text",value:"はカメラ位置です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"create ray direction",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fcreate-ray-direction.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイの始点を得る処理は、カメラ位置がそのまま始点と対応するため記述の必要がありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"描画に必要な環境のパラメータを得る方法"},children:[{type:"element",tag:"a",props:{href:"#%E6%8F%8F%E7%94%BB%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E7%92%B0%E5%A2%83%E3%81%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%82%92%E5%BE%97%E3%82%8B%E6%96%B9%E6%B3%95",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"描画に必要な環境のパラメータを得る方法"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"カメラ位置やライト情報に基づいた描画をするには、それらの位置を取得せねばなりません。また、座標系構築のためにはマテリアルを適用したオブジェクトの中心位置が必要ですし、レイの射出方向を決めるにはそのオブジェクトの描画された表面上の任意の点の位置も必要です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらはすべて、UE の Material に標準で用意されているノードから取得することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"bulitin nodes",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fbuiltin-nodes.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"詳細は検索すれば出てくるので割愛するとして、概要を示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"camera-position"},children:[{type:"element",tag:"a",props:{href:"#camera-position",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Camera Position"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"現在の Viewport の視点となっているカメラのワールド座標系における位置を取得できるノード。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"skyatmospherelightdirection"},children:[{type:"element",tag:"a",props:{href:"#skyatmospherelightdirection",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"SkyAtmosphereLightDirection"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レベル上の DirectionalLight の方向ベクトルを取得できるノード。DirectionalLight は無限遠からの平行光線を想定した光源なので、位置に意味がなく、方向のみが取得できる。\n今回の描画はこのライト情報に基づく。取得ライトのインデックスは、DirectionalLight の Atmosphere Sun Light Index プロパティと対応する。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"object-position"},children:[{type:"element",tag:"a",props:{href:"#object-position",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Object Position"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レベルに配置されたオブジェクトのバウンディングボックスから、その中心位置をワールド座標系に基づいて取得できるノード。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"absolute-world-position-world-position"},children:[{type:"element",tag:"a",props:{href:"#absolute-world-position-world-position",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Absolute World Position (World Position)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"オブジェクトの表面上の任意の点の、ワールド座標系での位置を取得できるノード。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"球とレイの衝突判定"},children:[{type:"element",tag:"a",props:{href:"#%E7%90%83%E3%81%A8%E3%83%AC%E3%82%A4%E3%81%AE%E8%A1%9D%E7%AA%81%E5%88%A4%E5%AE%9A",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"球とレイの衝突判定"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"球とレイの衝突判定について詳説するには数学的な解説が必要となりますが、すでに先行する多くの有用な資料がありますので、ここでは詳説せず、経過のみを述べます。参考になりそうな資料のリンクを貼っておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fweb.wakayama-u.ac.jp\u002F~tokoi\u002Flecture\u002Fcg\u002Fcgnote14.pdf",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"和歌山大学 コンピュータグラフィックス講義資料"}]}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fknzw.tech\u002Fraytracing\u002F?page_id=78",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"東京電機大学 工学部第二部情報通信工学実験　グラフィックス応用テキスト"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"球は、その中心点と半径の 2 つのパラメータによって位置と形状を決定できます。これは、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"を球面上の任意の点、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{c}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.714em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"を球の中心点、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"r"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.43056em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]}]}]}]}]},{type:"text",value:"を半径としたとき、以下の式で記述できることを示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\|\\vec{p} - \\vec{c}\\| = r"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.43056em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"は球面上の任意の点なので、この点がレイの線上のどこかの点と共有できるならば、球とレイが衝突したことになります。\n共有する点が存在するかどうかは、単純に球のベクトル方程式にレイの方程式を代入して、レイの方程式に登場した"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"について解けば良いです。すると二次方程式になるので、二次方程式の解の公式に従って変形すると、以下のようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{style:"display: flex; inline-size: 100%; justify-content: center; flex-wrap: wrap"},children:[{type:"text",value:"\n"},{type:"element",tag:"div",props:{style:"margin: 0 25px"},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"A"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"A = \\vec{d} \\cdot \\vec{d}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"A"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:" "},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"B"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"B = \\vec{d} \\cdot (\\vec{s} - \\vec{c})"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.05017em;"},children:[{type:"text",value:"B"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]}]}]}]}]},{type:"text",value:" "},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"C"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"msup",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"2"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"C = (\\vec{s} - \\vec{c}) \\cdot (\\vec{s} - \\vec{c}) - r^2"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.07153em;"},children:[{type:"text",value:"C"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.8141079999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.8141079999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3.063em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"text",value:"2"}]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{style:"margin: 0 25px"},children:[{type:"text",value:"\n"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mfrac",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"B"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"±"}]},{type:"element",tag:"msqrt",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"msup",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"B"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"2"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"A"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"C"}]}]}]}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"A"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t = \\frac{-B \\pm \\sqrt{B^2 - AC}}{A}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:2.276389em;vertical-align:-0.686em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mopen","nulldelimiter"]},children:[]},{type:"element",tag:"span",props:{className:["mfrac"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:1.590389em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.314em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"A"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.23em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["frac-line"],style:"border-bottom-width:0.04em;"},children:[]}]},{type:"element",tag:"span",props:{style:"top:-3.677em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.05017em;"},children:[{type:"text",value:"B"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"±"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","sqrt"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.913389em;"},children:[{type:"element",tag:"span",props:{className:["svg-align"],style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"],style:"padding-left:0.833em;"},children:[{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.05017em;"},children:[{type:"text",value:"B"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.740108em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.9890000000000003em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"text",value:"2"}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"A"}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.07153em;"},children:[{type:"text",value:"C"}]}]}]},{type:"element",tag:"span",props:{style:"top:-2.873389em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["hide-tail"],style:"min-width:0.853em;height:1.08em;"},children:[{type:"element",tag:"svg",props:{width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},children:[{type:"element",tag:"path",props:{d:"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z"},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.12661100000000003em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.686em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose","nulldelimiter"]},children:[]}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"br",props:{},children:[]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"について解いたの式の、ルートの内部に注目します。この式はルートの中に入っているため、値が負になってしまうと実数に解を持たなくなります。複素数の位置など登場しませんので、レイ上と球面上に共有する点はないとみなしてよいことになります。よって、ルート内の式の値を見て、それが"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"0"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.64444em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]}]}]}]}]},{type:"text",value:"以上であるかを確認するだでレイが球と衝突したかどうかを判別できることになります。これを判別式"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"D"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"D"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"D"}]}]}]}]}]},{type:"text",value:"とします。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"D"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"msup",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"B"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"2"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"A"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"C"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"D = B^2 - AC"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"D"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9474379999999999em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.05017em;"},children:[{type:"text",value:"B"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.8641079999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3.113em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"text",value:"2"}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.68333em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"A"}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.07153em;"},children:[{type:"text",value:"C"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この判別式が"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"0"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.64444em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]}]}]}]}]},{type:"text",value:"以上であった場合のみ、衝突位置の計算などを行います。衝突位置は、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"について解いた式に衝突時のパラメータを代入し、求まった"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"を元にレイのベクトル方程式から"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"を求めればよいです。このとき、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"を求めるのに使う式の"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{},children:[{type:"text",value:"±"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\pm"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.66666em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"±"}]}]}]}]}]},{type:"text",value:"を"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"-"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.66666em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"−"}]}]}]}]}]},{type:"text",value:"に変更していますが、これはレイの始点から見て近いほうの共有点さえわかれば良いためです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"+"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"+"}]},{type:"element",tag:"mfrac",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"B"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"msqrt",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"D"}]}]}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"A"}]}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"D"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"≥"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p} = \\vec{s} + t\\vec{d} = \\vec{s} + \\frac{-B-\\sqrt{D}}{A} \\vec{d} \\;\\;\\; (D \\geq 0)"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.79733em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"+"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.79733em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"+"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:2.2896650000000003em;vertical-align:-0.686em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mopen","nulldelimiter"]},children:[]},{type:"element",tag:"span",props:{className:["mfrac"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:1.6036650000000001em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.314em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"A"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.23em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["frac-line"],style:"border-bottom-width:0.04em;"},children:[]}]},{type:"element",tag:"span",props:{style:"top:-3.6770000000000005em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.05017em;"},children:[{type:"text",value:"B"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","sqrt"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9266650000000001em;"},children:[{type:"element",tag:"span",props:{className:["svg-align"],style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"],style:"padding-left:0.833em;"},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"D"}]}]}]},{type:"element",tag:"span",props:{style:"top:-2.886665em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["hide-tail"],style:"min-width:0.853em;height:1.08em;"},children:[{type:"element",tag:"svg",props:{width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice"},children:[{type:"element",tag:"path",props:{d:"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z"},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.11333499999999996em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.686em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose","nulldelimiter"]},children:[]}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"D"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"≥"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"実際に作成する"},children:[{type:"element",tag:"a",props:{href:"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"実際に作成する"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"レイ"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%A4",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レイ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイを作成します。準備していおいたものを組み合わせて、以下のように記述できます。\n"},{type:"element",tag:"img",props:{alt:"make ray",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fmake-ray.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToRTSpace"}]},{type:"text",value:"で"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Camera Position"}]},{type:"text",value:"から取得したカメラのグローバル座標系上の位置を内部座標系の位置に変換し、Ray の始点の位置ベクトルを作成します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateRayDirection"}]},{type:"text",value:"で、カメラ位置とオブジェクトの表面上の点の位置から、Ray の方向ベクトルを作成します。この方向ベクトルはカメラとオブジェクト上の点の相対的な位置に基づいており、グローバル座標系と内部座標系は基底が同じスケールの直交座標系であることから、座標変換を行わなくても適切な方向ベクトルを作成できます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これで、レイを記述する以下の式が利用できます。\n"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"がレイの線上で取り得る任意の点、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{s}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.714em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"がレイの始点、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{d}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"がレイの方向です。\n"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"がパラメータとして変化することで、レイの線上の任意の点を指し示すことができるということです。\nまた、レイは視線と逆方向に飛ばしても意味がないので、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t \u003E 0"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.65418em;vertical-align:-0.0391em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.64444em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]}]}]}]}]},{type:"text",value:"とします。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"+"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p} = \\vec{s} + t\\vec{d} \\;\\;\\; (t \u003E 0)"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.79733em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"+"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1.2274399999999999em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"球の衝突判定-custom-ノード"},children:[{type:"element",tag:"a",props:{href:"#%E7%90%83%E3%81%AE%E8%A1%9D%E7%AA%81%E5%88%A4%E5%AE%9A-custom-%E3%83%8E%E3%83%BC%E3%83%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"球の衝突判定 Custom ノード"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"衝突判定くらいの複雑度をもつ処理になってくると、ノードで書いた際の可読性の低下が著しくなってきます。ここでは Custom ノードを用いて HLSL コードとして記述していくことにします。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Custom ノードは以下のようなインターフェイスとしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"hit sphere custom",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fhit-sphere-custom.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"入力"},children:[{type:"element",tag:"a",props:{href:"#%E5%85%A5%E5%8A%9B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"入力"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"rayorigin"},children:[{type:"element",tag:"a",props:{href:"#rayorigin",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"RayOrigin"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"判定を行うレイの始点を示す位置ベクトル"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"raydirection"},children:[{type:"element",tag:"a",props:{href:"#raydirection",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"RayDirection"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"判定を行うレイの方向ベクトル"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"tmax"},children:[{type:"element",tag:"a",props:{href:"#tmax",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"TMax"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"レイのベクトル方程式に登場した変数"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"が取り得る最大の値。\n"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"が大きくなると、レイの式はより遠くの点を示すようになります。逆に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TMax"}]},{type:"text",value:"で"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"の最大値を制限すると、それよりも遠方にある衝突点には衝突しないようにすることができます。これは、一直線上に複数のオブジェクトが存在している際の、重なり処理を行うために導入しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"center"},children:[{type:"element",tag:"a",props:{href:"#center",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Center"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"球の中心点"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"radius"},children:[{type:"element",tag:"a",props:{href:"#radius",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Radius"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"球の半径"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"出力"},children:[{type:"element",tag:"a",props:{href:"#%E5%87%BA%E5%8A%9B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"出力"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"return"},children:[{type:"element",tag:"a",props:{href:"#return",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"return"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"衝突判定を 0\u002F1 で表す\nCustom ノードはデフォルト戻り値の名称を変更できないためわかりにくくなっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"t"},children:[{type:"element",tag:"a",props:{href:"#t",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"T"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"衝突した場合、衝突したポイントでのレイの方程式の"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"の値を返す。衝突しなかった場合、入力の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TMax"}]},{type:"text",value:"の値をそのまま出力する。\nこの出力を次回以降の同一レイの衝突判定では"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TMax"}]},{type:"text",value:"として使うことで、同一レイの線上に異なる物体が発見されたとしても、より近い場所になければ判定を無視することが可能になります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"コード"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B3%E3%83%BC%E3%83%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"コード"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"HLSL によるコードはとても短いです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"HitSphere"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"float3 OC = RayOrigin - Center;\n\nfloat A = dot(RayDirection, RayDirection);\nfloat B = dot(RayDirection, OC);\nfloat C = dot(OC, OC) - pow(Radius, 2);\nfloat D = pow(B, 2) - A*C;\n\nif (D \u003E= 0) {\n  float curT = (-B - sqrt(D)) \u002F A;\n  if (curT \u003E 0 && curT \u003C TMax) {\n    T = curT;\n    return 1;\n  }\n}\n\nT = TMax;\nreturn  0;"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"衝突位置の関連値を計算"},children:[{type:"element",tag:"a",props:{href:"#%E8%A1%9D%E7%AA%81%E4%BD%8D%E7%BD%AE%E3%81%AE%E9%96%A2%E9%80%A3%E5%80%A4%E3%82%92%E8%A8%88%E7%AE%97",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"衝突位置の関連値を計算"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ひとつ上で作成した衝突判定を包む形で、関連する値を計算します。ここでは、内部座標系における衝突位置、衝突位置での球面の法線などを求めます。簡単な計算ですので、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Sphere"}]},{type:"text",value:"というマテリアル関数にノードで実装しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"sphere mat func",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fsphere-mat-func.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下で各値の求め方を記載します。ノードはこれに対応しているだけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"hit"},children:[{type:"element",tag:"a",props:{href:"#hit",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Hit"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"衝突判定関数の戻り値をそのまま使っているだけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"position"},children:[{type:"element",tag:"a",props:{href:"#position",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Position"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"衝突判定関数から得られた、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"T"}]},{type:"text",value:"のパラメータをレイの方程式に代入することで、衝突位置を得ることができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"+"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"d"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mtext",props:{},children:[{type:"text",value:"  "}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p} = \\vec{s} + t\\vec{d} \\;\\;\\; (t \u003E 0)"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.79733em;vertical-align:-0.08333em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"s"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"+"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1.2274399999999999em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"d"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.06882999999999997em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"normal"},children:[{type:"element",tag:"a",props:{href:"#normal",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Normal"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"球面上のレイ衝突点の法線ベクトルです。\n法線は面に対して垂直な直線ですから、球の場合には球の中心から球面上の点に向かうベクトルはすべて、その点での法線と同じ方向のベクトルとなります。\n正規化もしておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"n"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mfrac",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{n} = \\frac{\\vec{p} - \\vec{c}}{\\|\\vec{p} - \\vec{c}\\|}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.714em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"n"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.2355em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:2.327em;vertical-align:-0.936em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mopen","nulldelimiter"]},children:[]},{type:"element",tag:"span",props:{className:["mfrac"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:1.391em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.314em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.23em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["frac-line"],style:"border-bottom-width:0.04em;"},children:[]}]},{type:"element",tag:"span",props:{style:"top:-3.677em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.936em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose","nulldelimiter"]},children:[]}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"t-1"},children:[{type:"element",tag:"a",props:{href:"#t-1",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"T"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これも衝突判定関数の戻り値をそのまま使っているだけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"簡易シェーディングマテリアルマテリアル関数"},children:[{type:"element",tag:"a",props:{href:"#%E7%B0%A1%E6%98%93%E3%82%B7%E3%82%A7%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E9%96%A2%E6%95%B0",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"簡易シェーディングマテリアルマテリアル関数"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまで作成したもので、ある視点から見たときの球の形状は判定できるようになりました。ここでは球のシェーディングマテリアルを作成していきます。\nシェーディングは二次的なレイのトレースによるものが望ましいですが、今回はライト方向と法線の内積を用いた簡易的なものにしました。\nきちんとしたレイトレースによる色付けを考える場合にはノードだと（主に繰り返し処理が）厳しいので、もっと広範囲を HLSL で記述したほうが良いと思いますが、今回は趣旨と外れるのでやめておきました。\n以下がシェーディング用の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"DotShading"}]},{type:"text",value:"マテリアル関数です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"dot shading",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fdot-shading.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"color"},children:[{type:"element",tag:"a",props:{href:"#color",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Color"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"l"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{l}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9774399999999999em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.01968em;"},children:[{type:"text",value:"l"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"をライト方向として導入します。また、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"msub",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"P"}]},{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"b"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"a"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"e"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"l"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"P_\\mathit{basecolor}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.83333em;vertical-align:-0.15em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.13889em;"},children:[{type:"text",value:"P"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.33610799999999996em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"b"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"a"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"s"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"e"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"c"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"l"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"r"}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.15em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]}]},{type:"text",value:"はその点を塗るベースカラーです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"msub",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"P"}]},{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"l"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"("}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"l"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"n"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:")"}]},{type:"element",tag:"msub",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"P"}]},{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"b"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"a"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"s"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"e"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"l"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"o"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"P_\\mathit{color} = (\\vec{l} \\cdot \\vec{n}) P_\\mathit{basecolor}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.83333em;vertical-align:-0.15em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.13889em;"},children:[{type:"text",value:"P"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.33610799999999996em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"c"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"l"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"r"}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.15em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1.2274399999999999em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.9774399999999999em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.01968em;"},children:[{type:"text",value:"l"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3.26344em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"⋅"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"n"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.2355em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.13889em;"},children:[{type:"text",value:"P"}]},{type:"element",tag:"span",props:{className:["msupsub"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.33610799999999996em;"},children:[{type:"element",tag:"span",props:{style:"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:2.7em;"},children:[]},{type:"element",tag:"span",props:{className:["sizing","reset-size6","size3","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mtight"]},children:[{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"b"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"a"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"s"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"e"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"c"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"l"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"o"}]},{type:"element",tag:"span",props:{className:["mord","mathit","mtight"]},children:[{type:"text",value:"r"}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.15em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ただし、ノード上では陰影の濃度の調整のために少し処理を追加しています。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Add"}]},{type:"text",value:"で乗算する内積値の下限を底上げしているだけですが、そのままでは内積値が負の値を持ってしまう特性で意味がなくなってしまうので、事前に"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"saturate"}]},{type:"text",value:"しています。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"saturate"}]},{type:"text",value:"は現代の GPU ではノーコストで実行できるので、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"["}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"0"}]},{type:"element",tag:"mo",props:{separator:"true"},children:[{type:"text",value:","}]},{type:"element",tag:"mn",props:{},children:[{type:"text",value:"1"}]},{type:"element",tag:"mo",props:{stretchy:"false"},children:[{type:"text",value:"]"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"[0, 1]"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mopen"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["mpunct"]},children:[{type:"text",value:","}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.16666666666666666em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"1"}]},{type:"element",tag:"span",props:{className:["mclose"]},children:[{type:"text",value:"]"}]}]}]}]}]},{type:"text",value:"へのクランプでは"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"clamp"}]},{type:"text",value:"よりおすすめです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"複数オブジェクトの描画"},children:[{type:"element",tag:"a",props:{href:"#%E8%A4%87%E6%95%B0%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E6%8F%8F%E7%94%BB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"複数オブジェクトの描画"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先ほど作成した球の描画マテリアル関数を使えば、もう単一の球を描画することができます。しかし、せっかくなので複数のオブジェクトを描画できるようにしたいです。複数オブジェクト描画用のマテリアル関数を考えていきます。このマテリアル関数は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Render"}]},{type:"text",value:"という名称とします。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"render mat func",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Frender-mat-func.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この関数はここまでの作業の集大成となっています。処理の流れは以下のようなものです。"}]},{type:"text",value:"\n"},{type:"element",tag:"ol",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"レイ情報("},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RayOrigin"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RayDirection"}]},{type:"text",value:")、ライト方向("},{type:"element",tag:"code",props:{},children:[{type:"text",value:"LightDirection"}]},{type:"text",value:")、レイの"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"値の初期値("},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TMax"}]},{type:"text",value:")を入力として受け取る。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Sphere"}]},{type:"text",value:"関数で球の衝突判定をする。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"DotShading"}]},{type:"text",value:"関数でシェーディングを行い、色を決定する。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"以上の処理を 1 単位としてカスケード接続し、衝突判定結果に応じて色とノーマルを"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Lerp"}]},{type:"text",value:"で合成、全体でのオブジェクトの衝突位置を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Add"}]},{type:"text",value:"で統合する。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"描画全体の衝突判定結果を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Hit"}]},{type:"text",value:"、描画結果を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Color"}]},{type:"text",value:"、ノーマルの描画結果を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Normal"}]},{type:"text",value:"、この描画を通して得られたレイの最短衝突位置(を導ける変数)である"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"t"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"t"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.61508em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"t"}]}]}]}]}]},{type:"text",value:"を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"T"}]},{type:"text",value:"として出力する。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"実際に外部の環境情報を入力するマテリアル"},children:[{type:"element",tag:"a",props:{href:"#%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%A4%96%E9%83%A8%E3%81%AE%E7%92%B0%E5%A2%83%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E5%8A%9B%E3%81%99%E3%82%8B%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"実際に外部の環境情報を入力するマテリアル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまでの処理はみなマテリアル関数として記述してきましたが、すでにレイトレースに必要な処理は出揃ったので、実際にオブジェクトに適用するマテリアルを作成します。このマテリアルでは、実際のライト方向やカメラ位置などの環境情報を入力します。マテリアル名は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"RayTracing"}]},{type:"text",value:"としました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"raytracing mat",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fraytracing-mat.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このマテリアルでの描画はマテリアルによって実装されているので、エンジンが持っているライティングによってシェーディングを受ける必要はありません。\nそのため、マテリアルの Shading Model は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Unlit"}]},{type:"text",value:"にしてあります。\nまた、Blend Mode を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Masked"}]},{type:"text",value:"とし、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Render"}]},{type:"text",value:"マテリアル関数の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Hit"}]},{type:"text",value:"出力を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Opacity Mask"}]},{type:"text",value:"に入力してみました。これによって、衝突が検出されなかった場所はマスクされることになり、あたかもレイトレースで描画したオブジェクトがそこに存在するかのように見せることができます。\nその他、ノードの接続については、ここまでで解説したものを適切につなげているだけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下はマテリアルエディタ上の View で板ポリに描画された"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Raytracing"}]},{type:"text",value:"マテリアルです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"result view",src:"\u002Farticle-assets\u002Funrealengine\u002Fraytracing-on-a-material\u002F\u002Fresult-view.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"3 つの球があります！(板です)"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こうして作成されたマテリアルをそこらのメッシュに適用すれば、そのメッシュの輪郭の内側をスクリーンとして、実装したレイトレースによるオブジェクトを描画できます。\nどのように見えるかは、記事冒頭の動画をご参照ください。\n使いみちは不明ですが、UE のマテリアルの機能を色々使えて楽しいです。おわりです。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fraytracing-on-a-material",extension:".md",createdAt:"2022-01-31T07:18:53.000Z",updatedAt:"2022-01-31T11:01:13.000Z",gitCreatedAt:"2022-01-31T07:18:53.000Z",gitUpdatedAt:"2022-01-31T11:01:13.000Z"},{slug:"draw-rectangles-lines-on-uv-coords",description:"UEのマテリアルを使って、UV座標上に図形を描画するメモ",title:"マテリアルでUV座標上に図形を描く",tags:["Unreal Engine","UE Material"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords",toc:[{id:"uv-座標から長方形マスクを作成する",depth:2,text:"UV 座標から長方形マスクを作成する"},{id:"色付き長方形を作成する",depth:2,text:"色付き長方形を作成する"},{id:"使ってみる",depth:2,text:"使ってみる"},{id:"円の数学的な表示",depth:2,text:"円の数学的な表示"},{id:"円のマスクを描画する",depth:2,text:"円のマスクを描画する"},{id:"色付き円を作成する",depth:2,text:"色付き円を作成する"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"趣旨"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E8%B6%A3%E6%97%A8",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"趣旨"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UV 座標空間に長方形とかの図形を描くマテリアルを遊びで作ったのでメモとして記事にしておきます。以下のようなことになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"video",props:{controls:true,src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Frectangles.mp4"},children:[{type:"text",value:"draw-rect-mask-internal"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"環境"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E7%92%B0%E5%A2%83",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Engine Version: 5.0.0 Early Access 2"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"長方形"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E9%95%B7%E6%96%B9%E5%BD%A2",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"長方形"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"uv-座標から長方形マスクを作成する"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#uv-%E5%BA%A7%E6%A8%99%E3%81%8B%E3%82%89%E9%95%B7%E6%96%B9%E5%BD%A2%E3%83%9E%E3%82%B9%E3%82%AF%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UV 座標から長方形マスクを作成する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、以下のような Material Function を作成しました。Custom ノード内部の内部で各ピクセルの UV 座標に基づいて長方形の内外を判定し、マスクを作成しています。\n"},{type:"element",tag:"img",props:{alt:"draw-rect-mask-internal.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Fdraw-rect-mask-internal.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Custom Nodeのコード"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"float range = abs(UVs.x - 0.5 + Offset.x);\nfloat half_w = Width \u002F 2;\n\nfloat ubGrad = (0.5 - abs(UVs.y - 0.5 + Offset.y)) * 2;\nfloat mask = int((ubGrad - CutOut*2) + 0.999999);\n\nfloat lineBase = 1-int(range - half_w + 0.999999);\n\nreturn mask * lineBase;"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"シェーダーにおいては、if などによる分岐命令パイプライン上で分岐が発生する機能を使用すると大きな性能低下が見られるため、if を用いない形で記述しています。\nそのため少しわかりにくくなっていますが、やっていることは"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Width"}]},{type:"text",value:"の幅を持ち、上下を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CutOut"}]},{type:"text",value:"の大きさだけカットされ、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Offset"}]},{type:"text",value:"分描画位置をオフセットされた長方形を想定し、該当ピクセルに対応する UV 座標がその内側か外側かを判定しているだけです。これだけで、長方形のマスクを作成することができます。\n(ノードを見ると CustomRotator による入力 UV の回転を行い、長方形を回転させる機能が入っていますが、汎用性のために入れただけで今回は使っていません)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、このパラメータだとすこし使いにくいので、より長方形マスクを作成することに特化したマテリアル関数でラップします。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"draw-rect-mask.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Fdraw-rect-mask.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こちらは極めて単純です。先程のマテリアル関数の入力パラメータを"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UVs"}]},{type:"text",value:" "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Width"}]},{type:"text",value:" "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Height"}]},{type:"text",value:" "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Left"}]},{type:"text",value:" "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Top"}]},{type:"text",value:" という扱いやすいものにするための前処理を加えただけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"色付き長方形を作成する"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E8%89%B2%E4%BB%98%E3%81%8D%E9%95%B7%E6%96%B9%E5%BD%A2%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"色付き長方形を作成する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"せっかくですので、長方形マスクだけでなく、透明度と色を持った長方形を描画するマテリアル関数も作ってみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"draw-color-rect.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Fdraw-color-rect.png"},children:[]},{type:"text",value:"\nこのネットワークでは、先ほど作成した長方形マスク関数を元に、長方形の色と背景の色を透明度付きで指定できるようにしています。\nこれで位置・サイズ・色が指定可能な長方形が作れたので、これを素材に何かを生成するなり、テクスチャに合成するなりして自由に使うことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"使ってみる"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"使ってみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今回はテストですので、テクスチャに対して異なる色・透明度を持つ複数の正方形をアルファブレンドするサンプル(冒頭に示していたもの)を作成しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"final-node.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Ffinal-node.png"},children:[]},{type:"text",value:"\nこちらがサンプルのネットワークです。(動きをつけている部分は今回の本質ではないので入れていません)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すると、冒頭に示したこちらの動画のように、テクスチャが配置された UV 座標に基づいて長方形の描画ができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"円"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%86%86",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"円"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"今度は円を描画してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"円の数学的な表示"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%86%86%E3%81%AE%E6%95%B0%E5%AD%A6%E7%9A%84%E3%81%AA%E8%A1%A8%E7%A4%BA",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"円の数学的な表示"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"円はベクトルとして表すと、以下のようになります。\nここで、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"は円周上の任意の点、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{c}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.714em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"は円の中心、"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"r"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.43056em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]}]}]}]}]},{type:"text",value:"は半径です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"="}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\|\\vec{p}-\\vec{c}\\| = r"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"="}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.43056em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これは"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{p}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.9084399999999999em;vertical-align:-0.19444em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]}]}]}]}]},{type:"text",value:"と"},{type:"element",tag:"span",props:{className:["math","math-inline"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\vec{c}"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.714em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]}]}]}]}]},{type:"text",value:"の距離が r と等しくなるような点の集合が円であるということなので、結果として線状の円周を示します。今回指定したいのは円の内側の面領域なので、不等式にすればよいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["math","math-display"]},children:[{type:"element",tag:"span",props:{className:["katex-display"]},children:[{type:"element",tag:"span",props:{className:["katex"]},children:[{type:"element",tag:"span",props:{className:["katex-mathml"]},children:[{type:"element",tag:"math",props:{xmlns:"http:\u002F\u002Fwww.w3.org\u002F1998\u002FMath\u002FMathML",display:"block"},children:[{type:"element",tag:"semantics",props:{},children:[{type:"element",tag:"mrow",props:{},children:[{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"p"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"−"}]},{type:"element",tag:"mover",props:{accent:"true"},children:[{type:"element",tag:"mi",props:{},children:[{type:"text",value:"c"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"⃗"}]}]},{type:"element",tag:"mi",props:{mathvariant:"normal"},children:[{type:"text",value:"∥"}]},{type:"element",tag:"mo",props:{},children:[{type:"text",value:"≤"}]},{type:"element",tag:"mi",props:{},children:[{type:"text",value:"r"}]}]},{type:"element",tag:"annotation",props:{encoding:"application\u002Fx-tex"},children:[{type:"text",value:"\\|\\vec{p}-\\vec{c}\\| \\leq r"}]}]}]}]},{type:"element",tag:"span",props:{className:["katex-html"],ariaHidden:"true"},children:[{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t","vlist-t2"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"p"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.15216em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["vlist-s"]},children:[{type:"text",value:"​"}]}]},{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.19444em;"},children:[{type:"element",tag:"span",props:{},children:[]}]}]}]}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]},{type:"element",tag:"span",props:{className:["mbin"]},children:[{type:"text",value:"−"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2222222222222222em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:1em;vertical-align:-0.25em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","accent"]},children:[{type:"element",tag:"span",props:{className:["vlist-t"]},children:[{type:"element",tag:"span",props:{className:["vlist-r"]},children:[{type:"element",tag:"span",props:{className:["vlist"],style:"height:0.714em;"},children:[{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"element",tag:"span",props:{className:["mord","mathnormal"]},children:[{type:"text",value:"c"}]}]}]},{type:"element",tag:"span",props:{style:"top:-3em;"},children:[{type:"element",tag:"span",props:{className:["pstrut"],style:"height:3em;"},children:[]},{type:"element",tag:"span",props:{className:["accent-body"],style:"left:-0.17994em;"},children:[{type:"element",tag:"span",props:{className:["overlay"],style:"height:0.714em;width:0.471em;"},children:[{type:"element",tag:"svg",props:{width:"0.471em",height:"0.714em",style:"width:0.471em",viewBox:"0 0 471 714",preserveAspectRatio:"xMinYMin"},children:[{type:"element",tag:"path",props:{d:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z"},children:[]}]}]}]}]}]}]}]}]},{type:"element",tag:"span",props:{className:["mord"]},children:[{type:"text",value:"∥"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]},{type:"element",tag:"span",props:{className:["mrel"]},children:[{type:"text",value:"≤"}]},{type:"element",tag:"span",props:{className:["mspace"],style:"margin-right:0.2777777777777778em;"},children:[]}]},{type:"element",tag:"span",props:{className:["base"]},children:[{type:"element",tag:"span",props:{className:["strut"],style:"height:0.43056em;vertical-align:0em;"},children:[]},{type:"element",tag:"span",props:{className:["mord","mathnormal"],style:"margin-right:0.02778em;"},children:[{type:"text",value:"r"}]}]}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"円のマスクを描画する"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%86%86%E3%81%AE%E3%83%9E%E3%82%B9%E3%82%AF%E3%82%92%E6%8F%8F%E7%94%BB%E3%81%99%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"円のマスクを描画する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この考えに従うと、円のマスクを描画するのは次のコード 1 行で完結します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Custom Nodeのコード"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-hlsl"]},children:[{type:"text",value:"return int(saturate(Radius - distance(Center, UVs)) + 0.999999);"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また分岐を使っていないので可読性が下がっていますが、やっていることは円の中心"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Center"}]},{type:"text",value:"と現在のUV座標である"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UVs"}]},{type:"text",value:"の距離を出し(ノルムに対応)、半径からその距離を減算し、0以下になったかそうでないかで、最終的に0と1のどちらかに値がなるように調整しています。\nこちらを以下のようにCustomノードに記入して、配線するだけです。これで位置と半径を指定した円を描くことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"draw-circle-mask.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Fdraw-circle-mask.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"色付き円を作成する"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E8%89%B2%E4%BB%98%E3%81%8D%E5%86%86%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"色付き円を作成する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これについては、色付き長方形を作成した際の長方形マスクマテリアル関数を、そのまま円のマスクマテリアル関数の置き換えるだけで作成可能なので、割愛します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%81%BE%E3%81%A8%E3%82%81",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"video",props:{controls:true,src:"\u002Farticle-assets\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords\u002F\u002Fresult.mp4"},children:[{type:"text",value:"result.mp4"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UV 座標を元に図形を描くのは簡単にできることがわかったと思います。次はレイマーチングしたい。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fdraw-rectangles-lines-on-uv-coords",extension:".md",createdAt:"2022-01-29T00:45:39.000Z",updatedAt:"2022-01-29T18:57:28.000Z",gitCreatedAt:"2022-01-29T00:45:39.000Z",gitUpdatedAt:"2022-01-29T18:57:28.000Z"},{slug:"write-an-nbit-adder-using-only-types",description:"C++の型システムだけで、組み合わせ論理回路であるN-bit加算器を実装してみる。",title:"[C++]型だけでN bit加算器を書こう",enforceCreatedAt:"2021\u002F6\u002F17",enforceUpdatedAt:"2021\u002F6\u002F17",tags:["C++","metaprogramming","静的型付け","concept","C++20"],assets:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types",toc:[{id:"最低限の出力処理を用意しておく",depth:2,text:"最低限の出力処理を用意しておく"},{id:"nand-ゲート型",depth:2,text:"NAND ゲート型"},{id:"その他のゲートの型を用意する",depth:2,text:"その他のゲートの型を用意する"},{id:"基本論理ゲートのソースコード",depth:3,text:"基本論理ゲートのソースコード"},{id:"半加算器",depth:2,text:"半加算器"},{id:"全加算器",depth:2,text:"全加算器"},{id:"n-bit-加算器",depth:2,text:"N bit 加算器"},{id:"バイナリ型シーケンスの作成",depth:3,text:"バイナリ型シーケンスの作成"},{id:"n-bit-加算器本体",depth:3,text:"N bit 加算器本体"}],body:{type:"root",children:[{type:"element",tag:"p",props:{},children:[{type:"element",tag:"nuxt-link",props:{to:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types\u002F\u002Fhogehoge.txt"},children:[{type:"text",value:"hoge"}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"最近、Twitter で以下の記事を見かけました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"a",props:{href:"https:\u002F\u002Fqiita.com\u002FKuniwak\u002Fitems\u002F983ba68fcf68d915b07d",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fqiita.com\u002FKuniwak\u002Fitems\u002F983ba68fcf68d915b07d"}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"2018 年の記事と少し古めですが、TypeScript の型システムを利用して論理ゲート～ 4bit 加算器を実装しています。こんなものを見かけたら、C++でもやりたくなってしまうのが人間というものです。ということなので、今回は C++の型システムで組み合わせ回路を実装していきたいと思います。やりたかっただけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"レギュレーション"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%AC%E3%82%AE%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"レギュレーション"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"上記の記事では、TypeScript の型システムを用いた静的計算を「コンパイル時計算」とし、TypeScript のコンパイル時計算で組み合わせ回路を実装するという趣旨になっていました。しかし、C++でこの言葉をそのまま採用して実装すると、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"constexpr"}]},{type:"text",value:"で世界のすべてを殴り倒すことが出来てしまい、面白くありません。せっかくなので今回は、以下のような条件のもとでコードを書いてみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"非型テンプレートパラメータ以外の場所では、定数値を含め値を書かない。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"同様に、非型テンプレートパラメータを算出する以外の目的で"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"constexpr"}]},{type:"text",value:"な処理を利用しない。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"実行時の処理については、上記の制約の対象としない。ただし、実行時にして良い処理は入出力に関するもののみとする。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"もはや型で遊びたいだけであり、何が目的の実装なのかよくわかりませんが(そもそもレギュレーションガバガバですが)、まあよいでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"検証環境"},children:[{type:"element",tag:"a",props:{href:"#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"検証環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"clang version 12.0.0"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"x86_64-pc-linux-gnu"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"std=c++2a"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"注意点"},children:[{type:"element",tag:"a",props:{href:"#%E6%B3%A8%E6%84%8F%E7%82%B9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"注意点"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"本記事の実装では、fold expression の展開数制限および template の再帰深度上限を回避するような実装は行っていません。ですので、N を大きくしていくと意外とすぐ死にます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"バイナリ型を定義する"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E5%9E%8B%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"バイナリ型を定義する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先駆者様に倣って、0 or 1 の保持にも型を利用していこうと思います。ここは複雑ではありませんので、全体のコードをいきなり提示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"binary.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#pragma once\n#include \u003Ctype_traits\u003E\n\nnamespace Binary {\n    struct Binary {};\n    struct I : public Binary {};\n    struct O : public Binary  {};\n\n    template \u003Ctypename T\u003E\n    concept IsBinary = std::is_base_of_v\u003CBinary, T\u003E;\n\n    template \u003Ctypename T\u003E\n    concept IsZero = std::is_same_v\u003CT, O\u003E && IsBinary\u003CT\u003E;\n\n    template \u003Ctypename T\u003E\n    concept IsOne = std::is_same_v\u003CT, I\u003E && IsBinary\u003CT\u003E;\n}\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"マーカーの役割を果たす"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Binary"}]},{type:"text",value:"型と、それを継承した"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"O"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"I"}]},{type:"text",value:"のバイナリ型を定義しました。今回はドントケアを含む回路は想定しませんので、回路で現れる値(型だけど)が 0 と 1 以外の値を取ることはありません。ですので、渡されてきた型がバイナリであるか、つまり"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"O"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"I"}]},{type:"text",value:"のどちらかであるかを判断するコンセプトを定義しています。また、対象の型が"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"O"}]},{type:"text",value:"であるか、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"I"}]},{type:"text",value:"であるかを判断するための"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IsZero"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IsOne"}]},{type:"text",value:"のコンセプトも用意しました。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"最低限の出力処理を用意しておく"},children:[{type:"element",tag:"a",props:{href:"#%E6%9C%80%E4%BD%8E%E9%99%90%E3%81%AE%E5%87%BA%E5%8A%9B%E5%87%A6%E7%90%86%E3%82%92%E7%94%A8%E6%84%8F%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"最低限の出力処理を用意しておく"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この後論理ゲートを実装していきますが、結果が確認できないと困ります。予め最低限の出力処理を用意しておくことにします。レギュレーションより、ここでは自由な値の利用が許可されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"最低限の出力処理"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"using Binary::O;\nusing Binary::I;\n\ntemplate \u003CBinary::IsBinary T\u003E\nstruct bitToChar {};\n\ntemplate \u003CBinary::IsZero T\u003E\nstruct bitToChar\u003CT\u003E { inline static constexpr const char v = '0'; };\n\ntemplate \u003CBinary::IsOne T\u003E\nstruct bitToChar\u003CT\u003E { inline static constexpr const char v = '1'; };\n\ntemplate \u003CBinary::IsBinary T\u003E\nconstexpr const char bitToCharV = bitToChar\u003CT\u003E::v;\n\ntemplate \u003Ctemplate \u003Ctypename, typename\u003E typename Gate\u003E\nstatic void printTruthTable() {\n    fmt::print(\"0 0 | {}\\n\", bitToCharV\u003CGate\u003CO, O\u003E\u003E);\n    fmt::print(\"0 1 | {}\\n\", bitToCharV\u003CGate\u003CO, I\u003E\u003E);\n    fmt::print(\"1 0 | {}\\n\", bitToCharV\u003CGate\u003CI, O\u003E\u003E);\n    fmt::print(\"1 1 | {}\\n\", bitToCharV\u003CGate\u003CI, I\u003E\u003E);\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このコードは、2 入力 1 出力のゲート型を受け取って、その真理値表を出力するものです。基本論理ゲートの動作確認にはこれを使っていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"基本論理ゲートを実装する"},children:[{type:"element",tag:"a",props:{href:"#%E5%9F%BA%E6%9C%AC%E8%AB%96%E7%90%86%E3%82%B2%E3%83%BC%E3%83%88%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"基本論理ゲートを実装する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"前述の記事では、基本論理ゲートの出力をテーブル化して参照するようにしていました。しかし、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"NAND 論理の完全性"}]},{type:"text",value:"を利用すれば NAND 以外のゲートをテーブル化する必要はありませんので、本記事ではテーブル化するゲートは NAND のみとし、その他のゲートは NAND 型を組み合わせた型として実装していきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"nand-ゲート型"},children:[{type:"element",tag:"a",props:{href:"#nand-%E3%82%B2%E3%83%BC%E3%83%88%E5%9E%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"NAND ゲート型"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"NAND ゲートの実装は以下のようなものにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"basic_gates.h(NAND部)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    struct NAND  {};\n    template \u003CBinary::IsZero A, Binary::IsZero B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::One; };\n    template \u003CBinary::IsZero A, Binary::IsOne B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::One; };\n    template \u003CBinary::IsOne A, Binary::IsZero B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::One; };\n    template \u003CBinary::IsOne A, Binary::IsOne B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::Zero; };\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NANDv = typename NAND\u003CA, B\u003E::X"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++20 のコンセプト万々歳です。とても楽にテンプレートパラメータに基づいたオーバーロードを書くことが出来ます。これで、NAND 型のテンプレートパラメータとして渡された 2 つのバイナリ型の組み合わせによって、NAND 型がその内部に NAND ゲートの出力であるバイナリ型の型エイリアス"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"X"}]},{type:"text",value:"を持つようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"動作しているかどうか、先程用意した出力処理を利用して検証してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"NAND出力テスト"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"int main()\n{\n    printTruthTable\u003CGates::NANDv\u003E();\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"出力"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-shell"]},children:[{type:"text",value:"0 0 | 1\n0 1 | 1\n1 0 | 1\n1 1 | 0"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"どうやらしっかり動作しているようです！"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"その他のゲートの型を用意する"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E5%9E%8B%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"その他のゲートの型を用意する"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先述したとおり、あらゆる論理ゲートは NAND ゲートを用いて表現することが出来ます。つまりは、NAND 型を組み合わせるだけで他のゲートの型は用意できるわけです。一気にやってしまいましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"basic_gates.h(その他のゲート達)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"    template \u003CBinary::IsBinary A\u003E\n    using NOT = NAND\u003CA, A\u003E;\n    template \u003CBinary::IsBinary A\u003E\n    using NOTv = typename NOT\u003CA\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using AND = NOT\u003CNANDv\u003CA, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using ANDv = typename AND\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using OR = NAND\u003CNOTv\u003CA\u003E, NOTv\u003CB\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using ORv = typename OR\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NOR = NOT\u003CORv\u003CA, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NORv = typename NOR\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using XOR = NAND\u003CNANDv\u003CA, NANDv\u003CA, B\u003E\u003E, NANDv\u003CNANDv\u003CA, B\u003E, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using XORv = typename XOR\u003CA, B\u003E::X"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"NOT"}]},{type:"text",value:"\u002F"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"AND"}]},{type:"text",value:"\u002F"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"OR"}]},{type:"text",value:"\u002F"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"NOR"}]},{type:"text",value:"\u002F"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"XOR"}]},{type:"text",value:"の型を定義しました。すべてエイリアステンプレートのみによって実現することが出来ました。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"NAND"}]},{type:"text",value:"に感謝です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"一応、出力を確認しておきましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"出力テスト"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"int main()\n{\n    printTruthTable\u003CGates::ANDv\u003E(\"NAND\");\n    printTruthTable\u003CGates::ORv\u003E(\"OR\");\n    printTruthTable\u003CGates::NORv\u003E(\"NOR\");\n    printTruthTable\u003CGates::XORv\u003E(\"XOR\");\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"[NAND]\n0 0 | 0\n0 1 | 0\n1 0 | 0\n1 1 | 1\n[OR]\n0 0 | 0\n0 1 | 1\n1 0 | 1\n1 1 | 1\n[NOR]\n0 0 | 1\n0 1 | 0\n1 0 | 0\n1 1 | 0\n[XOR]\n0 0 | 0\n0 1 | 1\n1 0 | 1\n1 1 | 0"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"完璧です。きちんと型のみで論理ゲートが実装できています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"基本論理ゲートのソースコード"},children:[{type:"element",tag:"a",props:{href:"#%E5%9F%BA%E6%9C%AC%E8%AB%96%E7%90%86%E3%82%B2%E3%83%BC%E3%83%88%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"基本論理ゲートのソースコード"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"基本論理ゲートの実装全体を以下に示しておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"basic_gates.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#pragma once\n\n#include \"binary.h\"\n\nnamespace Gates {\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    struct NAND  {};\n    template \u003CBinary::IsZero A, Binary::IsZero B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::I; };\n    template \u003CBinary::IsZero A, Binary::IsOne B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::I; };\n    template \u003CBinary::IsOne A, Binary::IsZero B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::I; };\n    template \u003CBinary::IsOne A, Binary::IsOne B\u003E\n    struct NAND\u003CA, B\u003E  { using X = Binary::O; };\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NANDv = typename NAND\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A\u003E\n    using NOT = NAND\u003CA, A\u003E;\n    template \u003CBinary::IsBinary A\u003E\n    using NOTv = typename NOT\u003CA\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using AND = NOT\u003CNANDv\u003CA, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using ANDv = typename AND\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using OR = NAND\u003CNOTv\u003CA\u003E, NOTv\u003CB\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using ORv = typename OR\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NOR = NOT\u003CORv\u003CA, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using NORv = typename NOR\u003CA, B\u003E::X;\n\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using XOR = NAND\u003CNANDv\u003CA, NANDv\u003CA, B\u003E\u003E, NANDv\u003CNANDv\u003CA, B\u003E, B\u003E\u003E;\n    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    using XORv = typename XOR\u003CA, B\u003E::X;\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまでくれば加算器なんて簡単です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"加算器"},children:[{type:"element",tag:"a",props:{href:"#%E5%8A%A0%E7%AE%97%E5%99%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"加算器"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"型で加算器を実装していきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"半加算器"},children:[{type:"element",tag:"a",props:{href:"#%E5%8D%8A%E5%8A%A0%E7%AE%97%E5%99%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"半加算器"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"全加算器を作るためには、まず半加算器からです。\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types\u002F\u002Fhalf-adder.png"},children:[]},{type:"text",value:"\n半加算器は出力が複数あるため、これまでのように基本論理ゲートのエイリアステンプレートで定義することは出来ません。構造体を使って独自の型として実現していきましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"basic_adders.h(HalfAdder部)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"    template \u003CBinary::IsBinary A, Binary::IsBinary B\u003E\n    struct HalfAdder {\n        using X = Gates::XORv\u003CA, B\u003E;\n        using Y = Gates::ANDv\u003CA, B\u003E;\n    };"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以上です。なんと容易いのでしょうか。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"XOR"}]},{type:"text",value:"が既に存在するおかげで、半加算器はたったこれだけのコードで実現できました。動作を確認します。出力が増えたため、新たな出力関数を定義しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"出力テスト"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"template \u003Ctemplate \u003Ctypename, typename\u003E typename Gate\u003E\nstatic void printTruthTable2_2(const std::string& title) {\n    fmt::print(\"[{}]\\n\", title);\n    fmt::print(\"A B | Y X\\n\", title);\n    fmt::print(\"0 0 | {} {}\\n\", bitToCharV\u003Ctypename Gate\u003CO, O\u003E::Y\u003E, bitToCharV\u003Ctypename Gate\u003CO, O\u003E::X\u003E);\n    fmt::print(\"0 1 | {} {}\\n\", bitToCharV\u003Ctypename Gate\u003CO, I\u003E::Y\u003E, bitToCharV\u003Ctypename Gate\u003CO, I\u003E::X\u003E);\n    fmt::print(\"1 0 | {} {}\\n\", bitToCharV\u003Ctypename Gate\u003CI, O\u003E::Y\u003E, bitToCharV\u003Ctypename Gate\u003CI, O\u003E::X\u003E);\n    fmt::print(\"1 1 | {} {}\\n\", bitToCharV\u003Ctypename Gate\u003CI, I\u003E::Y\u003E, bitToCharV\u003Ctypename Gate\u003CI, I\u003E::X\u003E);\n}\n\nint main()\n{\n    printTruthTable2_2\u003CCircuits::HalfAdder\u003E(\"HalfAdder\");\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"[HalfAdder]\nA B | Y X\n0 0 | 0 0\n0 1 | 0 1\n1 0 | 0 1\n1 1 | 1 0"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"きちんと加算できていますし、桁上りの出力も正常です。半加算器型が実現できています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"全加算器"},children:[{type:"element",tag:"a",props:{href:"#%E5%85%A8%E5%8A%A0%E7%AE%97%E5%99%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"全加算器"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types\u002F\u002Ffull-adder.png"},children:[]},{type:"text",value:"\n半加算器と全く同じです。違いを上げるとすれば、可読性のために構造体内部で型エイリアスを利用しているくらいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"basic_adders.h(FullAdder部)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"    template \u003CBinary::IsBinary A, Binary::IsBinary B, Binary::IsBinary C\u003E\n    class FullAdder {\n        using HA1 = HalfAdder\u003CA, B\u003E;\n        using HA2 = HalfAdder\u003Ctypename HA1::X, C\u003E;\n    public:\n        using X = typename HA2::X;\n        using Y = Gates::ORv\u003Ctypename HA1::Y, typename HA2::Y\u003E;\n    };"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"早速出力を見てみましょう。今度は入力が増えたので、再び新たな出力関数を定義しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"出力テスト"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"template \u003Ctemplate \u003Ctypename, typename, typename\u003E typename Gate\u003E\nvoid printTruthTable3_2(const std::string& title)\n{\n    fmt::print(\"[{}]\\n\", title);\n    fmt::print(\"A B C | Y X\\n\"\n               \"0 0 0 | {} {}\\n0 0 1 | {} {}\\n0 1 0 | {} {}\\n0 1 1 | {} {}\\n\"\n               \"1 0 0 | {} {}\\n1 0 1 | {} {}\\n1 1 0 | {} {}\\n1 1 1 | {} {}\\n\",\n            bitToCharV\u003Ctypename Gate\u003CO, O, O\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, O, O\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, O, I\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, O, I\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, I, O\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, I, O\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, I, I\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CO, I, I\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, O, O\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, O, O\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, O, I\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, O, I\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, I, O\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, I, O\u003E::X\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, I, I\u003E::Y\u003E,\n            bitToCharV\u003Ctypename Gate\u003CI, I, I\u003E::X\u003E\n            );\n}\n\nint main()\n{\n    printTruthTable3_2\u003CCircuits::FullAdder\u003E(\"FullAdder\");\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"[FullAdder]\nA B C | Y X\n0 0 0 | 0 0\n0 0 1 | 0 1\n0 1 0 | 0 1\n0 1 1 | 1 0\n1 0 0 | 0 1\n1 0 1 | 1 0\n1 1 0 | 1 0\n1 1 1 | 1 1"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"はい。完璧です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"n-bit-加算器"},children:[{type:"element",tag:"a",props:{href:"#n-bit-%E5%8A%A0%E7%AE%97%E5%99%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"N bit 加算器"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types\u002F\u002Fnbit-adder.png"},children:[]},{type:"text",value:"\nさて、全加算器が出来ましたので、複数 bit の加算がしたくなってきます。4 bit などの固定長としても良いですが、我々が今利用しているのはソフトウェアですので、ビット長くらいパラメトリックにしたいものです。C++には可変長テンプレートという N bit 加算器のための機能がありますので、こちらを利用して実装してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"バイナリ型シーケンスの作成"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E5%9E%8B%E3%82%B7%E3%83%BC%E3%82%B1%E3%83%B3%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"バイナリ型シーケンスの作成"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"N bit の加算器を作成するにあたっては、その加算対象となる値や得られる結果をバイナリ型のシーケンスとして扱いたくなります。型のシーケンスなんて作れるのかと思うかもしれませんが、それほど難しくありません。以下を"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"binary.h"}]},{type:"text",value:"に追記します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"binary.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"    template \u003Ctypename T\u003E\n    struct IType {\n        using type = T;\n    };\n\n    template \u003CIsBinary... Bs\u003E\n    struct BinarySeq;\n\n    template\u003Ctypename IndexSeq, IsBinary SetType, std::size_t Pos, std::size_t Len, IsBinary... Ts\u003E\n    struct BinarySeqSetHelper;\n\n    template\u003Cstd::size_t... Indexes, IsBinary SetType, std::size_t Pos, std::size_t Len, IsBinary... Ts\u003E\n    struct BinarySeqSetHelper\u003Cstd::index_sequence\u003CIndexes...\u003E, SetType, Pos, Len, Ts...\u003E\n      : IType\u003CBinarySeq\u003C\n            std::tuple_element_t\u003CIndexes == Pos ? Len : Indexes, std::tuple\u003CTs..., SetType\u003E\u003E...\u003E\u003E {\n        static_assert(Pos \u003C Len, \"out of range\");\n    };\n\n    template\u003CIsBinary... Bs\u003E\n    struct BinarySeq : IType\u003CBinarySeq\u003CBs...\u003E\u003E {\n        static constexpr const std::size_t size = sizeof...(Bs);\n\n        template\u003CIsBinary SetType, std::size_t Pos\u003E\n        using Set = typename BinarySeqSetHelper\u003Cstd::make_index_sequence\u003Csizeof...(Bs)\u003E,\n                                 SetType,\n                                 Pos,\n                                 sizeof...(Bs),\n                                 Bs...\u003E::type;\n    };\n\n    template\u003CIsBinary B, std::size_t N, IsBinary... Bs\u003E\n    struct GenBinarySeq {\n        using type = typename GenBinarySeq\u003CB, N - 1, Bs..., B\u003E::type;\n    };\n\n    template\u003CIsBinary B, IsBinary... Bs\u003E\n    struct GenBinarySeq\u003CB, 0, Bs...\u003E {\n        using type = typename IType\u003CBinarySeq\u003CBs...\u003E\u003E::type;\n    };"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"という可変長テンプレートパラメータに IsBinary を満たすバイナリ型を持つ型を定義しています。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"が持つ型パラメータを型シーケンスと見做すわけです。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"には"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Set"}]},{type:"text",value:"という型エイリアステンプレートが含まれていますが、この"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Set"}]},{type:"text",value:"はテンプレートパラメータとしてシーケンス上の位置と書き込みたい型を指定すると、そのように編集した後の型シーケンスを表すようになるという機能を持っています。また、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GenBinarySeq"}]},{type:"text",value:"という型も定義されています。これは、テンプレートパラメータとして型と長さを指定すると、指定された型と長さを持つ"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"を作成してくれます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"binaryseqを出力可能にする"},children:[{type:"element",tag:"a",props:{href:"#binaryseq%E3%82%92%E5%87%BA%E5%8A%9B%E5%8F%AF%E8%83%BD%E3%81%AB%E3%81%99%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"を出力可能にする"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"バイナリ型を任意の長さのシーケンスとして保持できるようになったのは良いですが、これは値ではなく型テンプレートパラメータとして保持されているに過ぎません。これを我々の確認できる形で出力することは、以下のような実装で実現することが出来ます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"BinarySeqの出力実装"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"template \u003Ctypename Bs\u003E\nstruct BinarySeqPrintHelper;\n\ntemplate \u003CBinary::IsBinary... S\u003E\nstruct BinarySeqPrintHelper\u003CBinary::BinarySeq\u003CS...\u003E\u003E {\n    static void print() {\n        (fmt::print(\"{}\", bitToCharV\u003CS\u003E), ...);\n    }\n};"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"テンプレートの部分特殊化を利用して、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"の型パラメータ部分だけを取り出し、c++17 で導入された fold expression で出力しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h4",props:{id:"binaryseqを使ってみる"},children:[{type:"element",tag:"a",props:{href:"#binaryseq%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"を使ってみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"言葉で言われてもわかりにくいかと思いますので、実際の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"の動作を示すサンプルを提示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"BinarySeqのサンプルコード"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"int main()\n{\n    using Seq1 = Binary::BinarySeq\u003CI, I, I, O, O, I, O, I\u003E;\n    fmt::print(\"1: \");\n    BinarySeqPrintHelper\u003CSeq1\u003E::print();\n    fmt::print(\"\\n\");\n\n    using Seq2 = Seq1::Set\u003CI, 4\u003E::Set\u003CO, 1\u003E;\n    fmt::print(\"2: \");\n    BinarySeqPrintHelper\u003CSeq2\u003E::print();\n    fmt::print(\"\\n\");\n\n    using Seq3 = Binary::GenBinarySeq\u003CO, 4\u003E::type;\n    fmt::print(\"3: \");\n    BinarySeqPrintHelper\u003CSeq3\u003E::print();\n    fmt::print(\"\\n\");\n\n    using Seq4 = Binary::GenBinarySeq\u003CI, 5\u003E::type;\n    fmt::print(\"4: \");\n    BinarySeqPrintHelper\u003CSeq4\u003E::print();\n    fmt::print(\"\\n\");\n\n    using Seq5 = Seq3::Set\u003CI, 2\u003E;\n    fmt::print(\"5: \");\n    BinarySeqPrintHelper\u003CSeq5\u003E::print();\n    fmt::print(\"\\n\");\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"1: 11100101\n2: 10101101\n3: 0000\n4: 11111\n5: 0010"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"完全に型テンプレートパラメータが「任意長で扱えて」、「要素の編集も可能」なリストと化しています。きっとそういう機能なんだと思います(？)。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"n-bit-加算器本体"},children:[{type:"element",tag:"a",props:{href:"#n-bit-%E5%8A%A0%E7%AE%97%E5%99%A8%E6%9C%AC%E4%BD%93",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"N bit 加算器本体"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまでで、すべての準備は整いました。あとはこれらを利用して N bit 加算器を実装するだけです。もったいぶっても仕方ないので(小出しにして詳細に説明するのが面倒なので)実装を貼ります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"n_bit_adder.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#pragma once\n\n#include \u003Ctuple\u003E\n#include \"basic_adders.h\"\n\nnamespace Circuits {\n    template \u003Cstd::size_t Len, typename BS1, typename BS2, typename BS3, Binary::IsBinary Ci\u003E\n    struct NbitAdderHelper;\n\n    template \u003CBinary::IsBinary... S1, Binary::IsBinary... S2, Binary::IsBinary... S3, Binary::IsBinary Ci\u003E\n    struct NbitAdderHelper\u003Csizeof...(S1), Binary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E, Binary::BinarySeq\u003CS3...\u003E, Ci\u003E {\n        static_assert(sizeof...(S1) == sizeof...(S2) && sizeof...(S1) == sizeof...(S3), \"Bit length not matched.\");\n        static constexpr const std::size_t N = sizeof...(S1);\n        using A = std::tuple_element_t\u003CN-1, std::tuple\u003CS1...\u003E\u003E;\n        using B = std::tuple_element_t\u003CN-1, std::tuple\u003CS2...\u003E\u003E;\n        using HAdder = Circuits::HalfAdder\u003CA, B\u003E;\n\n        using Ss = typename NbitAdderHelper\u003CN-1, Binary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E, typename Binary::BinarySeq\u003CS3...\u003E::template Set\u003Ctypename HAdder::X, N-1\u003E, typename HAdder::Y\u003E::Ss;\n    };\n\n    template \u003Cstd::size_t N, Binary::IsBinary... S1, Binary::IsBinary... S2, Binary::IsBinary... S3, Binary::IsBinary Ci\u003E\n    struct NbitAdderHelper\u003CN, Binary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E, Binary::BinarySeq\u003CS3...\u003E, Ci\u003E {\n        static_assert(sizeof...(S1) == sizeof...(S2) && sizeof...(S1) == sizeof...(S3), \"Bit length not matched.\");\n        using A = std::tuple_element_t\u003CN-1, std::tuple\u003CS1...\u003E\u003E;\n        using B = std::tuple_element_t\u003CN-1, std::tuple\u003CS2...\u003E\u003E;\n        using FAdder = Circuits::FullAdder\u003CA, B, Ci\u003E;\n\n        using Ss = typename NbitAdderHelper\u003CN-1, Binary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E, typename Binary::BinarySeq\u003CS3...\u003E::template Set\u003Ctypename FAdder::X, N-1\u003E, typename FAdder::Y\u003E::Ss;\n    };\n\n    template \u003CBinary::IsBinary... S1, Binary::IsBinary... S2, Binary::IsBinary... S3, Binary::IsBinary Ci\u003E\n    struct NbitAdderHelper\u003C0, Binary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E, Binary::BinarySeq\u003CS3...\u003E, Ci\u003E {\n        static_assert(sizeof...(S1) == sizeof...(S2) && sizeof...(S1) == sizeof...(S3), \"Bit length not matched.\");\n        using Ss = Binary::BinarySeq\u003CCi, S3...\u003E;\n    };\n\n    template \u003Ctypename BS1, typename BS2\u003E\n    using NbitAdder = NbitAdderHelper\u003CBS1::size, BS1, BS2, typename Binary::GenBinarySeq\u003CBinary::O, BS1::size\u003E::type, Binary::O\u003E;\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"いや～ C++は良い言語ですね！！！！\nこのコードでやっているのは、先に示した回路図の安直な再現です。「一番はじめの半加算器」「2 番目～から[ビット長-1]番目の全加算器」「終了処理」の 3 つに特殊化されるように実装を切り分け、再帰的に演算結果を伝達させていっています。テンプレートパラメータの名前で説明するのならば、「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"std::size_t N"}]},{type:"text",value:"がその時に対象としている半加算器\u002F全加算器の通番」「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"typename BS1"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"typename BS2"}]},{type:"text",value:"は加算に使われる 2 つのバイナリ型シーケンス」「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"typename BS3"}]},{type:"text",value:"は演算結果を保持しているバイナリ型シーケンス」「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Binary::IsBinary Ci"}]},{type:"text",value:"は下位の加算器からの桁上り入力」です。結果として、演算対象とするシーケンスを受け取った"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"NbitAdderHelper"}]},{type:"text",value:"型は「先頭に最後の桁上り、2 番めから終端までが演算結果」となるバイナリ型シーケンスを示す型"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Ss"}]},{type:"text",value:"を内部に持つようになります。読みにくさはピカイチですが、やっていることはそんなに複雑ではありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この実装では与えられる"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"の長さが同一でなければ静的アサートでコンパイルエラーとなるようにしています。しかし、今回の処理は加算であるため、単純な 0 埋めの(メタ)実装を追加することで異なる長さの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BinarySeq"}]},{type:"text",value:"も加算可能になります(あれ、でもそれって加算回路的にどうなの)。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで例によって、結果を見える形にするための出力処理を実装しておきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"NbitAdderprintHelper"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"template \u003Ctypename Bs\u003E\nstruct NbitAdderPrintHelper;\n\ntemplate \u003CBinary::IsBinary... S1, Binary::IsBinary... S2\u003E\nstruct NbitAdderPrintHelper\u003CCircuits::NbitAdder\u003CBinary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E\u003E\u003E {\n    static void print_result() {\n        (fmt::print(\"{}\", bitToCharV\u003CS1\u003E), ...);\n        fmt::print(\" + \");\n        (fmt::print(\"{}\", bitToCharV\u003CS2\u003E), ...);\n\n        using Adder = Circuits::NbitAdder\u003CBinary::BinarySeq\u003CS1...\u003E, Binary::BinarySeq\u003CS2...\u003E\u003E;\n        fmt::print(\" = \");\n        BinarySeqPrintHelper\u003Ctypename Adder::Ss\u003E::print();\n        fmt::print(\"\\n\");\n    }\n};"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"特筆すべきところは特にありませんね。では結果を確認していきましょう！"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"Nbit加算器動作確認"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"int main()\n{\n    using ASeq = Binary::BinarySeq\u003CI, I, I, O, O, I, O, I, O, O, I, I, O, I, I, O\u003E;\n    using BSeq = Binary::BinarySeq\u003CI, I, O, I, O, O, I, I, O, I, O, O, O, O, I, I\u003E;\n    NbitAdderPrintHelper\u003CCircuits::NbitAdder\u003CASeq, BSeq\u003E\u003E::print_result();\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"1110010100110110 + 1101001101000011 = 11011100001111001"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この結果が正しいのか、Windows の電卓くんに計算してもらいました。\n"},{type:"element",tag:"img",props:{alt:"出力検証結果",src:"\u002Farticle-assets\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types\u002F\u002Fresult.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"やった！完璧ですね！！C++の型システム上で N bit の加算器を動作させることに成功しました！！"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまで記事を読んでくださった方に朗報があります。C++には**+演算子**と呼ばれる演算子が存在しており、以下のように記述することで加算を行うことが出来ます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"add"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"1 + 2 \u002F\u002F → 3"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、このようにコンパイル時に値が確定するリテラルとして表記された値は、コンパイラの最適化によってコンパイル時に演算結果の値へと置き換えられることが殆どであり、実行時コストを考える必要もありません。2 進数以外読めないという方も安心してください。C++14 からの C++は 2 進数リテラルを持っています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"bin_add"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"0b1 + 0b10 \u002F\u002F → 0b11 (3)"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"よって、C++の型システムで加算器を実装する必要はありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"追記"},children:[{type:"element",tag:"a",props:{href:"#%E8%BF%BD%E8%A8%98",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"追記"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"本記事で利用したソースコードを GitHub にあげておきました。\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fgithub.com\u002Fstrvworks\u002Flogical_cpp\u002Ftree\u002Fmaster",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fgithub.com\u002Fstrvworks\u002Flogical_cpp\u002Ftree\u002Fmaster"}]}]}]},dir:"\u002Farticles\u002Fcpp",path:"\u002Farticles\u002Fcpp\u002Fwrite-an-nbit-adder-using-only-types",extension:".md",createdAt:"2021-06-17T00:00:00.000Z",updatedAt:"2021-06-17T00:00:00.000Z",gitCreatedAt:"2021-11-25T17:55:07.000Z",gitUpdatedAt:"2022-01-29T00:45:39.000Z"},{slug:"support-user-defined-types-for-bp-operator-nodes-in-ue5",description:"UE5で追加されたType promotion機能付き演算子ノードに、ユーザー定義型サポートを追加する方法について",title:"UE5のBP演算子ノードにユーザー定義型を対応させる",enforceCreatedAt:"2021\u002F6\u002F8",enforceUpdatedAt:"2021\u002F6\u002F8",tags:["Unreal Engine","Blueprint","Unreal C++","Unreal Engine 5"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5",toc:[{id:"ue5の演算子ノードってなに",depth:2,text:"UE5の演算子ノードってなに？"},{id:"対象とするデータ型",depth:2,text:"対象とするデータ型"},{id:"実装例",depth:2,text:"実装例"},{id:"対応のための条件",depth:2,text:"対応のための条件"},{id:"type-promotionがサポートする演算",depth:2,text:"Type promotionがサポートする演算"},{id:"どうやって実装を収集しているのか",depth:2,text:"どうやって実装を収集しているのか"},{id:"なぜ本来の実装ノードがbpのメニューに現れないか",depth:2,text:"なぜ本来の実装ノードがBPのメニューに現れないか"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"まえがき"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%88%E3%81%8C%E3%81%8D",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まえがき"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ue5の演算子ノードってなに"},children:[{type:"element",tag:"a",props:{href:"#ue5%E3%81%AE%E6%BC%94%E7%AE%97%E5%AD%90%E3%83%8E%E3%83%BC%E3%83%89%E3%81%A3%E3%81%A6%E3%81%AA%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"UE5の演算子ノードってなに？"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先日Early Accessが開始されたUE5には、仮想化されたジオメトリを扱うシステムであるNaniteや、動的かつ高度なライティングを行うLumenなど目を引く新機能が満載です。\nそんな華々しい機能の裏に隠れがちですが、同時に"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ブループリントのType promotion"}]},{type:"text",value:"というBlueprintに関する地味ながら便利な変更も追加されています。この変更は、これまでそれぞれの型ごとに別々のノードとして実装されていた各種演算子(Operator)ノードを、任意の型を演算可能な統一された演算子ノードで行えるようにするというものです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"例えばUE4の時点では、加算に関するノードだけで以下のような状況になっていました。\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5\u002F\u002Fue4-operator-nodes.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"しかし、UE5以降では基本的な演算子ノードの入力ピンがすべてワイルドカードとなり、接続されたデータ型に対する加算処理を行うノードへと自動的に型をpromoteしてくれるようになったのです。\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5\u002F\u002Fue5-operator-node.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"素朴な疑問"},children:[{type:"element",tag:"a",props:{href:"#%E7%B4%A0%E6%9C%B4%E3%81%AA%E7%96%91%E5%95%8F",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"素朴な疑問"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Type promotionは簡便かつ整理された状態を提供してくれる素晴らしい変更ですが、この仕様を見ると「"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ユーザーが追加した演算可能なデータ型に対してUE5の演算子ノードは対応可能なのか？？"}]},{type:"text",value:"」という疑問が湧いてきます。\nC++を用いてワイルドカードを入力として持つBPノードを実装するためには、UFUNCTIONにCustomThunk等のmeta指定子とThunk関数の実装を用いるか、K2_Nodeを継承した独自ノードをUFUNCTIONマクロを用いずに実装する必要があります。Type promotionを行うUE5の演算子ノードも同様に実装されていることは容易に推察ができますが、データ型に対する演算処理のように後からユーザーが追加する可能性があり、かつ内部処理が常に自動生成できるとは限らない処理をワイルドカード化して問題ないのでしょうか。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"調査結果"},children:[{type:"element",tag:"a",props:{href:"#%E8%AA%BF%E6%9F%BB%E7%B5%90%E6%9E%9C",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"調査結果"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"エンジンのソースを追った結果、非常に簡単にユーザー定義型をUE5の演算子ノードで扱うことができることがわかりました。以下では、ユーザー定義型をUE5のType promotionに対応させるために踏まえるべき点を記載します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"対象とするデータ型"},children:[{type:"element",tag:"a",props:{href:"#%E5%AF%BE%E8%B1%A1%E3%81%A8%E3%81%99%E3%82%8B%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"対象とするデータ型"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実装例を提示するため、以下のようなサンプルのデータ型を定義しました。このデータ型を複素数型と見做して、UE5の演算子ノードで複素数に定義されるいくつかの演算を実装してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ComplexNumber.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#pragma once\n#include \"ComplexNumber.generated.h\"\n\nUSTRUCT(BlueprintType)\nstruct FComplexNumber\n{\n\tGENERATED_BODY()\n\n\tFComplexNumber() : Real(0.0f), Imag(0.0f) {}\n\tFComplexNumber(const float Real, const float Imaginary) : Real(Real), Imag(Imaginary) {}\n\n\tUPROPERTY(BlueprintReadWrite, EditAnywhere)\n\tfloat Real;\n\n\tUPROPERTY(BlueprintReadWrite, EditAnywhere)\n\tfloat Imag;\n};"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"実装例"},children:[{type:"element",tag:"a",props:{href:"#%E5%AE%9F%E8%A3%85%E4%BE%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"実装例"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"詳細な説明に先んじて、実装例を提示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ComplexNumberBlueprintLibrary.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#pragma once\n\n#include \"CoreMinimal.h\"\n#include \"ComplexNumber.h\"\n#include \"ComplexNumberBlueprintLibrary.generated.h\"\n\nUCLASS()\nclass UComplexNumberBlueprintLibrary : public UBlueprintFunctionLibrary\n{\n\tGENERATED_BODY()\npublic:\n\n\t\u002F\u002F ---------演算の実装はここから-----------\n\n\t\u002F\u002F ComplexNumber + ComplexNumber (加算)\n\tUFUNCTION(BlueprintPure, meta=(DisplayName=\"ComplexNumber + ComplexNumber\", CompactNodeTitle=\"+\"), Category=\"ComplexNumber\")\n\tstatic FComplexNumber Add_ComplexNumberComplexNumber(const FComplexNumber A, const FComplexNumber B) { return FComplexNumber(A.Real + B.Real, A.Imag + B.Imag); }\n\n\t\u002F\u002F ComplexNumber - ComplexNumber (減算)\n\tUFUNCTION(BlueprintPure, meta=(DisplayName=\"ComplexNumber - ComplexNumber\", CompactNodeTitle=\"-\"), Category=\"ComplexNumber\")\n\tstatic FComplexNumber Subtract_ComplexNumberComplexNumber(const FComplexNumber A, const FComplexNumber B) { return FComplexNumber(A.Real - B.Real, A.Imag - B.Imag); }\n\n\t\u002F\u002F ComplexNumber * float (floatとの乗算)\n\tUFUNCTION(BlueprintPure, meta=(DisplayName=\"ComplexNumber * float\", CompactNodeTitle=\"*\"), Category=\"ComplexNumber\")\n\tstatic FComplexNumber Multiply_ComplexNumberFloat(const FComplexNumber A, const float B) { return FComplexNumber(A.Real * B, A.Imag * B); }\n\n\t\u002F\u002F ---------------ここまで---------------\n\n\t\u002F\u002F ToString\t(ComplexNumber)\n\tUFUNCTION(BlueprintPure, meta=(DisplayName = \"ToString (ComplexNumber)\", CompactNodeTitle=\"-\u003E\", BlueprintAutoCast), Category=\"ComplexNumber\")\n\tstatic FString ToString(const FComplexNumber In)\n\t{\n\t\treturn FString::Printf(TEXT(\"%.3f %s %.3fi\"),\n\t\t\t\tIn.Real,\n\t\t\t\tIn.Imag \u003C 0 ? TEXT(\"-\") : TEXT(\"+\"),\n\t\t\t\tFMath::Abs(In.Imag));\n\t}\n};\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"たったこれだけです。このコードをコンパイルすると、BPエディタにおいて"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ComplexNumber同士の加算"}]},{type:"text",value:"、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ComplexNumber同士の減算"}]},{type:"text",value:"、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ComplexNumberとfloatの乗算"}]},{type:"text",value:"が演算子ノードによって行えるようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"接続が許可されるようになって……\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5\u002F\u002Fcomplex-type-1.png"},children:[]},{type:"text",value:"\n繋ぐとComplexNumberの加算ノードになる！\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5\u002F\u002Fcomplex-type-2.png"},children:[]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こうして演算子ノードと接続した際に行われる処理は、当然ながら先程示したコードで実装されていた関数の内部の処理に置き換わっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"対応のための条件"},children:[{type:"element",tag:"a",props:{href:"#%E5%AF%BE%E5%BF%9C%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E6%9D%A1%E4%BB%B6",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"対応のための条件"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なんと、UE5の演算子ノードのType promotionに対応するにあたって必要な点は以下の3つのみです。"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"対象のデータ型に対して、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BlueprintPure"}]},{type:"text",value:"を指定されたstaticなUFUNCTIONの実装がどこかに存在すること。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"演算を実装したUFUNCTIONに戻り値が存在すること。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"演算を実装したUFUNCTIONの名前が"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"[演算名Prefix]_"}]},{type:"text",value:"で始まること。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"参考: Engine\\Source\\Editor\\BlueprintGraph\\Private\\BlueprintTypePromotion.cpp"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"必要となる"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"演算名Prefix"}]},{type:"text",value:"については次節で触れます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先の実装についていたその他の指定子などは、全て細かなノードの見た目やカテゴリ表示に関するものであり、Type promotionとは一切関係がありません。条件を満たしたUFUNCTIONが存在するだけで、勝手にBPエディタがその存在を認識して、演算子ノードが処理の呼び分けを行ってくれるようになるのです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"type-promotionがサポートする演算"},children:[{type:"element",tag:"a",props:{href:"#type-promotion%E3%81%8C%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E3%81%99%E3%82%8B%E6%BC%94%E7%AE%97",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Type promotionがサポートする演算"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"以下に、Type promotionがサポートする演算と、その実装をするために必要なUFUNCTIONのPrefixとなる演算名の対応表を示します。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"演算"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"Prefix"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"+"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Add"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"*"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Multiply"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"-"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Subtract"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"\u002F"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Divide"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"\u003E"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Greater"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"\u003E="}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"GreaterEqual"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Less"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"\u003C="}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"LessEqual"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"!="}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"NotEqual"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"=="}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"EqualEqual"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"参考: Engine\\Source\\Editor\\BlueprintGraph\\Private\\BlueprintTypePromotion.cpp"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このPrefixをUFUNCTIONの関数名の頭に付加することで、対応する演算の実装として認識してもらうことが出来ます。簡単ですね！"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おまけ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%81%BE%E3%81%91",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おまけ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"簡単に動くのはいいですが、一体どんな仕組みで動いているのか気になってしまうと思いますので、少し見てみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"どうやって実装を収集しているのか"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E5%AE%9F%E8%A3%85%E3%82%92%E5%8F%8E%E9%9B%86%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"どうやって実装を収集しているのか"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"実装を覗くと、この部分はなかなかのパワー的処理によって実現されています。以下はエンジンのソースコードからの抜粋です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"BlueprintTypePromotion.cpp(抜粋)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"void FTypePromotion::CreateOpTable()\n{\n\tTRACE_CPUPROFILER_EVENT_SCOPE(FTypePromotion::CreateOpTable);\n\tconst UEdGraphSchema_K2* Schema = GetDefault\u003CUEdGraphSchema_K2\u003E();\n\n\tOperatorTable.Empty();\n\n\tTArray\u003CUClass*\u003E Libraries;\n\tGetDerivedClasses(UBlueprintFunctionLibrary::StaticClass(), Libraries);\n\tfor (UClass* Library : Libraries)\n\t{\n\t\t\u002F\u002F Ignore abstract libraries\u002Fclasses\n\t\tif (!Library || Library-\u003EHasAnyClassFlags(CLASS_Abstract))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tfor (UFunction* Function : TFieldRange\u003CUFunction\u003E(Library, EFieldIteratorFlags::ExcludeSuper, EFieldIteratorFlags::ExcludeDeprecated))\n\t\t{\n\t\t\tif(!IsPromotableFunction(Function))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tFEdGraphPinType FuncPinType;\n\t\t\tFName OpName = GetOpNameFromFunction(Function);\n\n\t\t\tif (OpName != OperatorNames::NoOp && Schema-\u003EConvertPropertyToPinType(Function-\u003EGetReturnProperty(), \u002F* out *\u002F FuncPinType))\n\t\t\t{\n\t\t\t\tAddOpFunction(OpName, Function);\n\t\t\t}\n\t\t}\n\t}\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateOpTable"}]},{type:"text",value:"というメソッドが何をしているかをざっくりまとめると、以下のようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"ol",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"UBlueprintFunctionLibrary"}]},{type:"text",value:"を継承しているすべてのUClassを取得して配列に詰める。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UClassの配列をループして走査しながら、それぞれのUClassが持っているUFUNCTIONを走査する。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"前述の3つの条件を満たすUFUNCTIONが現れたら、それを演算子ノードの実装に利用可能であると見做してルックアップテーブルに詰める！"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"パワーを感じます。パワーです。とてもメタメタしています。楽しいですね。\nなお、この"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CreateOpTable"}]},{type:"text",value:"メソッドは、所属している"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FTypePromotion"}]},{type:"text",value:"クラスのコンストラクタで呼び出されている他、エンジンのモジュール構成に変化があったとき(ホットリロード時など)に呼び出されるようになっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"なぜ本来の実装ノードがbpのメニューに現れないか"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%AA%E3%81%9C%E6%9C%AC%E6%9D%A5%E3%81%AE%E5%AE%9F%E8%A3%85%E3%83%8E%E3%83%BC%E3%83%89%E3%81%8Cbp%E3%81%AE%E3%83%A1%E3%83%8B%E3%83%A5%E3%83%BC%E3%81%AB%E7%8F%BE%E3%82%8C%E3%81%AA%E3%81%84%E3%81%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"なぜ本来の実装ノードがBPのメニューに現れないか"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"先程の実装例のUFUNCTIONは、ここまで述べてきたUE5以降のType promotionシステムの知識を無いものとして考えると、ただのBPから利用可能なUFUNCTION定義です。つまり、従来の考え方からするとそれ自体もBPのノードリストに登録されていなければおかしいはずです。しかし、実際にはそうなっておらず、「"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ComplexNumber"}]},{type:"text",value:"用の演算ノード」は現れなくなっています。以下の画像のように、統合されたものしか表示されません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5\u002F\u002Fquestion.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これは、以下の部分のエンジンコードを見るとわかります。このメソッドは長いため、今回の内容にとって重要ではない場所は省いています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"BlueprintFunctionNodeSpawner.cpp"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"UBlueprintFunctionNodeSpawner* UBlueprintFunctionNodeSpawner::Create(UFunction const* const Function, UObject* Outer\u002F* = nullptr*\u002F)\n{\n    \u002F\u002F 略\n\tbool const bIsPromotableFunction = TypePromoDebug::IsTypePromoEnabled() && FTypePromotion::IsFunctionPromotionReady(Function);\n\n\tTSubclassOf\u003CUK2Node_CallFunction\u003E NodeClass;\n\tif (bIsPromotableFunction)\n\t{\n\t\tNodeClass = UK2Node_PromotableOperator::StaticClass();\n\t}\n    \u002F\u002F 略\n\telse\n\t{\n\t\tNodeClass = UK2Node_CallFunction::StaticClass();\n\t}\n\n\treturn Create(NodeClass, Function, Outer);\n}\n\n\nUBlueprintFunctionNodeSpawner* UBlueprintFunctionNodeSpawner::Create(TSubclassOf\u003CUK2Node_CallFunction\u003E NodeClass, UFunction const* const Function, UObject* Outer\u002F* = nullptr*\u002F)\n{\n    \u002F\u002F 略\n\n\tbool const bIsPromotableFunction =\n\t\tTypePromoDebug::IsTypePromoEnabled() &&\n\t\tFTypePromotion::IsFunctionPromotionReady(Function);\n\n\tFName OpName = FTypePromotion::GetOpNameFromFunction(Function);\n\n\t\u002F\u002F If a spawner for this operator has been created already, than just return that\n\tif (bIsPromotableFunction && FTypePromotion::IsOperatorSpawnerRegistered(Function))\n\t{\n\t\tif (UBlueprintFunctionNodeSpawner* OpSpawner = FTypePromotion::GetOperatorSpawner(OpName))\n\t\t{\n\t\t\treturn OpSpawner;\n\t\t}\n\t}\n\n\tUBlueprintFunctionNodeSpawner* NodeSpawner = NewObject\u003CUBlueprintFunctionNodeSpawner\u003E(Outer);\n\tNodeSpawner-\u003ESetField(const_cast\u003CUFunction*\u003E(Function));\n\n    \u002F\u002F 略\n\n\tFBlueprintActionUiSpec& MenuSignature = NodeSpawner-\u003EDefaultMenuSignature;\n\n\tif(bIsPromotableFunction)\n\t{\n\t\tMenuSignature.MenuName = FTypePromotion::GetUserFacingOperatorName(OpName);\n\t\tMenuSignature.Category = LOCTEXT(\"UtilityOperatorCategory\", \"Utilities|Operators\");\n\t\t\u002F\u002F Possibly generate some special tooltips for promotable operators?\n\t\tMenuSignature.Tooltip = FTypePromotion::GetUserFacingOperatorName(OpName);\n\t\tMenuSignature.Keywords = FTypePromotion::GetKeywordsForOperator(OpName);\n\t\tFTypePromotion::RegisterOperatorSpawner(OpName, NodeSpawner);\n\t}\n\telse\n\t{\n\t\tMenuSignature.MenuName = UK2Node_CallFunction::GetUserFacingFunctionName(Function);\n\t\tMenuSignature.Category = UK2Node_CallFunction::GetDefaultCategoryForFunction(Function, FText::GetEmpty());\n\t\tMenuSignature.Tooltip = FText::FromString(UK2Node_CallFunction::GetDefaultTooltipForFunction(Function));\n\t\t\u002F\u002F add at least one character, so that PrimeDefaultUiSpec() doesn't attempt to query the template node\n\t\tMenuSignature.Keywords = UK2Node_CallFunction::GetKeywordsForFunction(Function);\n\t}\n\n    \u002F\u002F 略\n\n\treturn NodeSpawner;\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このコードには2つの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Create"}]},{type:"text",value:"というメソッドのオーバーロード定義が含まれており、上の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Create"}]},{type:"text",value:"の定義の最終行で下の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Create"}]},{type:"text",value:"を呼び出してもいるという構造になっています。\nこれらはBPエディタで右クリックした際に表示されるノードリスト(など)で利用される情報を作成するメソッドです。作成される情報の内容には、名前やTooltipなどの表示情報のほか、ユーザーによってそのリストからノードが選択されたときにエディタ上に実際にノードをSpawnさせるためのSpawnerオブジェクトなどが含まれます。BPエディタが初期化・変更されるなどして全体のリフレッシュ処理が実行されると、BPエディタは存在するすべてのUClassを走査して、それらが持っているAction(エディタからアクセス可能なUPropertyやUFunction、そしてそれらが持っている表示情報や利用時の処理など……)を収集します。その処理の流れの中で、UFunctionに関するものの一部はこの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Create"}]},{type:"text",value:"メソッドのところにUFunctionに関する情報を作成させ、取得しにやってくるのです。このとき呼ばれるのは、上の方の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Create"}]},{type:"text",value:"の定義からになります。この前提のもとにこの処理をまとめると、以下のようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"ol",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"あるUFunctionが渡されてくる。Type promotionが有効化されていて、かつ受け取ったUFunctionがType promotionの条件を満たしてる場合、SpawnするBPノードのクラスを問答無用でUK2Node_PromotableOperatorノードにする。UK2Node_PromotableOperatorノードは統合後の演算子ノードの実装クラスである。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"また、同じく受け取ったUFunctionが条件を満たしている場合、作成するActionの情報もUFunctionのものは直接利用せず、受け取ったUFunctionが「定義している演算が属する」演算の名前や表示名、検索キーワードが設定される。この時に作成された情報やSpawnerは登録される。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"再び、データ型は違うが属する演算は同じUFunctionが渡されてきたとする(例えば、Add_IntIntとAdd_FloatFloatはデータ型は違うがAdd演算に属する定義)。すると、登録処理の前に既に同じ演算のUK2Node_PromotableOperatorノードが登録されていることが検出され、新規に情報を作成するのではなく既に登録した情報を返すようになる。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"結果として、「ある演算に対して１つも実装が存在しないと、UE5のType promotionする演算子ノードも一つも存在しない。」「ある演算に対して１つ以上の実装が存在すると、それらに共通する演算子ノードが１つだけ登録される」という処理となる。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"楽しい機能で大変良いですね。正直、はじめは新たなmeta指定子でも追加されたんだろうと思って実装を見始めたのですが、一切プリプロセスに変更を加えないで対応していて面白かったです。長くなりそうで面倒だったので触れませんでしたが、UK2Node_PromotableOperatorノードが行っている、収集した関数の実装から、渡されてきたピンの型情報に最も合致する関数を探し出す処理などもこの機能の根幹を占めている部分ですので、興味があれば実装を読んでみると面白いと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ところで、こういう方面進めるなら、はやく部分的にでもUFUNCTIONをtemplateに対応させてくれないかなあという個人的な気持ちがあります。みなさんでこのPRを応援しましょう(他人任せ)。\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fgithub.com\u002FEpicGames\u002FUnrealEngine\u002Fpull\u002F6902",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fgithub.com\u002FEpicGames\u002FUnrealEngine\u002Fpull\u002F6902"}]}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fsupport-user-defined-types-for-bp-operator-nodes-in-ue5",extension:".md",createdAt:"2021-06-08T00:00:00.000Z",updatedAt:"2021-06-08T00:00:00.000Z",gitCreatedAt:"2021-11-25T19:56:59.000Z",gitUpdatedAt:"2022-01-29T00:45:39.000Z"},{slug:"a-little-more-about-the-ue4-module",description:"UE4のモジュールシステムについて、すこしだけ詳しく書いた記事",title:"ちょっとだけくわしくUE4 モジュールの話",enforceCreatedAt:"2019\u002F7\u002F28",enforceUpdatedAt:"2019\u002F10\u002F29",tags:["Unreal Engine","Unreal C++"],assets:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-more-about-the-ue4-module",toc:[{id:"ゲームモジュールを追加する意義",depth:2,text:"ゲームモジュールを追加する意義"},{id:"モジュールの構成",depth:2,text:"モジュールの構成"},{id:"モジュールファイル",depth:2,text:"モジュールファイル"},{id:"ターゲットファイル",depth:2,text:"ターゲットファイル"},{id:"uproject-ファイル",depth:2,text:".uproject ファイル"},{id:"type",depth:3,text:"Type"},{id:"loadingphase",depth:3,text:"LoadingPhase"},{id:"なぜビルド設定が-c",depth:2,text:"なぜビルド設定が C#?"},{id:"implement_primary_game_module",depth:2,text:"IMPLEMENT_PRIMARY_GAME_MODULE"},{id:"implement_game_module",depth:2,text:"IMPLEMENT_GAME_MODULE"},{id:"implement_module",depth:2,text:"IMPLEMENT_MODULE"},{id:"モジュール実装マクロの余談",depth:2,text:"モジュール実装マクロの余談"},{id:"startupmodule",depth:2,text:"StartupModule"},{id:"postloadcallback",depth:2,text:"PostLoadCallback"},{id:"shutdonwmodule",depth:2,text:"ShutdonwModule"},{id:"preunloadcallback",depth:2,text:"PreUnloadCallback"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"趣旨"},children:[{type:"element",tag:"a",props:{href:"#%E8%B6%A3%E6%97%A8",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"趣旨"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 は本当にいろいろなことができますが、特定のトピックに対する情報のまとまった記事というのがあまりない気がします。\n手順書的な記事は結構あったりするのですが、そのものに対する解説記事的なのは更にない気がします。なので、UE4 の勉強がてら書いてみました。この記事を読むときは、手元で同じように実装を読んでいってもらえるとわかりやすいかと思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"僕は趣味で UE4 をやっているへっぽこ学生なので、なにか間違っていたら遠慮なくご指摘いただけると、僕とこの記事を今後見る人が助かります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"環境"},children:[{type:"element",tag:"a",props:{href:"#%E7%92%B0%E5%A2%83",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"エンジンバージョン: 4.22.3"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"プロジェクト名: MyProject"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"OS: Windows 10"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"プロジェクト名や環境依存の名前などは適時読み替えてください。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"モジュール"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュール"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 においてモジュールとは、エンジンを構成する構成単位そのものです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"エンジン自体が大きな塊ではなく、機能ごとにモジュールという形で分割されています。また、UE4 においてはプラグインもモジュールとして実装されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"さらに、エンジンを用いて開発される C++プロジェクトのソースも、新たなモジュールとして扱われます。\n以下にモジュールのイメージ図を示します。\n"},{type:"element",tag:"img",props:{alt:"UE4Archtecture.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-more-about-the-ue4-module\u002F\u002Fmodule-architecture.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この図を見ていただくと、エンジンとして持っている大量のモジュールの中に、C++プロジェクトで実装した内容が新規モジュールとして追加されている構造がわかりやすいと思います。この C++プロジェクトで実装を行うモジュールのことを、ゲームモジュールといいます。特に、C++プロジェクト作成時にデフォルトで作成されるゲームモジュールのことをプライマリゲームモジュールと呼び、プライマリゲームモジュールはプロジェクトに 1 つしか存在できません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 におけるビルドは、モジュール単位で行われます。ビルドを行うと、1 モジュールにつき 1 つの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".dll"}]},{type:"text",value:"、つまりダイナミックリンクライブラリが出力されます。こうしてビルドされたダイナミックリンクライブラリを読み込んでいき、結果として UE4 という大きなシステムが動作していることになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 はこのようなアーキテクチャによって、Unreal C++プログラマがお世話になっている"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ホットリロード"}]},{type:"text",value:"を実現しています。本来 C++のような事前コンパイルを必要とする言語は、対象のプログラムを起動したままソースを再コンパイルして変更を反映するなどもちろんできません。しかし、UE4 ではこのようなモジュール単位でのビルドの仕組みがあるため、UE4 という大きな視点ではプログラムを起動したまま、変更のあったモジュールのみリビルドし、変更前に読み込んでいた dll をアンロード、変更後の dll を"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ホットリロード"}]},{type:"text",value:"しているのです。モジュール様様、動的リンク様様ですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、モジュールのビルド結果である dll の場所は、UE4 上で"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"module list"}]},{type:"text",value:"というコマンドを打つと簡単に確認できます。\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-more-about-the-ue4-module\u002F\u002Fmodule-list-console.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ゲームモジュールを追加する意義"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B%E6%84%8F%E7%BE%A9",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ゲームモジュールを追加する意義"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"プライマリゲームモジュール以外にゲームモジュールを追加作成すべきシチュエーションの例を挙げておきます。\nプロジェクト上で独自のアセットを実装し、ゲーム上で利用するとします。この独自アセットには、エディタ上での作成機能、インポート機能、独自エディタが実装されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この時、アセット自体に含まれるプロパティやメソッドは、ゲーム上に必要な情報です。しかし、エディタ機能やインポート機能などは、ゲーム上に必要な情報でしょうか？これはエディタを用いて制作を行う過程において必要な実装情報であって、Shipping ビルドを行ってユーザーにゲームを公開する際には含む必要のない情報です。しかしそんな都合はビルドシステムもコンパイラも察してくれないため、1 つのモジュールに愚直に実装してしまうと、エディタにしか必要のない情報をゲームに含めてしまいます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで新規モジュールの登場です。UE4 のビルドシステムには、ビルド設定ごとにビルドに含めるモジュールを変更する機能が用意されています。このため、新規モジュールを用意しカスタムエディタや新規作成機能部分のみをこちらに実装、Editor ビルド時にのみ対象とするよう設定すれば、Game ビルド(Shipping ビルドなどのこと)時にはゲームに必要な実装のみを含めることができるようになります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、モジュールを分割することでビルド時のリンク速度を上げることができます。ただし、ゲーム実装自体を分割すると、リンク速度の向上とトレードオフとして実行時に読み込む DLL の数が増えるため、ゲームプレイにおいては悪影響を及ぼす恐れがあり（ますと公式に書いてあり）ます。実際の影響の程度は検証を行っていないためわかりませんが、そこまで大きな影響はなさそうな気もします。というか Game ビルド時にはサードパーティ製以外のバイナリは実行ファイルにまとめられているはずですが、モジュール数は影響するんでしょうか？"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"コードの結合度を下げて、使い回しを楽にしやすいという利点もあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"モジュールの構成"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E6%A7%8B%E6%88%90",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールの構成"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C++プロジェクトを作成すると、Source 以下はこんな構成になっていると思います。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"-- Source\n    |-- MyProject\n    |   |-- MyProject.Build.cs\n    |   |-- MyProject.cpp\n    |   `-- MyProject.h\n    |-- MyProject.Target.cs\n    `-- MyProjectEditor.Target.cs\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject"}]},{type:"text",value:"というディレクトリの中に入っているのが、C++プロジェクト作成時に生成されるプライマリゲームモジュールです。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.cpp"}]},{type:"text",value:", "},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.h"}]},{type:"text",value:"といった C++ファイルはモジュールについての実装を行うために用意されているファイルです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"モジュールファイル"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールファイル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで重要なのは"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Build.cs"}]},{type:"text",value:"という C#ファイルです。このファイルは、モジュールに関する各種設定を行うためのファイルで、モジュールファイルと呼ばれるものです。UE4 でビルドを行う際には、ビルドツールがモジュールファイルを探索し、モジュールを認識することで、モジュールに含まれるコードが適切な設定でビルドされます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"では、デフォルトで生成されている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Build.cs"}]},{type:"text",value:"を覗いてみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.Build.cs"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"\u002F\u002F Fill out your copyright notice in the Description page of Project Settings.\n\nusing UnrealBuildTool;\n\npublic class MyProject : ModuleRules\n{\n\tpublic MyProject(ReadOnlyTargetRules Target) : base(Target)\n\t{\n\t\tPCHUsage = PCHUsageMode.UseExplicitOrSharedPCHs;\n\n\t\tPublicDependencyModuleNames.AddRange(new string[] { \"Core\", \"CoreUObject\", \"Engine\", \"InputCore\" });\n\n\t\tPrivateDependencyModuleNames.AddRange(new string[] {  });\n\t}\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"デフォルトでは、そこまで複雑な設定は行われていません。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PublicDependencyModuleNames"}]},{type:"text",value:"というメンバ変数の配列になにか文字列を追加しているところと、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PCHUsage"}]},{type:"text",value:"というメンバ変数になにか代入しているところだけです。順に説明します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"配列"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"PublicDependencyModuleNames"}]},{type:"text",value:"は、この"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Build.cs"}]},{type:"text",value:"が示すモジュールが依存するモジュールの名前をセットし、モジュール内で外部の依存するモジュールを利用できるように設定する変数です。依存しているモジュールがここに含まれていないと、ビルド時にエラーが出ます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"PCHUsage"}]},{type:"text",value:"というのは、IWYU(Include-What-You-Use)というシステムの利用方法について設定する変数です。IWYU についてはここでは解説しませんが、簡単に言えば依存関係をいい感じに整理することでビルド速度などを早くしてくれる機能です。詳細は以下の記事とドキュメントを御覧ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"IWYU でコーディングしよう\n"},{type:"element",tag:"a",props:{href:"http:\u002F\u002Fmiyahuji111.hatenablog.com\u002Fentry\u002F2017\u002F04\u002F03\u002F081222",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"http:\u002F\u002Fmiyahuji111.hatenablog.com\u002Fentry\u002F2017\u002F04\u002F03\u002F081222"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"IWYU リファレンス ガイド\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FIWYUReferenceGuide\u002Findex.html",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FIWYUReferenceGuide\u002Findex.html"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここではこの 2 つしか設定が行われていませんが、他にも多くの設定項目が存在します。\n設定可能な項目については以下の記事とドキュメントが詳しいです。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ModuleRules(XXX.build.cs ファイル)について\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fqiita.com\u002Ftakayashiki2\u002Fitems\u002Fdb995c558024c3db8223",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fqiita.com\u002Ftakayashiki2\u002Fitems\u002Fdb995c558024c3db8223"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"アンリアル ビルド システムのモジュール ファイル\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FModuleFiles\u002Findex.html",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FModuleFiles\u002Findex.html"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"設定項目に代入すべき列挙型の中身が不明だったりして困惑することがありますが、そんなときにはエンジンソースに含まれているビルドツールのソースを読みに行きましょう！！"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"ターゲットファイル"},children:[{type:"element",tag:"a",props:{href:"#%E3%82%BF%E3%83%BC%E3%82%B2%E3%83%83%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ターゲットファイル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"Source"}]},{type:"text",value:"の直下にある"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:","},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProjectEditor.Target.cs"}]},{type:"text",value:"の 2 つの C#ファイルもやはりビルドに関する設定を行うファイルで、ターゲットファイルと呼ばれるものです。これらの中では、上記の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Build.cs"}]},{type:"text",value:"等で発見されたモジュールのうち、”どれを”ビルド対象にするかという設定を行います。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"つまり、モジュールとして完璧な形のコードを作成しても、ここに設定を追記しなければモジュールはビルドに含まれないということです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"では、なぜこのファイルは 2 つ生成されるのでしょうか。ここで、Game ビルド時と Editor ビルド時で含まれるモジュールを変えられるというところに話が戻ります。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProjectEditor.Target.cs"}]},{type:"text",value:"に設定したモジュールは Editor ビルド時にビルド対象となり、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:"に設定したモジュールは Game ビルド時にビルド対象となるといったように、使い分けることができます。\n試しに、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:"の方を見てみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"\u002F\u002F Fill out your copyright notice in the Description page of Project Settings.\n\nusing UnrealBuildTool;\nusing System.Collections.Generic;\n\npublic class MyProjectTarget : TargetRules\n{\n\tpublic MyProjectTarget(TargetInfo Target) : base(Target)\n\t{\n\t\tType = TargetType.Game;\n\n\t\tExtraModuleNames.AddRange( new string[] { \"MyProject\" } );\n\t}\n}\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Type"}]},{type:"text",value:"という変数にこの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:"によって行われるビルドの種類を指定しています。ちなみに、ビルドツールのコードではこの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TargetType"}]},{type:"text",value:"という型は以下のように列挙型として定義されています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ビルドツールより抜粋(TargetRules.cs)"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"\tpublic enum TargetType\n\t{\n\t\tGame,\n\t\tEditor,\n\t\tClient,\n\t\tServer,\n\t\tProgram,\n\t}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"生成される"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:","},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProjectEditor.Target.cs"}]},{type:"text",value:"は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"TargetType"}]},{type:"text",value:"に"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Game"}]},{type:"text",value:","},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Editor"}]},{type:"text",value:"が設定されたターゲットファイルですが、ビルドツールを見るとまだ他にもタイプがあるようです。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"アンリアルビルド システムのターゲット ファイル\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FTargetFiles\u002Findex.html",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fapi.unrealengine.com\u002FJPN\u002FProgramming\u002FUnrealBuildSystem\u002FTargetFiles\u002Findex.html"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"公式から引用させていただくと、それぞれこんな意味があるそうです。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"Game - クック済みデータの実行を要求するスタンドアロン ゲームです。\nClient - Game と同じですが、サーバー コードは含まれません。ネットワーク ゲームに役立ちます。\nServer - Game と同じですが、クライアント コードは含まれません。ネットワーク ゲームのデディケイテッド サーバーに役立ちます。\nEditor - アンリアル エディタを拡張するターゲットです。\nProgram - アンリアル エンジンに加えてビルドされているスタンドアロン ユーティリティ プログラムです。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、引用元に重大な誤植があったため、引用文は一部修正を加えています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これだけビルドタイプがあるにも関わらず、デフォルトでは 2 種類分しか生成されないということは、自分でターゲットファイルを追加することができるということです。ターゲットファイルの作成については流石に話がそれすぎるのでここでは解説しません。ちなみに、同じビルドタイプのターゲットファイルを複数作成しても、1 つしか認識されませんのでご注意ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"次に、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ExtraModuleNames"}]},{type:"text",value:"です。ここが重要なところで、ビルドターゲットにするモジュールの識別名をセットする配列です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"デフォルトではゲームモジュールがプライマリゲームモジュール 1 つしかないので 1 つしか指定されておらず、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.Target.cs"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProjectEditor.Target.cs"}]},{type:"text",value:"どちらも同じ設定になっていますが、前述のような都合でモジュールを追加した場合は大変便利です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"IDE などからビルドを行う際には、ターゲットファイルのクラス名が併記されたビルド設定が生成されているので、対応するものを選択すれば、どちらの設定でビルドを行うか指定することができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"uproject-ファイル"},children:[{type:"element",tag:"a",props:{href:"#uproject-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:".uproject ファイル"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 のプロジェクト直下に生成される"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".uproject"}]},{type:"text",value:"ファイルにもモジュールに関する設定項目が存在します。\n今回生成された"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.uproject"}]},{type:"text",value:"を覗いてみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.uproject"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-json"]},children:[{type:"text",value:"{\n\t\"FileVersion\": 3,\n\t\"EngineAssociation\": \"4.22\",\n\t\"Category\": \"\",\n\t\"Description\": \"\",\n\t\"Modules\": [\n\t\t{\n\t\t\t\"Name\": \"MyProject\",\n\t\t\t\"Type\": \"Runtime\",\n\t\t\t\"LoadingPhase\": \"Default\"\n\t\t}\n\t]\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールに関する項目は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"\"Modules\""}]},{type:"text",value:"の箇所です。ここには、プロジェクトで定義したモジュールを設定します。モジュールファイルやターゲットファイルには基本的にビルドに関する設定を行ってきましたが、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".uproject"}]},{type:"text",value:"に記述するのは起動時の読み込み対象のモジュールの識別名です。ここに記述しなくてもビルド対象にすることはできますが、起動時の読み込みやホットリロード等の対象にはなりません。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"また、識別名だけでなく、そのモジュールを読み込む動作タイプと、読み込みタイミングも設定することができます。それぞれ以下のようになっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"type"},children:[{type:"element",tag:"a",props:{href:"#type",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Type"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"読み込み時タイプ名"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"概要"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Runtime"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"通常実行時には読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"RuntimeNoCommandlet"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"実行時、コマンドレットでない場合読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"RuntimeAndProgram"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"実行時かつビルドターゲットが Progarm である場合読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"CookedOnly"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"クックビルドされた後の場合読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Developer"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"デベロッパツールをサポートしたエンジン上でのみ読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Editor"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エディタビルドの場合読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"EditorNoCommandlet"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エディタビルドかつコマンドレットでない場合読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"Program"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Program ビルドされた場合のみ読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"ServerOnly"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Server ビルドされた場合のみ読み込む"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"ClientOnly"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Client ビルドされた場合のみ読み込む"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"loadingphase"},children:[{type:"element",tag:"a",props:{href:"#loadingphase",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"LoadingPhase"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"読み込み順"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"ローディングフェーズ名"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"タイミング"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"1"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"EarliestPossible"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"可能な限り最も早く読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"2"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PostConfigInit"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エンジン設定の初期化後に読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"3"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PreEaryLoadingScreen"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PreLoadingScreen よりも前に読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"4"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PreLoadingScreen"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"画面が起動する前に読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"5"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PreDefault"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Default の前に読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"6"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Default"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"通常のモジュールロードタイミングで読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"7"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PostDefault"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"Default の後に読み込みます"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"8"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PostEngineInit"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"エンジンの初期化処理が終了したあとに読み込みます"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"なお、モジュールを追加する際には以下のようにします。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.uproject"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-json"]},children:[{type:"text",value:"{\n\t\"FileVersion\": 3,\n\t\"EngineAssociation\": \"4.22\",\n\t\"Category\": \"\",\n\t\"Description\": \"\",\n\t\"Modules\": [\n\t\t{\n\t\t\t\"Name\": \"MyProject\",\n\t\t\t\"Type\": \"Runtime\",\n\t\t\t\"LoadingPhase\": \"Default\"\n\t\t},\n\t\t{\n\t\t\t\"Name\": \"NewModule\",\n\t\t\t\"Type\": \"Editor\",\n\t\t\t\"LoadingPhase\": \"Default\"\n\t\t}\n\t]\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"なぜビルド設定が-c"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%AA%E3%81%9C%E3%83%93%E3%83%AB%E3%83%89%E8%A8%AD%E5%AE%9A%E3%81%8C-c",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"なぜビルド設定が C#?"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"設定ファイルが C#なのは、UE4 のビルドツールが本体が C#で書かれていることに由来します。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールファイルや後述のターゲットファイルといった C#による設定ファイルは、Generate ~などのメニューからプロジェクトを生成する際にビルドが行われ、そのプロジェクトにおけるモジュールのビルドルールとなる DLL が生成されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これをビルドツール本体が動的リンクすることで、C++プロジェクトのゲームモジュールを含めた適切なビルドを行っているんだと思います。（間違っていたらごめんなさい）\n謎のビルドエラーが起こったときに Intermediate を消すと動くのはここにも一因があると思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"コンテキストメニュー\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-more-about-the-ue4-module\u002F\u002Fbuild-context-menu.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"生成されたビルドルールの DLL\n"},{type:"element",tag:"img",props:{alt:"image.png",src:"\u002Farticle-assets\u002Funrealengine\u002Fa-little-more-about-the-ue4-module\u002F\u002Fbuild-rule-dlls.png"},children:[]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"単なる設定ファイルとしてだけでなく、ビルド時に行いたい処理なども記述できるので結構便利です。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"モジュールの実装を確認してみる"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E5%AE%9F%E8%A3%85%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールの実装を確認してみる"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここまでモジュールの設定方法とビルドについて詳しく見てきましたが、肝心のモジュールの宣言方法に触れていません。モジュール自体は C++実装なのですから、モジュールの宣言も C++で行ってやる必要があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"改めてモジュールの構成を示します。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"-- Source\n    |-- MyProject\n    |   |-- MyProject.Build.cs\n    |   |-- MyProject.cpp\n    |   `-- MyProject.h\n    |-- MyProject.Target.cs\n    `-- MyProjectEditor.Target.cs\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"C#のファイルたちは皆設定を行うファイルだったので、モジュールの実装を行うのは残った C++ファイル 2 つ、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.h"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"MyProject.cpp"}]},{type:"text",value:"です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"とりあえず、デフォルトの状態のこの 2 つのファイルを見てみましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.h"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F\u002F Fill out your copyright notice in the Description page of Project Settings.\n\n#pragma once\n\n#include \"CoreMinimal.h\""}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"MyProject.cpp"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\u002F\u002F Fill out your copyright notice in the Description page of Project Settings.\n\n#include \"MyProject.h\"\n#include \"Modules\u002FModuleManager.h\"\n\nIMPLEMENT_PRIMARY_GAME_MODULE( FDefaultGameModuleImpl, MyProject, \"MyProject\" );"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"もはや無です。というか、実装らしき箇所が 1 箇所しかありません。\nこれはこの C++プロジェクトが生成した、プライマリゲームモジュールをコードであるため、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"というマクロで、そのマクロ名の通りプライマリゲームモジュールが実装されています。\nでは、このマクロを含め、モジュール定義のためのマクロたちを紹介します。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"implement_primary_game_module"},children:[{type:"element",tag:"a",props:{href:"#implement_primary_game_module",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これはたった今登場した、プライマリゲームモジュール実装のためのマクロです。\nプライマリゲームモジュールはプロジェクト上に 1 つしか実装できないため、必然的にこのマクロもプロジェクトを通して 1 つのモジュールにしか書くことはありません。逆に、これがないと Shipping ビルドなどのモノリシックビルド時にビルドが通らないんじゃないかと思います。(試してないです)"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ModuleImplClass"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ModuleName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" GameName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"このマクロは、第一引数に"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"モジュールを実装したクラス"}]},{type:"text",value:"、第二引数に"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"モジュール名"}]},{type:"text",value:"、第三引数に"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ゲーム(プロジェクト)名"}]},{type:"text",value:"を取ります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"第一引数に渡すモジュールを実装したクラスは、後述の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IModuleInterface"}]},{type:"text",value:"というインターフェイスを継承して実装したモジュールクラスを渡すことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"第二引数に渡すモジュール名は、他のモジュールやエンジン上からこのモジュールを識別する際の名称として使われる文字列を決定します。実装クラスと同じ名前である必要はありません。例えば、ターゲットファイルの"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ExtraModuleNames"}]},{type:"text",value:"に渡していたのはここで決定される識別名です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"第三引数はゲーム(プロジェクト)名を渡すのですが、実装を覗くと、この第三引数はもう利用されていません。昔はここに渡したゲーム名を利用した処理が行われていたようなのですが、現在は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:".uproject"}]},{type:"text",value:"ファイルから自動的にプロジェクト名をパースしてくるようで、コード上でも廃止予定とされています。おそらく残っているのは後方互換性のためでしょう。現状も値を渡さなければエラーが出ますが、実際は文字列さえ渡しておけば良いと思われます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"implement_game_module"},children:[{type:"element",tag:"a",props:{href:"#implement_game_module",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こちらはゲームモジュールを実装するためのマクロです。ゲームモジュールはプライマリゲームモジュールと異なり、プロジェクト上に複数個実装することが可能なため、このマクロも複数のモジュールに書くことができます。ゲームコードを含むモジュールはこれで実装しましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ModuleImplClass"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ModuleName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"第一引数と第二引数はプライマリゲームモジュールの場合と同じで、実装クラスとその識別名を与えます。\n(プライマリゲームモジュールの第三引数は廃止予定だったので、中身は異なりますが渡しているものは実質同じですね。)"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"implement_module"},children:[{type:"element",tag:"a",props:{href:"#implement_module",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"こちらはシンプルなモジュールを実装するためのマクロです。ゲームコードを含まないモジュールはこのマクロで実装されます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-cpp"]},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ModuleImplClass"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ModuleName"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"渡している引数は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"text",value:"と同様です。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで使われている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"というマクロはプライマリゲームモジュールを実装する(implement なので)マクロなのですが、実は初期状態では、はじめから用意されている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDefaultGameModuleImpl"}]},{type:"text",value:"という最低限のクラスをゲームモジュールとして利用(代用？)しているだけです。もっとモジュールクラス自体に機能を持たせるために用意されている手段は後述しますので、とりあえず"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDefaultGameModuleImpl"}]},{type:"text",value:"の中身を見てみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"モジュール実装マクロの余談"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A3%85%E3%83%9E%E3%82%AF%E3%83%AD%E3%81%AE%E4%BD%99%E8%AB%87",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュール実装マクロの余談"}]},{type:"text",value:"\n"},{type:"element",tag:"font",props:{color:"darkred"},children:[{type:"text",value:"\n"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"この節には不確定要素が多いです。"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n\nここまで紹介してきたモジュール実装のためのマクロたちですが、実装を見るとこれらはビルド方式によって内部処理が変動しているようです。プラットフォームなどによる変動はもちろんあるのですが、最も大きいのが**Monolithic(一枚岩)\n"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"と"}]},{type:"text",value:"\nModular(まとまりごと)**という 2 種類のリンクタイプのによる違いです。\nリンクがわからない方は詳しくは調べてほしいのですが、ざっくり言えばコンパイルした複数のファイルや必要なライブラリを正しく関連付ける作業です。\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この 2 つのリンクタイプによって生まれるビルドの結果は「ビルド結果として得られるバイナリが実行ファイルにまとまっているか、多量の.dll などに分散しているか」の違いがあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"パッケージングのビルドや Game ビルド(Shipping ビルド)などは実行ファイルとしてバイナリがまとまるため"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Monolithic"}]},{type:"text",value:"で行われて、Editor ビルドの際などは.dll としてバイナリがモジュールごとに生成されるため"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"Modular"}]},{type:"text",value:"で行われていることがわかります。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"そして、Modular でリンクが行われる際、前述の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"text",value:","},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"text",value:","},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"の 3 つのモジュール実装マクロの内部処理に"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"差はありません"}]},{type:"text",value:"。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"すべての実装マクロが、リンクタイプが Modular 時の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"text",value:"の処理へと渡されています。これは推測ですが、Modular すなわち Editor 上で開発を行っている際には、エンジンというソフトウェアの管理はエンジン側にあるため、ゲームモジュールを含めすべてのモジュールは内部的には同等のプログラムとして扱われているのではないでしょうか。確かに、Game ビルド時のようにプライマリゲームモジュール中心で動作していたら、それ自身のホットリロードは困難な気がします。(怪しいです。違ったら指摘してほしいところ No.1 です)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"一方 Monolithic 時の実装は"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"が独自の複雑な処理に変わったり、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"text",value:"の処理からホットリロードの処理が外されたりしています。しかし、実装を見る限りでは"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_MODULE"}]},{type:"text",value:"と"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"text",value:"の間にはこちらでも差異は見られない気がします……。というか、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_GAME_MODULE"}]},{type:"text",value:"の実装は常に以下になっています。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ModuleManager.hより抜粋"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"#define IMPLEMENT_GAME_MODULE( ModuleImplClass, ModuleName ) \\\n\tIMPLEMENT_MODULE( ModuleImplClass, ModuleName )"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"うーん。各所の説明を読むと別のものとされているのですが、表面上のものなのでしょうか？有識者の方、教えて下さい。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"モジュールクラスについて"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュールクラスについて"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、モジュール実装マクロに渡すモジュールクラスについて触れます。\n例として、デフォルトで生成された"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IMPLEMENT_PRIMARY_GAME_MODULE"}]},{type:"text",value:"に渡されていた"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDefaultGameModuleImpl"}]},{type:"text",value:"クラスの実装に注目しましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ModuleManager.hより抜粋"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"class FDefaultModuleImpl\n\t: public IModuleInterface\n{ };\n\nclass FDefaultGameModuleImpl\n\t: public FDefaultModuleImpl\n{\n\tvirtual bool IsGameModule() const override\n\t{\n\t\treturn true;\n\t}\n};"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここからわかることは、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IModuleInterface"}]},{type:"text",value:"というクラス(インターフェイス?)を継承して、先程の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDefaultGameModuleImpl"}]},{type:"text",value:"は作られていたということです。そして、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"FDefaultGameModuleImpl"}]},{type:"text",value:"は唯一つ、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IsGameModule"}]},{type:"text",value:"という"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"bool"}]},{type:"text",value:"を返すメソッドで"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"true"}]},{type:"text",value:"を返すというオーバーライドが実装されています。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IsGameModule"}]},{type:"text",value:"はその名と型の通り、自らがゲームモジュールである場合"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"true"}]},{type:"text",value:"を返すよう設定するためのメソッドです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここではこれ 1 つのみですが、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"IModuleInterface"}]},{type:"text",value:"が宣言・定義されている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModuleInterface.h"}]},{type:"text",value:"の実装を覗くと、他のオーバーライド可能なメソッドを知ることができます。自分でゲームモジュールを追加で宣言する場合には、このあたりを利用することが多いため、一度目を通しておくと良いです。一応ドキュメントもありますが、実装ファイル以上の情報はありません。"}]},{type:"text",value:"\n"},{type:"element",tag:"blockquote",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"IModuleInterface\n"},{type:"element",tag:"a",props:{href:"https:\u002F\u002Fapi.unrealengine.com\u002FINT\u002FAPI\u002FRuntime\u002FCore\u002FModules\u002FIModuleInterface\u002Findex.html",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:"text",value:"https:\u002F\u002Fapi.unrealengine.com\u002FINT\u002FAPI\u002FRuntime\u002FCore\u002FModules\u002FIModuleInterface\u002Findex.html"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"モジュール実装に多用されるメソッド"},children:[{type:"element",tag:"a",props:{href:"#%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%AE%9F%E8%A3%85%E3%81%AB%E5%A4%9A%E7%94%A8%E3%81%95%E3%82%8C%E3%82%8B%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"モジュール実装に多用されるメソッド"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"IModuleInterface"}]},{type:"text",value:"には、設定項目的なメソッド以外にも、モジュールの実装にあたって非常に重要なメソッドがいくつか定義されています。\nそれらをオーバライドすることで、独自モジュール実装に利用することができます。ここでは、特に使用頻度の高いメソッドについて触れます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"startupmodule"},children:[{type:"element",tag:"a",props:{href:"#startupmodule",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"StartupModule"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールの DLL がロードが開始された直後に呼び出されるメソッドです。モジュールのオブジェクトが作成されて真っ先に呼び出されると考えれば良いです。ここには、依存関係にあるモジュールの読み込みや、このモジュールで行う実装の初期化処理などを行うことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"postloadcallback"},children:[{type:"element",tag:"a",props:{href:"#postloadcallback",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"PostLoadCallback"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールのロードが後に実行されるメソッドです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"shutdonwmodule"},children:[{type:"element",tag:"a",props:{href:"#shutdonwmodule",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"ShutdonwModule"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールが完全にアンロードされる直前に呼び出されます。終了時処理などを行うことができます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"preunloadcallback"},children:[{type:"element",tag:"a",props:{href:"#preunloadcallback",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"PreUnloadCallback"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モジュールのアンロード開始前に呼び出されるメソッドです。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"この 4 つのメソッドを以下のような実装でオーバーライドしてビルドの上、ホットリロードが行われた場合の出力を確認してみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"実装例.cpp"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-cpp"]},children:[{type:"text",value:"\n\u002F*\n** このコードは単体では動作しません。また、ShutdownModuleとPreUnloadCallbackについては\n** 前回ビルドの結果が出力されるため、2回以上リビルドしなければ後述の出力は得られません。\n*\u002F\n\nclass FMyProjectModule : public FDefaultGameModuleImpl\n{\npublic:\n    virtual void StartupModule() override\n    {\n        UE_LOG(LogTemp, Log, TEXT(\"StartupModule\"))\n    }\n\n    virtual void PostLoadCallback() override\n    {\n        UE_LOG(LogTemp, Log, TEXT(\"PostLoadCallback\"))\n    }\n\n    virtual void ShutdownModule() override\n    {\n        UE_LOG(LogTemp, Log, TEXT(\"ShutdonwModule\"))\n    }\n\n    virtual void PreUnloadCallback() override\n    {\n        UE_LOG(LogTemp, Log, TEXT(\"PreUnloadCallback\"))\n    }\n};\n\nIMPLEMENT_PRIMARY_GAME_MODULE(FMyProjectModule, MyProjectModule, \"MyProject\")\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ホットリロード時の出力"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-text"]},children:[{type:"text",value:"LogTemp: PreUnloadCallback\nLogTemp: ShutdonwModule\nLogTemp: StartupModule\nLogTemp: PostLoadCallback"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"つまり、以下のような実行順で実行されるということがわかります。"}]},{type:"text",value:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{type:"element",tag:"table",props:{},children:[{type:"element",tag:"thead",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"th",props:{},children:[{type:"text",value:"実行順"}]},{type:"element",tag:"th",props:{},children:[{type:"text",value:"メソッド名"}]}]}]},{type:"element",tag:"tbody",props:{},children:[{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"1"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"StartupModule"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"2"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PostLoadCallback"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"-"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"(モジュール動作中)"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"3"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"PreUnloadCallback"}]}]},{type:"element",tag:"tr",props:{},children:[{type:"element",tag:"td",props:{},children:[{type:"text",value:"4"}]},{type:"element",tag:"td",props:{},children:[{type:"text",value:"ShutdonwModule"}]}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらは本当によく使うため、覚えておきましょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"まとめ"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%BE%E3%81%A8%E3%82%81",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"まとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"UE4 はモジュールの集合体！"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"モジュールには種類があって、使い分ける"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"モジュールは自作できる。"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"モジュール実装のための便利なものが親として提供されているから、頑張って使いこなそう！"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"おわりに"},children:[{type:"element",tag:"a",props:{href:"#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB",ariaHidden:"true",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"おわりに"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"粗く長くやりましたが、モジュールの宣言のされかたやビルドツールとの関わりなどが少しわかっていただけたら嬉しいです。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fa-little-more-about-the-ue4-module",extension:".md",createdAt:"2019-07-28T00:00:00.000Z",updatedAt:"2019-10-29T00:00:00.000Z",gitCreatedAt:"2021-11-25T20:46:01.000Z",gitUpdatedAt:"2022-01-29T00:45:39.000Z"},{slug:"the-process-to-start-building-with-the-unreal-build-tool-in-ue4",description:"UBTが各種ビルドモードを開始するまでにしていることについて調べたやつ",title:"UE4のUnreal Build Toolのビルド開始までの流れについて",enforceCreatedAt:"2019\u002F6\u002F14",enforceUpdatedAt:"2019\u002F6\u002F15",tags:["Unreal Engine","Unreal Build Tool"],toc:[{id:"エントリーポイント",depth:2,text:"エントリーポイント"},{id:"コマンドライン引数のパース",depth:3,text:"コマンドライン引数のパース"},{id:"動作モードと動作オプションの取得",depth:3,text:"動作モードと動作オプションの取得"},{id:"各種設定処理",depth:3,text:"各種設定処理"},{id:"処理実行",depth:3,text:"処理実行"}],body:{type:"root",children:[{type:"element",tag:"h1",props:{id:"概要"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E6%A6%82%E8%A6%81",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"概要"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"別の UE4 のリフレクションについての記事を調べながら書こうとしていたのですが、ビルドツール周りについての項で既に肥大化しそうだったので別記事にすることにしました。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここに書いてあるのはビルドツール全体の話ではなく、ビルドツールがビルドを開始するまでの流れと概要についてのメモです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"環境"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E7%92%B0%E5%A2%83",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"環境"}]},{type:"text",value:"\n"},{type:"element",tag:"ul",props:{},children:[{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Unreal Engine 4.22.2"}]},{type:"text",value:"\n"},{type:"element",tag:"li",props:{},children:[{type:"text",value:"Windows 10"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"文章中にソースコードの行数や関数・変数名等が登場しますが、これらは上述の環境におけるものですので、他の環境においては変動する可能性があります。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"unreal-build-tool-ubt"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#unreal-build-tool-ubt",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"Unreal Build Tool (UBT)"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UE4 には独自のビルドツールが搭載されており、このビルドツールがいろいろやってくれていることで UE4 上での C++コーディングがとても楽になっています。例えば、UE4 で C++を使って実装したアクタのプロパティがエンジンの詳細パネルからアクセスできたり、BP 上で関数が呼び出せたりといったような機能はこのビルドツール(と、Unreal Header Tools)があるおかげです。\nそもそも UnrealC++の構文機能は C++の標準機能を飛び出しているので、こいつが前処理してくれないとコンパイルにかけることすらできません。\nまあそんなすごいことをやっているビルドツール(笑)なので、単にビルド設定をしているとかファイルを管理してるとか以上のことをやっており、ここの中身を少しでも知っておけばいろいろ楽なんじゃなかろうかと思うわけです。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"呼び出しを追っていく"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E3%82%92%E8%BF%BD%E3%81%A3%E3%81%A6%E3%81%84%E3%81%8F",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"呼び出しを追っていく"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、UBT のソースコードはエンジンがインストールされているディレクトリから"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-unknown"]},children:[{type:"element",tag:"code",props:{className:["language-unknown"]},children:[{type:"text",value:"Engine\\Source\\Programs\\UnrealBuildTool"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"と辿っていくと見つかります。ここには何やらいろんなディレクトリがあり、それぞれの中にも大量のコードがあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"UnrealBuildTool\n|-- Configuration\n|-- DotNetCore\n|-- Executors\n|-- Modes\n|-- Platform\n|-- ProjectFiles\n|-- Properties\n|-- System\n|-- ToolChain\n|-- UnrealBuildTool.cs\n|-- UnrealBuildTool.csproj\n|-- app.config\n`-- app.manifest\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h2",props:{id:"エントリーポイント"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"エントリーポイント"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"UBT のエントリーポイントは、UBT のコードがあるディレクトリにある"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UnrealBuildTool.cs"}]},{type:"text",value:"内の Main 関数です。\nそれなりに長いので、ビルドに直接関係しそうなところだけ抜き出して、コメントを翻訳・追記してみます。\nかなり削っているので、いろんなオプション機能や例外処理、パフォーマンス計測用のコードが消えています。ご注意ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"UnreaalBuildTool.csのMain関数"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"\t\tprivate static int Main(string[] ArgumentsArray)\n\t\t{\n\t\t\t\u002F\u002F Mutex保持用変数\n\t\t\tSingleInstanceMutex Mutex = null;\n\n            \u002F\u002F コマンドライン引数をパース\n            CommandLineArguments Arguments = new CommandLineArguments(ArgumentsArray);\n\n            \u002F\u002F グローバル設定をパース\n            GlobalOptions Options = new GlobalOptions(Arguments);\n\n            \u002F\u002F ビルドを行うディレクトリを Engine\u002FSource に変更します。\n            DirectoryReference.SetCurrentDirectory(UnrealBuildTool.EngineSourceDirectory);\n\n            \u002F\u002Fビルド設定とビルド管理を保持するクラスの型情報を取得\n            Type ModeType = typeof(BuildMode);\n\n            \u002F\u002F 動作モードの指定がされていた場合、動作モードに該当するクラスを探索して型情報をModeTypeに格納する\n            if(Options.Mode != null)\n            {\n                \u002F\u002F すべての有効なモードを探索\n                Dictionary\u003Cstring, Type\u003E ModeNameToType = new Dictionary\u003Cstring, Type\u003E(StringComparer.OrdinalIgnoreCase);\n                foreach(Type Type in Assembly.GetExecutingAssembly().GetTypes())\n                {\n                    if(Type.IsClass && !Type.IsAbstract && Type.IsSubclassOf(typeof(ToolMode)))\n                    {\n                        ToolModeAttribute Attribute = Type.GetCustomAttribute\u003CToolModeAttribute\u003E();\n                        ModeNameToType.Add(Attribute.Name, Type);\n                    }\n                }\n                \u002F\u002F モードの設定を行う\n                ModeNameToType.TryGetValue(Options.Mode, out ModeType)\n            }\n\n            \u002F\u002F ビルドモードクラスの属性に設定されているオプションを取得\n            ToolModeOptions ModeOptions = ModeType.GetCustomAttribute\u003CToolModeAttribute\u003E().Options;\n\n            \u002F\u002F エンジンのコンテンツ(ソースコードなど)のプリフェッチ(事前読み込み)オプションが有効化されていれば開始\n            if((ModeOptions & ToolModeOptions.StartPrefetchingEngine) != 0)\n            {\n                FileMetadataPrefetch.QueueEngineDirectory();\n            }\n\n            \u002F\u002F XMLの設定ファイル読み込みが有効化されていれば読み込み\n            if((ModeOptions & ToolModeOptions.XmlConfig) != 0)\n            {\n                string XmlConfigMutexName = SingleInstanceMutex.GetUniqueMutexForPath(\"UnrealBuildTool_Mutex_XmlConfig\", Assembly.GetExecutingAssembly().CodeBase);\n                using(SingleInstanceMutex XmlConfigMutex = new SingleInstanceMutex(XmlConfigMutexName, true))\n                {\n                    FileReference XmlConfigCache = Arguments.GetFileReferenceOrDefault(\"-XmlConfigCache=\", null);\n                    XmlConfig.ReadConfigFiles(XmlConfigCache);\n                }\n            }\n\n            \u002F\u002F SingleInstance(コードに対して複数のビルドが同時実行できない設定)が有効になっていれば、Mutexを設定\n            if((ModeOptions & ToolModeOptions.SingleInstance) != 0 && !Options.bNoMutex)\n            {\n                string MutexName = SingleInstanceMutex.GetUniqueMutexForPath(\"UnrealBuildTool_Mutex\", Assembly.GetExecutingAssembly().CodeBase);\n                Mutex = new SingleInstanceMutex(MutexName, Options.bWaitMutex);\n            }\n\n            \u002F\u002F すべてのプラットフォームに対してのビルドを登録する場合としない場合の設定\n            if((ModeOptions & ToolModeOptions.BuildPlatforms) != 0)\n            {\n                UEBuildPlatform.RegisterPlatforms(false);\n            }\n            if((ModeOptions & ToolModeOptions.BuildPlatformsForValidation) != 0)\n            {\n                UEBuildPlatform.RegisterPlatforms(true);\n            }\n\n            \u002F\u002F 設定されたモードから適切なハンドラを生成\n            ToolMode Mode = (ToolMode)Activator.CreateInstance(ModeType);\n\n            \u002F\u002F ハンドラに設定されたモードを実行\n            int Result = Mode.Execute(Arguments);\n\n            \u002F\u002F ビルド所要時間の表示が有効であれば表示\n            if((ModeOptions & ToolModeOptions.ShowExecutionTime) != 0)\n            {\n\t            \u002F\u002F 表示用コード　省略\n            }\n\n            return Result;\n\t\t}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これがビルドツールのエントリーポイントです。もう少し詳しく見ていきます。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"コマンドライン引数のパース"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%83%A9%E3%82%A4%E3%83%B3%E5%BC%95%E6%95%B0%E3%81%AE%E3%83%91%E3%83%BC%E3%82%B9",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"コマンドライン引数のパース"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、コマンドライン引数のパース部です。ここに関してはやってることはそのままですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F コマンドライン引数をパース"}]},{type:"text",value:"\n       "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"CommandLineArguments"}]},{type:"text",value:" Arguments "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"text",value:"CommandLineArguments"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ArgumentsArray"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n       "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F グローバル設定をパース"}]},{type:"text",value:"\n       "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"GlobalOptions"}]},{type:"text",value:" Options "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"text",value:"GlobalOptions"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Arguments"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"element",tag:"code",props:{},children:[{type:"text",value:"CommandLineArguments"}]},{type:"text",value:"という便利なクラスが"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource\u002FPrograms\u002FDotNETCommon\u002FDotNETUtilities\u002FCommandLineArguments.cs"}]},{type:"text",value:"に定義されていて、こいつにコマンドラインから受け取った引数配列を渡すだけでいい感じにしてくれているようです。\nそして、いい感じの形にしたコマンドライン引数の情報を、これまた"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GlobalOptions"}]},{type:"text",value:"という便利なクラスに渡しています。こちらは Main と同じ"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"UnrealBuildTool.cs"}]},{type:"text",value:"内にいます。"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GlobalOptions"}]},{type:"text",value:"はその名の通り設定情報を保持するクラスなのですが、そのコンストラクタは引数として"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CommandLineArguments"}]},{type:"text",value:"を受け取る仕様になっています。該当コンストラクタを抜き出してきました。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"UnreaalBuildTool.csのGlobalOptionsのコンストラクタ"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"\tpublic GlobalOptions(CommandLineArguments Arguments)\n\t{\n\t\tArguments.ApplyTo(this);\n\t\tif (!string.IsNullOrEmpty(RemoteIni))\n\t\t{\n\t\t\tUnrealBuildTool.SetRemoteIniPath(RemoteIni);\n\t\t}\n\t}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"やっていることは渡された"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"CommandLineArguments"}]},{type:"text",value:"のインスタンスが持っている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ApplyTo()"}]},{type:"text",value:"を、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GlobalOptions"}]},{type:"text",value:"自らに対して適用させるというのが主なようです。ついでに"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"-remoteini"}]},{type:"text",value:"が指定されている場合の処理もここでやっていますね。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここで設定の適用された"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"GlobalOptions"}]},{type:"text",value:"が出来上がり、Main の方でそれを取得しているんですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"動作モードと動作オプションの取得"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%8B%95%E4%BD%9C%E3%83%A2%E3%83%BC%E3%83%89%E3%81%A8%E5%8B%95%E4%BD%9C%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%AE%E5%8F%96%E5%BE%97",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"動作モードと動作オプションの取得"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"個人的にここの処理がモダンな言語の暴力といった感じで好きです。\nここでは指定された動作モードに対応するクラスを取得してくる処理をしているわけなんですが、なかなかアクロバティックです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F初期値としてビルド設定とビルド管理を保持するクラスの型情報を取得"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Type"}]},{type:"text",value:" ModeType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typeof"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name","type-expression"]},children:[{type:"text",value:"BuildMode"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 動作モードの指定がされていた場合、動作モードに該当するクラスを探索して型情報をModeTypeに格納する"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Options"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Mode "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"null"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F すべての有効なモードを探索"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Dictionary"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]},{type:"text",value:" ModeNameToType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"text",value:"Dictionary"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"StringComparer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"OrdinalIgnoreCase"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"foreach"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Type"}]},{type:"text",value:" Type "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"in"}]},{type:"text",value:" Assembly"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetExecutingAssembly"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetTypes"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n        "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IsClass "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IsAbstract "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IsSubclassOf"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typeof"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name","type-expression"]},children:[{type:"text",value:"ToolMode"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n        "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n            "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolModeAttribute"}]},{type:"text",value:" Attribute "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-method"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetCustomAttribute"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"ToolModeAttribute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n            ModeNameToType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Add"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Attribute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Name"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n        "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n    "},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F モードの設定を行う"}]},{type:"text",value:"\n    ModeNameToType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetValue"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Options"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Mode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"out"}]},{type:"text",value:" ModeType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"まず、Type 型(型情報を持つやつ)の ModeType 変数を宣言しています。初期値はビルドモードを保持する"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BuildMode"}]},{type:"text",value:"クラスです。\n"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BuildMode"}]},{type:"text",value:"クラスは"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource\u002FPrograms\u002FUnrealBuildTool\u002FModes"}]},{type:"text",value:"にある"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"BuoldMode.cs"}]},{type:"text",value:"に宣言されているクラスなのですが、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource\u002FPrograms\u002FUnrealBuildTool\u002FModes"}]},{type:"text",value:"には他にも似たようなファイルがあります。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-treeview"]},children:[{type:"element",tag:"code",props:{className:["language-treeview"]},children:[{type:"text",value:"Modes\u002F\n|-- BuildMode.cs\n|-- CleanMode.cs\n|-- DeployMode.cs\n|-- GenerateProjectFilesMode.cs\n|-- JsonExportMode.cs\n|-- SetupPlatformsMode.cs\n|-- ValidatePlatformsMode.cs\n|-- WriteDocumentationMode.cs\n`-- WriteMetadataMode.cs\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"これらのファイルにはすべて、"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToolMode"}]},{type:"text",value:"という抽象クラスを継承した各モードのクラスの実装が行われています。そして、これらのクラスは当然、C#で記述されたビルドツールがコンパイルされるときにビルドツール自体のバイナリの中に取り込まれます。\nこれを念頭に置いて、上記の処理からモードの探索部分を改めてみてみます。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F すべての有効なモードを探索"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Dictionary"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]},{type:"text",value:" ModeNameToType "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"new"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name","constructor-invocation"]},children:[{type:"text",value:"Dictionary"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"string"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"StringComparer"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"OrdinalIgnoreCase"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"foreach"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"Type"}]},{type:"text",value:" Type "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"in"}]},{type:"text",value:" Assembly"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetExecutingAssembly"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetTypes"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IsClass "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"IsAbstract "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&&"}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"IsSubclassOf"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"typeof"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","class-name","type-expression"]},children:[{type:"text",value:"ToolMode"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n        "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolModeAttribute"}]},{type:"text",value:" Attribute "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-method"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetCustomAttribute"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"ToolModeAttribute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n        ModeNameToType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Add"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Attribute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Name"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" Type"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n    "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、はじめにモード名文字列をキーにとり、対応するモードが実装されたクラスの型情報を値に持つ連想配列を宣言しています。\nそして次に、"},{type:"element",tag:"strong",props:{},children:[{type:"text",value:"ビルドツール自らのバイナリ内に宣言されている全ての public な型の情報を実行時に取得して"}]},{type:"text",value:"、その中から抽象クラス ToolMode を継承している型を抜き出し、そのクラスに設定されている Attribute(属性)情報からモード名を取得、ディクショナリに情報を追加しています。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"クラスの属性については、以下のように各モードクラスの頭に宣言されています。僕はあまり C#を書かないので、C#にこんな属性の記法があることを初めて知りました。UnrealC++の記法ってやっぱり C#リスペクトあるんですかね。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tag:"span",props:{className:["token","attribute"]},children:[{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolMode"}]},{type:"element",tag:"span",props:{className:["token","attribute-arguments"]},children:[{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","string"]},children:[{type:"text",value:"\"Build\""}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"XmlConfig "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"BuildPlatforms "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"SingleInstance "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"StartPrefetchingEngine "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"|"}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ShowExecutionTime"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"class"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"BuildMode"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","type-list"]},children:[{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolMode"}]}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F略"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"おそらくこの機構により、他の部分に一切手を加えなくても"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Engine\u002FSource\u002FPrograms\u002FUnrealBuildTool\u002FModes"}]},{type:"text",value:"に新たなモードのクラスを実装したファイルを追加して引数のパース部にオプションを増やすだけでモードを増やせるようにしているのでしょう。"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"最後に、コマンドライン引数で指定されたモードに該当するモードが探索結果のディクショナリにあったら ModeType に参照渡しで設定して完璧です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F モードの設定を行う"}]},{type:"text",value:"\nModeNameToType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"TryGetValue"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Options"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Mode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"out"}]},{type:"text",value:" ModeType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"各種設定処理"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%90%84%E7%A8%AE%E8%A8%AD%E5%AE%9A%E5%87%A6%E7%90%86",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"各種設定処理"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"ここでは、ここまでに取得した情報から各種設定を行っています。やっているだけな感じの処理が大半なので、コードは冒頭のみにします。前述の全文の方を御覧ください。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ビルドモードクラスの属性に設定されているオプションを取得"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolModeOptions"}]},{type:"text",value:" ModeOptions "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" ModeType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","generic-method"]},children:[{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"GetCustomAttribute"}]},{type:"element",tag:"span",props:{className:["token","class-name","generic"]},children:[{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003C"}]},{type:"text",value:"ToolModeAttribute"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"\u003E"}]}]}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Options"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F エンジンのコンテンツ(ソースコードなど)のプリフェッチ(事前読み込み)オプションが有効化されていれば開始。"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ModeOptions "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"&"}]},{type:"text",value:" ToolModeOptions"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"StartPrefetchingEngine"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"!="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","number"]},children:[{type:"text",value:"0"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    FileMetadataPrefetch"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"QueueEngineDirectory"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F XMLの設定ファイル読み込みが有効化されていれば読み込み"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F SingleInstance(コードに対して複数のビルドが同時実行できない設定)が有効になっていれば、Mutexを設定"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F すべてのプラットフォームに対してのビルドを登録する場合としない場合の設定"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 略"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"h3",props:{id:"処理実行"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E5%87%A6%E7%90%86%E5%AE%9F%E8%A1%8C",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"処理実行"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"いよいよ情報が揃ったので、実行箇所です。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["remark-highlight"]},children:[{type:"element",tag:"pre",props:{className:["language-csharp"]},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F 設定されたモードから適切なハンドラを生成"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"text",value:"ToolMode"}]},{type:"text",value:" Mode "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ToolMode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"Activator"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"CreateInstance"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"ModeType"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n"},{type:"element",tag:"span",props:{className:["token","comment"]},children:[{type:"text",value:"\u002F\u002F ハンドラに設定されたモードを実行"}]},{type:"text",value:"\n"},{type:"element",tag:"span",props:{className:["token","class-name"]},children:[{type:"element",tag:"span",props:{className:["token","keyword"]},children:[{type:"text",value:"int"}]}]},{type:"text",value:" Result "},{type:"element",tag:"span",props:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" Mode"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tag:"span",props:{className:["token","function"]},children:[{type:"text",value:"Execute"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Arguments"},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tag:"span",props:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"モードに合わせたクラスの型情報を持っている"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ModeType"}]},{type:"text",value:"をもとにインスタンスを作成し、抽象クラスである"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToolMode"}]},{type:"text",value:"にアップキャストしてハンドラ用の"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"Mode"}]},{type:"text",value:"変数に格納しています。今更ですが、抽象クラス"},{type:"element",tag:"code",props:{},children:[{type:"text",value:"ToolMode"}]},{type:"text",value:"の中身はこんな感じです。"}]},{type:"text",value:"\n"},{type:"element",tag:"div",props:{className:["code-extra"]},children:[{type:"element",tag:"div",props:{className:["filename"]},children:[{type:"text",value:"ToolMode.csのToolModeクラス"}]},{type:"element",tag:"pre",props:{},children:[{type:"element",tag:"code",props:{className:["language-csharp"]},children:[{type:"text",value:"abstract class ToolMode\n{\n\tpublic abstract int Execute(CommandLineArguments Arguments);\n}"}]}]}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"嘘ではないですがハンドラ(実行しかできない)みたいな感じがすごいですね。\nまあ、そんな感じでこれを通して各モードの実装が実行されるわけですね。"}]},{type:"text",value:"\n"},{type:"element",tag:"h1",props:{id:"いったんまとめ"},children:[{type:"element",tag:"a",props:{ariaHidden:"true",href:"#%E3%81%84%E3%81%A3%E3%81%9F%E3%82%93%E3%81%BE%E3%81%A8%E3%82%81",tabIndex:-1},children:[{type:"element",tag:"span",props:{className:["icon","icon-link"]},children:[]}]},{type:"text",value:"いったんまとめ"}]},{type:"text",value:"\n"},{type:"element",tag:"p",props:{},children:[{type:"text",value:"とりあえず Unreal Build Tool がビルドやその他の処理を呼び出すまでの流れはわかりました。\n次はビルド処理を読んで記事を書こうと思います。"}]}]},dir:"\u002Farticles\u002Funrealengine",path:"\u002Farticles\u002Funrealengine\u002Fthe-process-to-start-building-with-the-unreal-build-tool-in-ue4",extension:".md",createdAt:"2019-06-14T00:00:00.000Z",updatedAt:"2019-06-15T00:00:00.000Z",gitCreatedAt:"2021-11-25T21:00:30.000Z",gitUpdatedAt:"2021-11-30T16:52:43.000Z"}]},completed:a}],fetch:{},mutations:a}}(void 0)));